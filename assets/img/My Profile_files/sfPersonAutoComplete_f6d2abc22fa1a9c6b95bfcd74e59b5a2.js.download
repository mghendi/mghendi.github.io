function SFPersonAutoComplete(k){this._init(new juic.Config(k,this.DEFAULTS,this.VALIDATION));this.register()}
(function(){function k(a,b,c){this._config=c;this._photos={};this._super(a,b)}function l(a){this._config=a}var n={profile:"SQUARE_50"},m=juic.Logger.getLogger("SFPersonAutocomplete");SFPersonAutoComplete.EXTERNAL_REGISTRY={};juic.extend(SFPersonAutoComplete,SFComboBox,{DEFAULTS:{autoCompleteConfig:{},additionalCriteria:{},searchControllerName:"quickcardController",searchControllerMethod:"searchPersonAutocomplete",dependency:["/ui/quickcard/js/quickcard.js","ajaxservice:hris.quickcardController"],
isV12Plus:!0,forceSelection:!1,clearValueWhenDelete:!0,maxInputLength:100,searchKeys:[]},VALIDATION:{source:["string",null]},setAdditionalCriteria:function(a){this._config.additionalCriteria=a},appendAdditionalCriteria:function(a){var b=this._config.additionalCriteria;this._config.additionalCriteria=juic.set(b||{},a||{});return b},_init:function(a){this._config=a;this._super(null,new l(a),juic.set({minimumFilterSize:a.minimumFilterSize||this.getDefaultMinimumFilterSize(),isV12Plus:a.isV12Plus,fetchPagesInOrder:!0},
this._config))},_createListSelect:function(a,b){b.mutatorClass="personACList";b.itemFocusClass="globalMenuItemFocus";return new k(a,b,this._config)},_getAriaOwns:function(){return this._listSelect.id},_isToggleRendered:function(){return!1},attachExternal:function(a){SFPersonAutoComplete.EXTERNAL_REGISTRY[a.displayFieldId]=this;return this._super(a)},getPersonList:function(a,b,c){return new k(a,b,c)},getItemProvider:function(a){return new l(a)}});juic.extend(k,SFComboListSelect,{cleanup:function(){for(var a in this._photos)this._photos[a].cleanup();
this._super()},_renderPageContent:function(a,b,c){if(0==b&&0==c.length)a.push('\x3cdiv role\x3d"alert" class\x3d"no-results globalMenuItem" unselectable\x3d"on" onselectstart\x3d"return false"\x3e'),a.push(this._config.noResultsMessage||MSGS.COMMON_No_Results),a.push("\x3c/div\x3e");else for(var d=0,e=c.length;d<e;d++){var f=0<b?this._lastItemIndex+1:d;this._renderItem(a,c[d],f);this._lastItemIndex=f}},_renderItem:function(a,b,c){var d=b.employments&&b.employments[0],e=b.hasEmploymentDifferentiatorText;
b.subItem&&!b.firstSubItem||a.push('\x3cdiv class\x3d"personACWrapper"\x3e');b.subItem||this._renderItemStart(a,b,c,"personACEmployment personACItem noSubItems",d,e);b.firstSubItem&&a.push('\x3cdiv class\x3d"personACItem hasSubItems"\x3e');if(b.firstSubItem||!b.subItem){var f=this._getUserPhoto(b);f&&a.push(f);var g=juic.escapeHTML(b.name).replace(new RegExp("("+RegExp.escape(juic.escapeHTML(this._filterValue))+")","i"),"\x3cem\x3e$1\x3c/em\x3e"),h=this.isHideUserName()?null:b.userName;h&&(h=juic.escapeHTML(h).replace(new RegExp("("+
RegExp.escape(juic.escapeHTML(this._filterValue))+")","i"),"\x3cem\x3e$1\x3c/em\x3e"),g=MSGS.get("COMMON_User_Display_Name_With_Username_Format",g,h));a.push('\x3cdiv class\x3d"employmentDetails',f?" hasPhoto":"",'"\x3e');a.push('\x3cdiv class\x3d"empName"\x3e',g,"\x3c/div\x3e")}b.subItem&&this._renderItemStart(a,b,c,"personACEmployment",d,e);a.push('\x3cdiv class\x3d"empTitleWrapper"\x3e');d&&(c=d.title,f=d.locationName,this.isEmpty(c)||this.isEmpty(f)?this.isEmpty(c)&&(c=this.isEmpty(f)?this.displayEmptyWhenOneEmployment(b,
MSGS.get("COMMON_Person_AutoComplete_Alternate_Employment")):f):c=MSGS.get("COMMON_Person_AutoComplete_Title_And_Location",c,f),c=this.filterInvalidText(c),f=this._setDisplayTitleCss(c),g="",this._isActive(d)||(g=' \x3cspan class\x3d"'+f+'"\x3e'+MSGS.get("COMMON_PARENTHETICAL_PHRASE",MSGS.COMMON_InActive)+"\x3c/span\x3e"),e?(a.push('\x3cspan class\x3d"empDiffAutoCompleteSearch"\x3e',juic.escapeHTML(d.employmentDifferentiatorText),g,"\x3c/span\x3e"),a.push("\x3cspan\x3e"),b.showIcon&&this._renderIcon(a,
d),a.push("\x3c/span\x3e")):(a.push('\x3cspan class\x3d"empTitle"\x3e',juic.escapeHTML(c),g,"\x3c/span\x3e"),b.showIcon&&this._renderIcon(a,d)));e="";c=this.getResultScope();"PERSON"==c?"Y"==b.isContingentWorkerString?e="Y":"?"==b.isContingentWorkerString&&(e="?"):"EMPLOYMENT"==c&&("Y"==d.isContigentWorker?e="Y":"?"==d.isContigentWorker&&(e="?"));"?"==e&&(d=MSGS.COMMON_Contingent_Worker_No_Permission_Info,a.push(' \x3cspan title\x3d"'+d+'" class\x3d"contingentNoAuthIcon contingentNoAuth"'),a.push("\x3e\x3c/span\x3e"));
"Y"==e&&(d='\x3cspan class\x3d"contingent-worker-display"\x3e'+MSGS.COMMON_Contingent_Worker+"\x3c/span\x3e",a.push("\x3c/div\x3e"),a.push("\x3cdiv\x3e"),a.push(d));a.push("\x3c/div\x3e");b.subItem||a.push("\x3c/div\x3e");a.push("\x3c/a\x3e");b.lastSubItem&&a.push("\x3c/div\x3e\x3c/div\x3e");b.subItem&&!b.lastSubItem||a.push("\x3c/div\x3e")},isEmpty:function(a){return null==a||""===a},filterInvalidText:function(a){return"N/A"===a||"No Data"===a?MSGS.get("COMMON_Person_AutoComplete_Alternate_Employment"):
a},displayEmptyWhenOneEmployment:function(a,b){return a.firstSubItem||a.subItem?b:""},_renderIcon:function(a,b){var c=b.employmentTypeStr;Util.isRTL()&&a.push("\x26#8207;");if("ST"===c||"CE"===c){var d=b.isPrimaryEmployment;!0!==d&&"true"!==d||a.push('\x3cspan aria-label\x3d"',MSGS.ECT_PRIMARY_ASSIGNMENT_TOOLTIP,'" class\x3d"empTypeIcon primaryEmploymentIcon"\x3e\x3c/span\x3e')}d=b.isHomeAssignment;!0===d||"true"===d?a.push('\x3cspan aria-label\x3d"',MSGS.EMPLOYMENT_GO_TemporaryAssignmentInfo_homeAssignment,
'" class\x3d"empTypeIcon homeAssignmentIcon"\x3e\x3c/span\x3e'):"GA"===c&&(!1!==d&&"false"!==d||a.push('\x3cspan aria-label\x3d"',MSGS.ECT_ASSIGNMENT_TYPE_GLOBAL_ASSIGNMENT,'" class\x3d"empTypeIcon globalAssignmentIcon"\x3e\x3c/span\x3e'));Util.isRTL()&&a.push("\x26#8207;")},_renderItemStart:function(a,b,c,d,e,f){b=e?MSGS.get("COMMON_Person_AutoComplete_Title_And_Location",b.name,e.title):b.name;f&&(b=e.employmentDifferentiatorText);if(e){f=e.employmentTypeStr;if("ST"===f||"CE"===f){var g=e.isPrimaryEmployment;
if(!0===g||"true"===g)b+=" "+MSGS.ECT_PRIMARY_ASSIGNMENT_TOOLTIP}if("GA"===f){e=e.isHomeAssignment;if(!0===e||"true"===e)b+=" "+MSGS.EMPLOYMENT_GO_TemporaryAssignmentInfo_homeAssignment;if(!1===e||"false"===e)b+=" "+MSGS.ECT_ASSIGNMENT_TYPE_GLOBAL_ASSIGNMENT}}a.push('\x3ca id\x3d"',this._getItemDomId(c),'" class\x3d"globalMenuItem ',d);this._focusIndex==c&&a.push(" ",this._getFocusClass());a.push('" title\x3d"',juic.escapeHTML(b));a.push('" onmouseover\x3d"',this.fireCode("_mouseover",c));a.push('" onmouseout\x3d"',
this.fireCode("_mouseout",c));a.push('" ontouchstart\x3d"',this.fireCode("_touchstart",c));a.push('" ontouchend\x3d"',this.fireCode("_touchend",c));a.push('" onclick\x3d"',this.fireCode("_selectItem",c));a.push('" role\x3d"menuitem"\x3e')},_isActive:function(a){return a&&"undefined"!=typeof a.isActive?JSON.parse(a.isActive):!0},_setDisplayTitleCss:function(a){var b="empTitle";a||(b+=" empInactive");return b},_getUserPhoto:function(a){if(!this._hasPhoto())return null;var b=a.photoViewable?a.photoSrc:
IMAGES["/ui/uicore/img/photoNotAvailable.gif"],c=window.pageHeaderJsonData,d=(c=c&&c.settings)&&"true"==c.encryptUserIdInURLEnabled,c=d?a.userIdEncoded:a.photoUserId;!b&&c&&(b={urlType:SFPhoto.URL_TYPE_EDU,photoAction:"show",photoType:"quickCard"},d?b.userIdEncoded=a.userIdEncoded:b.userId=a.photoUserId,a.photoMod?b.mod=a.photoMod:a.photoId&&a.photoLastModified&&(b.mod=SFPhoto.getPhotoMod(a.photoId,a.photoLastModified)),b=SFPhoto.url(b));return b?(a=c+","+b,(d=this._photos[a])||(d=this._photos[a]=
new SFPhoto({userid:c,photoSrc:b},n)),d):null},isHideUserName:function(){if("undefined"==typeof this._hideUserName){var a=juic.$("autocomplete.hideUserName");this._hideUserName=a&&"true"===a.getAttribute("content")}return this._hideUserName},isPhotoEnabled:function(){if("undefined"==typeof this._photoEnabled){var a=juic.$("autocomplete.enablePhoto");this._photoEnabled=!a||"true"===a.getAttribute("content")}return this._photoEnabled},_hasPhoto:function(){return this.isPhotoEnabled()},scrollToItem:function(a,
b){var c=juic.$(this.id),d=juic.$(this._getItemDomId(a));if(c&&d){var e=SFDom.getY(c),f=e-SFDom.getY(d),d=SFDom.getY(d)+d.offsetHeight-e-c.offsetHeight;0<f?c.scrollTop-=f:0<d&&(c.scrollTop+=d)}},moveFocusUp:function(){var a=this._focusIndex,b=a;for(this._super();this._focusIndex!=b&&!this.isValidFocusableIndex(this._focusIndex);)b=this._focusIndex,this._super();this.isValidFocusableIndex(this._focusIndex)||this.changeItemFocus(a)},moveFocusDown:function(){var a=this._focusIndex,b=a;for(this._super();this._focusIndex!=
b&&!this.isValidFocusableIndex(this._focusIndex);)b=this._focusIndex,this._super();this.isValidFocusableIndex(this._focusIndex)||this.changeItemFocus(a)},isValidFocusableIndex:function(a){a=this._cachedItems[a];return"EMPLOYMENT"==this.getResultScope()?a&&a.employments&&0<a.employments.length:a},getResultScope:function(){return((this._config.additionalCriteria||{}).resultScope||"EMPLOYMENT").toUpperCase()}});juic.extend(l,SFAbstractItemProvider,{hasMore:function(a){var b=a.event;if(b&&"boolean"===
typeof b.hasMore)return b.hasMore;if((b=a.items)&&0<b.length){for(var c,d=0;d<b.length;d++){var e=b[d].personId;c!==e&&(this._iTotalPersons++,c=e)}return this._iTotalPersons<a.itemCount}return!1},getLabel:function(a){if(a){var b=a.name||"",c=a.employments&&a.employments[0]&&a.employments[0].title;a.hasEmploymentDifferentiatorText&&(c=a.employments[0].employmentDifferentiatorText);return c?MSGS.get("COMMON_Person_AutoComplete_Title_And_Location",b,c):b}return""},getItems:function(a){function b(){if(f&&
"function"==typeof f[e]){var b=c._createCriteria(a),h=b.searchValue.trim().split(" ");4<h.length&&(b.searchValue=h.slice(0,4).join(" "),m.info("sfPersonAutoComplete search limited to 4 separate terms"));f[e](b,{errorHandler:function(b,d){m.error("Error calling controller: ",b,d);c.dispatch("itemsError",{pagination:a,message:b})},callback:function(b){c.dispatch("itemsAvailable",{items:c._flattenEmployments(b),itemCount:b.totalCount,hasMore:b.hasMore,pagination:a})}})}else c.dispatch("itemsError",{pagination:a,
message:"Invalid controller: "+d+"."+e})}1==a.pageNumber&&(this._iTotalPersons=0);var c=this,d=this._config.searchControllerName,e=this._config.searchControllerMethod,f=this._searchController=this._searchController||AjaxService.getMBeanInstance(d);f&&"function"==typeof f[e]?b():SMRF.load(this._config.dependency,function(){f=this._searchController=this._searchController||AjaxService.getMBeanInstance(d);b()})},_flattenEmployments:function(a){a=Array.prototype.slice.apply(a.items);for(var b=a.length-
1;0<=b;b--){var c=a[b];c.photoUserId=c.photoUserId||c.userId;c.showIcon=this._showIcon(c.employments);if(c.employments&&1<c.employments.length){var d=c.employments.splice(1,c.employments.length-1);c.firstSubItem=!0;c.subItem=!0;c.primaryEmploymentUserId=c.userId;c.userId=c.employments[0].userId;for(var e=0;e<d.length;e++){var f=d[e],g=juic.set({},c);g.employments=[f];g.userId=f.userId;a.splice(b+e+1,0,juic.set(g,{firstSubItem:!1,lastSubItem:e==d.length-1}))}}else c.employments&&0!=c.employments.length?
"EMPLOYMENT"==this.getResultScope()&&(c.userId=c.employments[0].userId):"EMPLOYMENT"==this.getResultScope()&&(c.subItem=!0,c.firstSubItem=!0,c.lastSubItem=!0)}return a},_showIcon:function(a){return a&&1<a.length},getResultScope:function(){return((this._config.additionalCriteria||{}).resultScope||"EMPLOYMENT").toUpperCase()},_getSearchController:function(){var a=this._searchController;a||(this._searchController=a=AjaxService.getMBeanInstance(controllerName));return a},_createCriteria:function(a){return juic.set({searchValue:a.filterValue||
"",keys:this._config.searchKeys,page:a.pageNumber,maxresults:a.pageSize,source:this._config.source},this._config.additionalCriteria)},getValue:function(a){if(a){var b=juic.set({},a);(a=(a=a.employments)&&a[0])&&juic.set(b,a);delete b.employments;return b}return a}})})();