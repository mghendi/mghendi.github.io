function TLMManageWorkScheduleDetailsTab(a){this.register();this._init(a)}
juic.extend(TLMManageWorkScheduleDetailsTab,juic.Component,{_init:function(a){this._config=a||{};this._nameInputField=new ECTInputBox(this._config.workSchedule.getExternalName(),{writable:this._config.writeMode,enabled:!0,label:MSGS.TIMEANDLABOR_WORKSCHEDULE_NAME,name:MSGS.TIMEANDLABOR_WORKSCHEDULE_NAME,size:30,required:!0});this._avgHoursPerDayInputField=new ECTInputBox(this._config.workSchedule.getAverageHoursPerDay(),{writable:this._config.writeMode,enabled:!0,title:MSGS.TIMEANDLABOR_TIME_UNIT_HOURS,
label:this._config.labels.averageHoursPerDay,size:6,maxlength:6});this._avgHoursPerWeekInputField=new ECTInputBox(this._config.workSchedule.getAverageHoursPerWeek(),{writable:this._config.writeMode,enabled:!0,title:MSGS.TIMEANDLABOR_TIME_UNIT_HOURS,label:this._config.labels.averageHoursPerWeek,size:6,maxlength:6});this._avgHoursPerMonthInputField=new ECTInputBox(this._config.workSchedule.getAverageHoursPerMonth(),{writable:this._config.writeMode,enabled:!0,title:MSGS.TIMEANDLABOR_TIME_UNIT_HOURS,
label:this._config.labels.averageHoursPerMonth,size:6,maxlength:6});this._avgHoursPerYearInputField=new ECTInputBox(this._config.workSchedule.getAverageHoursPerYear(),{writable:this._config.writeMode,enabled:!0,title:MSGS.TIMEANDLABOR_TIME_UNIT_HOURS,label:this._config.labels.averageHoursPerYear,size:6,maxlength:6});this._avgWorkingDaysPerWeekInputField=new ECTInputBox(this._config.workSchedule.getAverageWorkingDaysPerWeek(),{writable:this._config.writeMode,enabled:!0,title:MSGS.TIMEANDLABOR_TIME_UNIT_DAYS,
label:this._config.labels.averageWorkingDaysPerWeek,size:6,maxlength:6,type:"number"});a=new Date;this._config.workSchedule.getStartingDate()&&(a=TLMFieldsHelper.DateFormatter.parse(TLMFieldsHelper.DateFormatter.format(this._config.workSchedule.getStartingDate())));a=ECTUtil.formatDateForCalendar(a);this._startingDateSelectionField=new ECTCalendar(a,{writable:this._config.writeMode,name:"Work schedule starting date",hideCalPopupOnDefFocus:!0,required:!0,label:this._config.labels.startingDate});a=
TLMFieldsHelper.DateFormatter.parse(this._startingDateSelectionField.getValue());this._weekday=dateFormatSymbols.weekdays[a.getDay()];this._startingDateSelectionField.addEventListener("fieldError",this,"_handleInvalidInputInCalendar");this._startingDateSelectionField.addEventListener(ECTConstants.EVENT_CHANGE,this,"_handleStartingDateChangeEvent");this._dayTable=new WorkScheduleDayTable(this._config);this._bindValidators()},_bindValidators:function(){this._startingDateSelectionField.bindValidators({type:"date",
required:!0,label:this._config.labels.startingDate});this._nameInputField.bindValidators({type:"string",required:!0,label:MSGS.TIMEANDLABOR_WORKSCHEDULE_NAME});this._avgHoursPerDayInputField.bindSpecificValidators({type:"number",label:this._config.labels.averageHoursPerDay});this._avgHoursPerWeekInputField.bindSpecificValidators({type:"number",label:this._config.labels.averageHoursPerWeek});this._avgHoursPerMonthInputField.bindSpecificValidators({type:"number",label:this._config.labels.averageHoursPerMonth});
this._avgHoursPerYearInputField.bindSpecificValidators({type:"number",label:this._config.labels.averageHoursPerYear});this._avgWorkingDaysPerWeekInputField.bindSpecificValidators({type:"number",label:this._config.labels.startingDate})},refreshWeekday:function(a){jQuery("#weekdayField").html(a)},_handleInvalidInputInCalendar:function(a){a.hasError&&this.refreshWeekday("")},_handleStartingDateChangeEvent:function(){if(this._startingDateSelectionField.getValue()&&"INVALID"!==this._startingDateSelectionField.getValue()){var a=
TLMFieldsHelper.DateFormatter.parse(this._startingDateSelectionField.getValue());this._weekdayValue=dateFormatSymbols.weekdays[a.getDay()]}else this._weekdayValue="";this.refreshWeekday(this._weekdayValue)},renderHtml:function(a){a.push('\x3cdl class\x3d"headerData" role\x3d"presentation"\x3e');a.push('\x3cdt\x3e\x3cspan class \x3d "requiredAsterix redText"\x3e\x26nbsp;*\x26nbsp;\x3c/span\x3e',MSGS.TIMEANDLABOR_WORKSCHEDULE_NAME,"\x3c/dt\x3e\x3cdd\x3e",this._nameInputField,"\x3c/dd\x3e");a.push('\x3cdt\x3e\x3cspan class \x3d "requiredAsterix redText"\x3e\x26nbsp;*\x26nbsp;\x3c/span\x3e',
this._config.labels.startingDate,"\x3c/dt\x3e");a.push('\x3cdd\x3e\x3cspan class \x3d "startingDateWrite"\x3e',this._startingDateSelectionField);a.push('\x3cspan id\x3d"weekdayField" class\x3d"workScheduleDescription"\x3e',this._weekday,"\x3c/span\x3e\x3c/span\x3e");a.push('\x3cspan class \x3d "startingDateReadonly"\x3e',this._weekday,", ",this._startingDateSelectionField,"\x3c/span\x3e");a.push("\x3c/dd\x3e");a.push("\x3c/dl\x3e");this._dayTable.renderHtml(a);this._config.workSchedule&&!this._config.workSchedule.hasAtLeastOneCalculationField()?
a.push('\x3cdiv class\x3d"tmlAverageFields notVisible"\x3e'):a.push('\x3cdiv class\x3d"tmlAverageFields"\x3e');a.push("\x3ch3\x3e",MSGS.TIMEANDLABOR_WORKSCHEDULE_CALCULATION_DETAILS,"\x3c/h3\x3e");a.push('\x3cspan class\x3d"workScheduleDescription"\x3e',MSGS.TIMEANDLABOR_WORKSCHEDULE_CALCULATION_DETAILS_DESC,"\x3c/span\x3e");a.push('\x3cdl class\x3d"calculationFields"\x3e');a.push("\x3cdt\x3e",this._config.labels.averageHoursPerWeek,"\x3c/dt\x3e");a.push("\x3cdd\x3e",this._avgHoursPerWeekInputField,
"\x26nbsp;\x3c/dd\x3e");a.push("\x3cdt\x3e",this._config.labels.averageHoursPerDay,"\x3c/dt\x3e");a.push("\x3cdd\x3e",this._avgHoursPerDayInputField,"\x26nbsp;\x3c/dd\x3e");a.push("\x3cdt\x3e",this._config.labels.averageHoursPerMonth,"\x3c/dt\x3e");a.push("\x3cdd\x3e",this._avgHoursPerMonthInputField,"\x26nbsp;\x3c/dd\x3e");a.push("\x3cdt\x3e",this._config.labels.averageHoursPerYear,"\x3c/dt\x3e");a.push("\x3cdd\x3e",this._avgHoursPerYearInputField,"\x26nbsp;\x3c/dd\x3e");a.push("\x3cdt\x3e",this._config.labels.averageWorkingDaysPerWeek,
"\x3c/dt\x3e");a.push("\x3cdd\x3e",this._avgWorkingDaysPerWeekInputField,"\x26nbsp;\x3c/dd\x3e");a.push("\x3c/dl\x3e");a.push("\x3c/div\x3e")},getWorkSchedule:function(){var a=this._config.workSchedule;a.setExternalName(this._nameInputField.getValue());this._startingDateSelectionField.getValue()&&"INVALID"!==this._startingDateSelectionField.getValue()?a.setStartingDate(this._startingDateSelectionField.getValue()):a.setStartingDate("");a.setAverageHoursPerDay(ECTUtil.toDBString(this._avgHoursPerDayInputField.getValue()));
a.setAverageHoursPerWeek(ECTUtil.toDBString(this._avgHoursPerWeekInputField.getValue()));a.setAverageHoursPerMonth(ECTUtil.toDBString(this._avgHoursPerMonthInputField.getValue()));a.setAverageHoursPerYear(ECTUtil.toDBString(this._avgHoursPerYearInputField.getValue()));a.setAverageWorkingDaysPerWeek(ECTUtil.toDBString(this._avgWorkingDaysPerWeekInputField.getValue()));a.setDays(this._dayTable.getWorkScheduleDays());return a},cleanup:function(){this.unregister()},validate:function(){var a=this._dayTable.validate();
if(this._startingDateSelectionField.checkForErrors()||this._nameInputField.checkForErrors()||this._checkForErrorsInAvgFields())a.isValid=!1;return a},_checkForErrorsInAvgFields:function(){return this._avgHoursPerDayInputField.checkForErrors()||this._avgHoursPerWeekInputField.checkForErrors()||this._avgHoursPerMonthInputField.checkForErrors()||this._avgHoursPerYearInputField.checkForErrors()||this._avgWorkingDaysPerWeekInputField.checkForErrors()?!0:!1}});
function WorkScheduleDayTable(a){this.register();this._init(a)}
juic.extend(WorkScheduleDayTable,juic.Component,{_init:function(a){this._config=a;this._workScheduleDays=a.workSchedule.getDays();this._mode=a.writeMode?TLMManageWorkScheduleDialogContent.MODE.CREATE:TLMManageWorkScheduleDialogContent.MODE.VIEW;this._len=7;this._items=[]},renderHtml:function(a){a.push('\x3ctable class\x3d"workSchedule" frame\x3d"below" id\x3d"'+(this.id+"_table")+'" \x3e');a.push('\x3ccol style\x3d"width: 50px"/\x3e');this._mode===TLMManageWorkScheduleDialogContent.MODE.CREATE?a.push('\x3ccol style\x3d"width: 350px"/\x3e'):
a.push('\x3ccol style\x3d"width: 250px"/\x3e');"CLOCK_TIME"===this._config.workSchedule.getTimeRecordingVariant()?(a.push('\x3ccol style\x3d"width: 91px"/\x3e'),a.push('\x3ccol style\x3d"width: 91px"/\x3e'),a.push('\x3ccol style\x3d"width: 200px"/\x3e')):a.push('\x3ccol style\x3d"width: 400px"/\x3e');this._mode===TLMManageWorkScheduleDialogContent.MODE.CREATE&&a.push('\x3ccol style\x3d"width:66px"\x3e',"\x3c/col\x3e");a.push("\x3cthead\x3e");a.push("\x3ctr\x3e");a.push("\x3cth\x3e\x3cspan\x3e",this._config.labels.day,
"\x3c/span\x3e\x3c/th\x3e");a.push("\x3cth\x3e\x3cspan\x3e",this._config.labels.category,"\x3c/span\x3e\x3c/th\x3e");"CLOCK_TIME"===this._config.workSchedule.getTimeRecordingVariant()?(a.push("\x3cth\x3e\x3cspan\x3e",MSGS.TIMEANDLABOR_WORKSCHEDULE_START_TIME,"\x3c/span\x3e\x3c/th\x3e"),a.push("\x3cth\x3e\x3cspan\x3e",MSGS.TIMEANDLABOR_WORKSCHEDULE_END_TIME,"\x3c/span\x3e\x3c/th\x3e"),a.push("\x3cth\x3e\x3cspan\x3e",MSGS.TIMEANDLABOR_WORKSCHEDULE_BREAKS,"\x3c/span\x3e\x3c/th\x3e")):a.push("\x3cth\x3e\x3cspan\x3e",
MSGS.TIMEANDLABOR_WORKSCHEDULE_DURATION,"\x3c/span\x3e\x3c/th\x3e");this._mode===TLMManageWorkScheduleDialogContent.MODE.CREATE&&a.push("\x3cth\x3e\x3c/th\x3e");a.push("\x3c/tr\x3e");a.push("\x3c/thead\x3e");a.push('\x3ctbody id\x3d"'+this.id+'_tableBody"\x3e');var b;if(this._mode===TLMManageWorkScheduleDialogContent.MODE.CREATE)for(var c=1;c<=this._len;c++)b=this._createNewRowMetadata(c),b=new WorkScheduleDayTableItem(b),b.addEventListener(TLMManageWorkScheduleDialog.EVENTS.DELETE_ROW,this,"_removeRow"),
this._items.push(b),b.renderHtml(a);else for(c=0;c<this._workScheduleDays.length;c++)b=this._createNewRowMetadata(c+1),b.workScheduleDay=this._workScheduleDays[c],b=new WorkScheduleDayTableItem(b),b.renderHtml(a),this._items.push(b);a.push("\x3c/tbody\x3e");a.push("\x3c/table\x3e");this._mode===TLMManageWorkScheduleDialogContent.MODE.CREATE&&(a.push('\x3cdiv class \x3d "addDayButton"\x3e'),a.push('\x3ca id\x3d"',this.id,'_addDay"href\x3d"javascript:void(0)" title\x3d"',MSGS.TIMEANDLABOR_WORKSCHEDULE_ADD_DAY_BUTTON,
'" class\x3d"ectAddIcon" onclick\x3d"',this.fireCode("_addNewRow"),'"\x3e',MSGS.TIMEANDLABOR_WORKSCHEDULE_ADD_DAY_BUTTON,"\x3c/a\x3e"),a.push("\x3c/div\x3e"))},_createNewRowMetadata:function(a){return{writeMode:this._config.writeMode,day:a,company:this._config.company,labels:this._config.labels,timeRecordingVariant:this._config.workSchedule.getTimeRecordingVariant()}},_addNewRow:function(){var a=this._createNewRowMetadata(this._items.length+1),a=new WorkScheduleDayTableItem(a);a.addEventListener(TLMManageWorkScheduleDialog.EVENTS.DELETE_ROW,
this,"_removeRow");this._items.push(a);if(juic.$(this.id+"_table")&&juic.$(this.id+"_tableBody")){for(var a="#"+this.id.replace(/:/g,"\\:")+"_tableBody",b=juic.createRenderContext(),c=0;c<this._items.length;c++)this._items[c].renderHtml(b);jQuery(a).html(b.join(""));for(c=0;c<this._items.length;c++)this._items[c].afterRender()}},_removeRow:function(a){var b=a.rowId,c=juic.$(this.id+"_table");if(c){c.deleteRow(b);for(var d=1;a=c.rows[d];d++)a.cells[0].innerHTML=d}this._removeItem(b)},_removeItem:function(a){this._items.splice(a-
1,1);for(var b=a;b<=this._items.length;b++)this._items[b-1].setDayNumber(b),this._items[b-1].afterRender();this._setFocusOnNextElement(a)},_setFocusOnNextElement:function(a){this._items[a-1]?this._items[a-1].setFocus():(a="#"+this.id.replace(/:/g,"\\:"),jQuery(a+"_addDay").focus())},getWorkScheduleDays:function(){for(var a=[],b=0;b<this._items.length;b++)a[b]=this._items[b].getWorkScheduleDay();return a},cleanup:function(){this.unregister()},validate:function(){var a={isValid:!0,errorMessages:[]};
if(0===this._items.length)return a.errorMessages.push(MSGS.TIMEANDLABOR_WORKSCHEDULE_NO_DAYS_DEFINED),a.isValid=!1,a;for(var b=0;b<this._items.length;b++)this._items[b].isDayItemFilled()||(a.isValid=!1);return a}});function WorkScheduleDayTableItem(a){this.register();this.init(a)}WorkScheduleDayTableItem.CATEGORY={};WorkScheduleDayTableItem.CATEGORY.DAY_MODEL="DAY_MODEL";WorkScheduleDayTableItem.CATEGORY.PLANNED_HOURS="PLANNED_HOURS";WorkScheduleDayTableItem.CATEGORY.DAY_OFF="OFF";
juic.extend(WorkScheduleDayTableItem,juic.Component,{init:function(a){this._config=a;this._workScheduleDay=a.workScheduleDay;this._day=a.day||"";this._dayModelExtCode=a.workScheduleDay?a.workScheduleDay.getDayModelExtCode():"";this._displayDurationValue="";this._config.writeMode?this._configureWriteMode(a):this._configureReadMode(a)},_configureWriteMode:function(a){this._dayTypeComboSelection=this._configureCategoryComboBox();this._selectedCategory=a.workScheduleDay?a.workScheduleDay.getCategory():
this._dayModel.value;this._dayTypeCombo=new ectComboDropDown(this._selectedCategory,{writable:this._config.writeMode,selectOptions:this._dayTypeComboSelection,label:this._config.labels.category});this._dayTypeCombo.addEventListener(ECTConstants.EVENT_CHANGE,this,"_handleDayTypeChanged");this._dayModelList=new ECTFoundationAutoComplete("",this._createAutoCompleteMetadata());this._dayModelList.addEventListener(ECTConstants.EVENT_CHANGE,this,"_handleDayModelChanged");"CLOCK_TIME"===this._config.timeRecordingVariant?
(this._startTime=new ECTHourMinuteField(null,{inputMode:ECTHourMinuteField.INPUT_MODE.CLOCK_TIME,mode:ECTHourMinuteField.MODE.BOTH_ONLY,enabled:!0,writable:!0},null),this._startTime.addEventListener("change",this,"_handleWorkingTimeChanged"),this._endTime=new ECTHourMinuteField(null,{inputMode:ECTHourMinuteField.INPUT_MODE.CLOCK_TIME,mode:ECTHourMinuteField.MODE.BOTH_ONLY,enabled:!0,writable:!0},null),this._endTime.addEventListener("change",this,"_handleWorkingTimeChanged")):this._durationInputField=
new ECTHourMinuteField(null,{mode:ECTHourMinuteField.MODE.BOTH_ONLY,enabled:!0,writable:!0},this._labelProvider);this._button=new ECTRowActionsBlock(this.id+this._day,{remove:"true"},!1);this._button.addEventListener(ECTConstants.EVENT_ACTION,this,"_handleDeleteButtonClicked");this._timeSegments=[]},_configureReadMode:function(a){this._selectedCategory=a.workScheduleDay?a.workScheduleDay.getCategory():this._dayModel.value;this._displayDurationValue=this._workScheduleDay.getFormattedHoursAndMinutes();
"CLOCK_TIME"===this._config.timeRecordingVariant&&0!==this._workScheduleDay.getWorkingTimeSegments().length&&(this._startTime=this._workScheduleDay.getWorkingTimeSegments()[0].getStartTime(),this._endTime=this._workScheduleDay.getWorkingTimeSegments()[0].getEndTime());"CLOCK_TIME"===this._config.timeRecordingVariant&&(a=this._workScheduleDay.getBreakSegments(),this._breaks=TLMFormatter.formatBreakSummary(a),this._breaksTooltip=this._createTooltipTextForBreaks(a))},_configureCategoryComboBox:function(){this._dayModel=
{label:MSGS.TIMEANDLABOR_WORKSCHEDULE_DAY_CATEGORY_DAY_MODEL,value:WorkScheduleDayTableItem.CATEGORY.DAY_MODEL};this._plannedHours={label:MSGS.TIMEANDLABOR_WORKSCHEDULE_DAY_CATEGORY_PLANNED_HOURS,value:WorkScheduleDayTableItem.CATEGORY.PLANNED_HOURS};this._dayOff={label:MSGS.TIMEANDLABOR_WORKSCHEDULE_DAY_CATEGORY_DAY_OFF,value:WorkScheduleDayTableItem.CATEGORY.DAY_OFF};return[this._dayModel,this._plannedHours,this._dayOff]},_createTooltipTextForBreaks:function(a){for(var b="No breaks",c=0;c<a.length;c++)b=
"No breaks"===b?TLMFormatter.formatBreak(a[c].getStartTime(),a[c].getEndTime(),a[c].getDuration()):b+"\n"+TLMFormatter.formatBreak(a[c].getStartTime(),a[c].getEndTime(),a[c].getDuration());return b},renderHtml:function(a){a.addAfterRenderListener(this,"afterRender");var b="dayModel";this._selectedCategory===WorkScheduleDayTableItem.CATEGORY.PLANNED_HOURS?b="plannedHours":this._selectedCategory===WorkScheduleDayTableItem.CATEGORY.DAY_MODEL?b="dayModel":this._selectedCategory===WorkScheduleDayTableItem.CATEGORY.DAY_OFF&&
(b="dayOff");a.push('\x3ctr id\x3d"',this.id,'" class\x3d"',b,'"\x3e');this._config.writeMode?this.renderRowInWriteMode(a):this.renderRowInReadMode(a);a.push("\x3c/tr\x3e")},renderRowInWriteMode:function(a){var b=this.id+"_dayModelList",c=this.id+"_displayDuration";a.push("\x3ctd\x3e",this._day,"\x3c/td\x3e");a.push('\x3ctd class\x3d"category"\x3e');a.push("\x3cspan\x3e",this._dayTypeCombo,"\x3c/span\x3e");a.push('\x3cspan id\x3d"'+b+'" class\x3d"dayModelList"\x3e',this._dayModelList,"\x3c/span\x3e");
a.push("\x3c/td\x3e");"CLOCK_TIME"===this._config.timeRecordingVariant?this.renderClockTimesColumns(a):(a.push("\x3ctd class\x3ddurationColumn\x3e"),a.push('\x3cspan class\x3d"durationInput"\x3e',this._durationInputField,"\x3c/span\x3e"),a.push('\x3cspan id\x3d"'+c+'" class\x3d"displayDuration"\x3e',this._displayDurationValue,"\x3c/span\x3e"));a.push("\x3ctd\x3e",this._button,"\x3c/td\x3e")},renderRowInReadMode:function(a){a.push("\x3ctd\x3e\x3cspan\x3e",this._day,"\x3c/span\x3e\x3c/td\x3e");a.push('\x3ctd\x3e\x3cspan class\x3d"selectedCategory"\x3e',
this._getCategoryLabelByCategory(this._workScheduleDay.getCategory()),"\x3c/span\x3e\x3c/td\x3e");"CLOCK_TIME"===this._config.timeRecordingVariant?this.renderClockTimesColumns(a):(a.push("\x3ctd class\x3ddurationColumn\x3e"),a.push('\x3cspan class\x3d"durationInput"\x3e',this._durationInputField,"\x3c/span\x3e"),a.push('\x3cspan class\x3d"displayDuration"\x3e',this._displayDurationValue,"\x3c/span\x3e"),a.push("\x3c/td\x3e"))},renderClockTimesColumns:function(a){a.push('\x3ctd\x3e\x3cspan class\x3d"tlmtime"\x3e',
this._startTime,"\x3c/span\x3e\x3c/td\x3e");a.push('\x3ctd\x3e\x3cspan class\x3d"tlmtime"\x3e',this._endTime,"\x3c/span\x3e\x3c/td\x3e");this._config.writeMode?(a.push('\x3ctd\x3e\x3cdiv class\x3d"plannedHousBreaks"\x3e'),a.push('\x3ca id\x3d"',this.id,'_breaks" href\x3d"javascript:void(0)" title\x3d"',MSGS.TIMEANDLABOR_WORKSCHEDULE_NO_BREAKS_DEFINED,'" onclick\x3d"',this.fireCode("_createNewBreaks"),'"\x3e',this._breaks||MSGS.TIMEANDLABOR_WORKSCHEDULE_NO_BREAKS_DEFINED,"\x3c/a\x3e"),a.push("\x3c/div\x3e"),
a.push('\x3cspan id\x3d"'+this.id+'_dayModelBreaks" title\x3d"'+this._breaksTooltip+'" class\x3d"tlmDayModelBreaks"\x3e',this._dayModelBreaks,"\x3c/span\x3e")):(a.push("\x3ctd\x3e"),a.push('\x3cspan id\x3d"'+this.id+'_breaks" class\x3d"tlmtime" title\x3d"'+this._breaksTooltip+'"\x3e',this._breaks,"\x3c/span\x3e"));a.push("\x3c/td\x3e")},afterRender:function(){1>this._day%2?Util.addClass(this.id,"even"):Util.removeClass(this.id,"even");this._selectedCategory===WorkScheduleDayTableItem.CATEGORY.DAY_MODEL&&
this._dayModelList&&""===this._dayModelList.getValue()&&Util.addClass(this.id,"noSelection")},_getCategoryLabelByCategory:function(a){switch(a){case "OFF":return MSGS.TIMEANDLABOR_WORKSCHEDULE_DAY_CATEGORY_DAY_OFF;case "DAY_MODEL":return MSGS.get("TIMEANDLABOR_WORKSCHEDULE_DAY_CATEGORY_DAY_MODEL_WITH_DAY_MODEL",Util.escapeHTML(this._dayModelExtCode));case "PLANNED_HOURS":return MSGS.TIMEANDLABOR_WORKSCHEDULE_DAY_CATEGORY_PLANNED_HOURS;default:return a}},setFocus:function(){this._dayTypeCombo.setFocus(!0)},
setDayNumber:function(a){this._day=a},_handleWorkingTimeChanged:function(){if(null!=this._startTime.getValue()&&this._endTime.getValue()&&this._isWorkingTimeValid()){var a=this._endTime.getValue()-this._startTime.getValue();this._hours=Math.floor(a/60);this._minutes=a%60}},_isWorkingTimeValid:function(){if(this._startTime.getValue()>=this._endTime.getValue())return this._startTime.showError(!0),this._endTime.showError(!0),!1;this._startTime.showError(!1);this._endTime.showError(!1);return!0},_createAutoCompleteMetadata:function(){var a=
{};a.label=this._config.labels.dayModel;a.id=this.id+"dayModelAutoComplete";a.required=!1;a.type="FOUNDATION_AUTOCOMPLETE";a.hasMultiple=!1;a.writable=this._config.writeMode;a.searchOptions={baseElement:"WorkScheduleDayModel",contextualSearchFields:[{fieldId:"LegalEntity",valueKey:"LegalEntity",defaultValue:""},{fieldId:"timeRecordingVariant",valueKey:"timeRecordingVariant",defaultValue:""}],customFields:[],defaultSearchValues:{LegalEntity:this._config.company||"",timeRecordingVariant:this._config.timeRecordingVariant},
propagateResultFields:null,searchType:"WorkScheduleDayModel",target:"dayModelAutoCompleteRenderer",userSysId:null,valueAttribute:null};a.dataSource="customAutoCompleteFieldController";return a},_setDurationFields:function(){var a=this._dayTypeCombo.getValue();a===WorkScheduleDayTableItem.CATEGORY.PLANNED_HOURS?(Util.removeClass(this.id,"dayModel"),Util.removeClass(this.id,"dayOff"),Util.addClass(this.id,"plannedHours")):a===WorkScheduleDayTableItem.CATEGORY.DAY_MODEL?(Util.removeClass(this.id,"plannedHours"),
Util.removeClass(this.id,"dayOff"),Util.addClass(this.id,"dayModel")):a===WorkScheduleDayTableItem.CATEGORY.DAY_OFF&&(Util.removeClass(this.id,"plannedHours"),Util.removeClass(this.id,"dayModel"),Util.addClass(this.id,"dayOff"))},_handleDayTypeChanged:function(){this._setDurationFields();this._selectedCategory=this._dayTypeCombo.getValue();this._selectedCategory===WorkScheduleDayTableItem.CATEGORY.PLANNED_HOURS||this._selectedCategory===WorkScheduleDayTableItem.CATEGORY.DAY_OFF?(Util.removeClass(this.id,
"noSelection"),this._resetData()):(""!==this._dayModelList.getValue()&&(this._dayModelExtCode=null,this._dayModelList.setValue("")),Util.addClass(this.id,"noSelection"))},_resetData:function(){if("CLOCK_TIME"===this._config.timeRecordingVariant){this._startTime.setEnabled(!0);this._startTime.setValue(0);this._endTime.setEnabled(!0);this._endTime.setValue(0);this._timeSegments=[];var a=juic.$(this.id+"_dayModelBreaks");a.innerHTML="";a.title="";a=juic.$(this.id+"_breaks");a.innerHTML=MSGS.TIMEANDLABOR_WORKSCHEDULE_NO_BREAKS_DEFINED}},
_handleDayModelChanged:function(){var a=this;Util.removeClass(this.id,"noSelection");var b=this._dayModelList.getValue();AjaxService.getMBeanInstance("tlmWorkScheduleController").getDayModelDetails(b,function(b){b=TLMFieldsHelper.DayModel.FactorByResponse(b);a._dayModelExtCode=b.getDayModelExtCode();var c=b.getTotalMinutes();a._hours=Math.floor(c/60);a._minutes=c%60;a._displayHoursAndMinutes(a._hours+":"+(10>a._minutes?"0"+a._minutes:a._minutes));a._displayStartAndEndTime(b);a._timeSegments=b.getBreakSegments();
a._displayBreaks(a._timeSegments)})},_displayStartAndEndTime:function(a){"CLOCK_TIME"===this._config.timeRecordingVariant&&(this._startTime.setEnabled(!1),this._endTime.setEnabled(!1),a=a.getWorkingTimeSegments(),0<a.length&&(this._startTime.setTime(a[0].getStartTime()),this._endTime.setTime(a[0].getEndTime())))},_displayBreaks:function(a){"CLOCK_TIME"===this._config.timeRecordingVariant&&(this._dayModelBreaks=TLMFormatter.formatBreakSummary(a),this._breaksTooltipText=this._createTooltipTextForBreaks(a),
a=juic.$(this.id+"_dayModelBreaks"),a.innerHTML=this._dayModelBreaks,a.title=this._breaksTooltipText)},_displayHoursAndMinutes:function(a){if("CLOCK_TIME"!==this._config.timeRecordingVariant){var b=juic.$(this.id+"_displayDuration");this._displayDurationValue=a;b.innerHTML=a}},_handleDeleteButtonClicked:function(){this.dispatch(TLMManageWorkScheduleDialog.EVENTS.DELETE_ROW,{rowId:this._day})},getWorkScheduleDay:function(){if(this._workScheduleDay)return this._workScheduleDay;var a=new TLMFieldsHelper.ManageWorkSchedule.Day;
a.setCategory(this._dayTypeCombo.getValue());a.setDay(this._day);var b=this._dayTypeCombo.getValue();if(b===WorkScheduleDayTableItem.CATEGORY.DAY_MODEL)this._dayModelExtCode?(a.setDayModelExtCode(this._dayModelExtCode),a.setHours(this._hours),a.setMinutes(this._minutes)):a.setDayModelExtCode("");else if(b===WorkScheduleDayTableItem.CATEGORY.PLANNED_HOURS&&"DURATION"===this._config.timeRecordingVariant){var c=this._durationInputField.getValue();a.setHours(Math.floor(c/60));a.setMinutes(c%60)}"CLOCK_TIME"===
this._config.timeRecordingVariant&&(c=[],b!==WorkScheduleDayTableItem.CATEGORY.DAY_OFF&&(b=new TLMFieldsHelper.ManageWorkSchedule.Day.TimeSegment,b.setStartTime(this._startTime.getTime()),b.setEndTime(this._endTime.getTime()),b.setCategory(TLMFieldsHelper.ManageWorkSchedule.Day.TimeSegment.WORKING_TIME),c.push(b)),a.setSegments(c.concat(this._timeSegments)));return a},_enableSaveButton:function(a){a?this.respDialog.enableButton(1):this.respDialog.disableButton(1)},isDayItemFilled:function(){return this._dayTypeCombo.getValue()===
WorkScheduleDayTableItem.CATEGORY.DAY_MODEL&&""===this._dayModelList.getValue()?(this._dayModelList.setErrorMsg(MSGS.TIMEANDLABOR_WORKSCHEDULE_FIELD_NOT_MAINAINED),!1):!0},cleanup:function(){this.unregister()},_createNewBreaks:function(){var a=new WorkScheduleDayCreateBreaksPopover({breakSegments:this._timeSegments});a.addEventListener("BREAKS_UPDATED",this,"_handleBreaksUpdated");var b=this.id+"_breaks";this._createBreaksPopover=new SFCalloutPopup({type:"hocManagerListCallout",hiddenAriaTitle:!0,
content:a,useNameAnchor:!0,hideLatency:!1,closeOnMouseout:!1});this._createBreaksPopover.show(b,{refocusRef:b,setFocusOnSelf:!0});this._createBreaksPopover.addEventListener("clickedOutsidePopup",this,"_handlePopoverClosed")},_handlePopoverClosed:function(a){"ERROR"===a.target.getContent().getStatus()&&TLMFlashMessage.ShowMessage(MSGS.TIMEANDLABOR_WORKSCHEDULE_INCORRECT_BREAK_DEFINITION,ECTConstants.STATUS_ERROR,TLMFlashMessage.LONG)},_handleBreaksUpdated:function(a){this._timeSegments=a.breakSegments;
this._breaks=TLMFormatter.formatBreakSummary(a.breakSegments);a="#"+this.id.replace(/:/g,"\\:")+"_breaks";jQuery(a).html(this._breaks);var b=this._createTooltipTextForBreaks(this._timeSegments);jQuery(a).prop("title",b)}});WorkScheduleDayCreateBreaksPopover.STATUS={};WorkScheduleDayCreateBreaksPopover.STATUS.ERROR="ERROR";WorkScheduleDayCreateBreaksPopover.STATUS.SUCCESS="SUCCESS";function WorkScheduleDayCreateBreaksPopover(a){this.register();this.init(a)}
juic.extend(WorkScheduleDayCreateBreaksPopover,juic.Component,{init:function(a){this._config=a||{};this._status=WorkScheduleDayCreateBreaksPopover.STATUS.SUCCESS;this._timeSegments=this._config.breakSegments||[];this._items=[]},renderHtml:function(a){a.addAfterRenderListener(this,"afterChange");a.push('\x3cdiv style\x3d"width: 330px;"\x3e');a.push('\x3ctable id\x3d"'+(this.id+"_breaksDefinitionTable")+'" class\x3d"tlmManageWorkScheduleBreakDefinition"\x3e');a.push("\x3cthead\x3e");a.push("\x3ctr\x3e");
a.push('\x3cth class\x3d"tlmBreakDefinitionTableColumn"\x3e',MSGS.TIMEANDLABOR_WORKSCHEDULE_START_TIME,"\x3c/th\x3e");a.push('\x3cth class\x3d"tlmBreakDefinitionTableColumn"\x3e',MSGS.TIMEANDLABOR_WORKSCHEDULE_END_TIME,"\x3c/th\x3e");a.push('\x3cth class\x3d"tlmBreakDefinitionTableColumn"\x3e',MSGS.TIMEANDLABOR_WORKSCHEDULE_DURATION,"\x3c/th\x3e");a.push("\x3cth\x3e\x3c/th\x3e");a.push("\x3c/tr\x3e");a.push("\x3c/thead\x3e");a.push('\x3ctbody id\x3d"'+this.id+'_tableBody"\x3e');for(var b,c=0;c<this._timeSegments.length;c++)b=
new WorkScheduleDayBreak({startTime:this._timeSegments[c].getStartTime(),endTime:this._timeSegments[c].getEndTime(),breakNumber:c,duration:this._timeSegments[c].getDuration()}),this._addEventListenersToWorkScheduleDayBreak(b),this._items.push(b),b.renderHtml(a);0===this._timeSegments.length&&(b=new WorkScheduleDayBreak({breakNumber:0}),this._addEventListenersToWorkScheduleDayBreak(b),this._items.push(b),b.renderHtml(a));a.push("\x3c/tbody\x3e");a.push("\x3c/table\x3e");a.push('\x3cdiv class \x3d "addDayButton"\x3e');
a.push('\x3ca id\x3d"',this.id,'_addBreakDefinition" href\x3d"javascript:void(0)" title\x3d"',MSGS.TIMEANDLABOR_WORKSCHEDULE_ADD_BREAK_BUTTON,'" class\x3d"ectAddIcon" onclick\x3d"',this.fireCode("_addNewRow"),'"\x3e',MSGS.TIMEANDLABOR_WORKSCHEDULE_ADD_BREAK_BUTTON,"\x3c/a\x3e");a.push("\x3c/div\x3e");a.push('\x3cdiv style\x3d"color:red;" id\x3d"',this.id,'_errorText"\x3e\x3c/div\x3e');a.push("\x3c/div\x3e")},afterChange:function(){if(1===this._items.length)this._items[0].setDeleteButtonInvisible(!0);
else for(var a=0;a<this._items.length;a++)this._items[a].setDeleteButtonInvisible(!1)},_addEventListenersToWorkScheduleDayBreak:function(a){a.addEventListener("BREAK_DEFINED",this,"_addNewBreakToTimeSegments");a.addEventListener(TLMManageWorkScheduleDialog.EVENTS.DELETE_BREAK_ROW,this,"_removeBreakRow")},_addNewRow:function(){var a=new WorkScheduleDayBreak({breakNumber:this._items.length});this._addEventListenersToWorkScheduleDayBreak(a);this._items.push(a);if(juic.$(this.id+"_breaksDefinitionTable")&&
juic.$(this.id+"_tableBody")){for(var a="#"+this.id.replace(/:/g,"\\:")+"_tableBody",b=juic.createRenderContext(),c=0;c<this._items.length;c++)this._items[c].renderHtml(b);jQuery(a).html(b.join(""))}this.afterChange()},_removeBreakRow:function(a){var b=juic.$(this.id+"_breaksDefinitionTable");b&&(b.deleteRow(a.breakNumber+1),this._items.splice(a.breakNumber,1),"ERROR"!==a.target.getStatus()&&this._timeSegments.splice(a.breakNumber,1),1===this._items.length&&this._items[0].setDeleteButtonInvisible(!0),
this._calculateBreakNumber());this._validateBreaks();this._isValid()&&this._status!==WorkScheduleDayCreateBreaksPopover.STATUS.ERROR&&this._showError({isValid:!0});this.dispatch("BREAKS_UPDATED",{breakSegments:this.getTimeSegments()})},_calculateBreakNumber:function(){for(var a=0;a<this._timeSegments.length;a++)this._timeSegments[a]._breakNumber=a;for(a=0;a<this._items.length;a++)this._items[a]._breakNumber=a},_validateBreaks:function(){this._status=WorkScheduleDayCreateBreaksPopover.STATUS.SUCCESS;
for(var a=0;a<this._items.length;a++)this._items[a].isBreakTimeValid()||(this._status=WorkScheduleDayCreateBreaksPopover.STATUS.ERROR)},_addNewBreakToTimeSegments:function(a){this._clearError();a.target.isBreakTimeValid()&&this._isValid()?(this._timeSegments[a.breakNumber]=a.newBreak.clone(),this.dispatch("BREAKS_UPDATED",{breakSegments:this.getTimeSegments()})):this._status=WorkScheduleDayCreateBreaksPopover.STATUS.ERROR;this._status!==WorkScheduleDayCreateBreaksPopover.STATUS.ERROR&&(this._validateBreaks(),
this._showError(a))},_clearError:function(){juic.$(this.id+"_errorText").innerHTML=""},_showError:function(a){juic.$(this.id+"_errorText").innerHTML=a.isValid&&"ERROR"!==this._status?"":a.errorMsg},_isValid:function(){for(var a=0;a<this._items.length;a++)for(var b=this._items[a],c=a+1;c<this._items.length;c++){var d=this._items[c];if(b.overlaps(d)||d.overlaps(b))d.showError(!0),this._showError({isValid:!1,errorMsg:MSGS.TIMEANDLABOR_WORKSCHEDULE_BREAK_POPOVER_OVERLAPPING}),this._status=WorkScheduleDayCreateBreaksPopover.STATUS.ERROR}return this._status!==
WorkScheduleDayCreateBreaksPopover.STATUS.ERROR?!0:!1},getTimeSegments:function(){return this._timeSegments},getStatus:function(){return this._status}});function WorkScheduleDayBreak(a){this.register();this.init(a)}
juic.extend(WorkScheduleDayBreak,juic.Component,{init:function(a){this._breakNumber=a.breakNumber;this._startTime=new ECTHourMinuteField(null,{inputMode:ECTHourMinuteField.INPUT_MODE.CLOCK_TIME,mode:ECTHourMinuteField.MODE.BOTH_ONLY,enabled:!0,writable:!0},null);this._startTime.addEventListener("change",this,"_handleWorkingTimeChanged");a.startTime&&this._startTime.setTime(a.startTime);this._endTime=new ECTHourMinuteField(null,{inputMode:ECTHourMinuteField.INPUT_MODE.CLOCK_TIME,mode:ECTHourMinuteField.MODE.BOTH_ONLY,
enabled:!0,writable:!0},null);this._endTime.addEventListener("change",this,"_handleWorkingTimeChanged");a.duration&&(this._duration=MSGS.get("TIMEANDLABOR_TIME_TITLE_MINUTES_ONLY",a.duration));a.endTime&&this._endTime.setTime(a.endTime);this._deleteButton=new ECTRowActionsBlock(this.id+this._day,{remove:"true"},!1);this._deleteButton.addEventListener(ECTConstants.EVENT_ACTION,this,"_handleDeleteButtonClicked");this._status="SUCCESS"},cleanup:function(){this.unregister()},renderHtml:function(a){a.push('\x3ctr class\x3d"tlmBreakDefinitionRow noDeleteButton" id\x3d"',
this.id,'_breakDefinitionRow"\x3e');a.push("\x3ctd\x3e",this._startTime,"\x3c/td\x3e");a.push("\x3ctd\x3e",this._endTime,"\x3c/td\x3e");a.push('\x3ctd\x3e\x3cspan id\x3d"'+this.id+'_breakDuration"\x3e',this._duration,"\x3c/span\x3e\x3c/td\x3e");a.push("\x3ctd\x3e",this._deleteButton,"\x3c/td\x3e");a.push("\x3c/tr\x3e")},_displayDuration:function(a){this._duration=MSGS.get("TIMEANDLABOR_TIME_TITLE_MINUTES_ONLY",Util.escapeHTML(a));juic.$(this.id+"_breakDuration").innerHTML=this._duration},showError:function(a){this._startTime.showError(a);
this._endTime.showError(a)},getBreak:function(){this._breakSegment||(this._breakSegment=new TLMFieldsHelper.ManageWorkSchedule.Day.TimeSegment);this._breakSegment.setCategory(TLMFieldsHelper.ManageWorkSchedule.Day.TimeSegment.UNPAID_BREAK);this._breakSegment.setStartTime(this._startTime.getTime());this._breakSegment.setEndTime(this._endTime.getTime());this._breakSegment.setDuration(this._endTime.getValue()-this._startTime.getValue());return this._breakSegment},setDeleteButtonInvisible:function(a){a?
Util.addClass(this.id+"_breakDefinitionRow","noDeleteButton"):Util.removeClass(this.id+"_breakDefinitionRow","noDeleteButton")},setStatus:function(a){this._status=a},getStatus:function(){return this._status},_handleDeleteButtonClicked:function(){this.dispatch(TLMManageWorkScheduleDialog.EVENTS.DELETE_BREAK_ROW,{breakNumber:this._breakNumber})},_handleWorkingTimeChanged:function(){if(null!=this._startTime.getValue()&&this._endTime.getValue()){if(this.isBreakTimeValid()){this._status="SUCCESS";var a=
this._endTime.getValue()-this._startTime.getValue();this._displayDuration(a);this.dispatch("BREAK_DEFINED",{newBreak:this.getBreak(),breakNumber:this._breakNumber,isValid:!0,errorMsg:MSGS.TIMEANDLABOR_WORKSCHEDULE_SEGMENT_START_TIME_GREATER_END_TIME})}else this._status="ERROR",this.dispatch("BREAK_DEFINED",{newBreak:this.getBreak(),breakNumber:this._breakNumber,isValid:!1,errorMsg:MSGS.TIMEANDLABOR_WORKSCHEDULE_SEGMENT_START_TIME_GREATER_END_TIME});this.showError("ERROR"===this._status)}},isBreakTimeValid:function(){return 0===
this._startTime.getValue()&&0===this._endTime.getValue()?!0:this._startTime.getValue()>=this._endTime.getValue()?!1:!0},overlaps:function(a){return this._startTime.getValue()>=a._startTime.getValue()&&this._startTime.getValue()<a._endTime.getValue()||this._endTime.getValue()>a._startTime.getValue()&&this._endTime.getValue()<=a._endTime.getValue()}});