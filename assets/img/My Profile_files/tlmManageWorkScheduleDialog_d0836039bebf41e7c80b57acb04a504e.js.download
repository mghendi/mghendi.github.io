function TLMManageWorkScheduleDialog(a){this._init(a)}TLMManageWorkScheduleDialog.EVENTS={};TLMManageWorkScheduleDialog.EVENTS.WORKSCHEDULE_SAVED="WORK_SCHEDULE_SAVED";TLMManageWorkScheduleDialog.EVENTS.DELETE_ROW="DELETE_ROW";TLMManageWorkScheduleDialog.EVENTS.DELETE_BREAK_ROW="DELETE_BREAK_ROW";
juic.extend(TLMManageWorkScheduleDialog,juic.EventTarget,{_init:function(a){this._config=a;this._controller=AjaxService.getMBeanInstance("tlmWorkScheduleController");this._content=new TLMManageWorkScheduleDialogContent(a);this._content.addEventListener(TLMManageWorkScheduleDialogContent.MODE.CHANGE,this,"_handleModeChange");this._cancelButton={label:MSGS.COMMON_Cancel,eventName:ECTConstants.EVENT_HIDE,active:!1};this._saveNewIWSButton={label:MSGS.COMMON_Save,eventName:ECTConstants.EVENT_SAVE,active:!0};
this._createNewIWSButton={label:MSGS.TIMEANDLABOR_WORKSCHEDULE_CREATE_NEW,eventName:ECTConstants.EVENT_SAVE_ADD,active:!1};this._okButton={label:MSGS.COMMON_Ok,eventName:ECTConstants.EVENT_HIDE,active:!0};this._dialogButton=[this._cancelButton,this._saveNewIWSButton,this._createNewIWSButton,this._okButton];this._dialogBox=new ECTDialogBox(MSGS.TIMEANDLABOR_WORKSCHEDULE_MANAGE_WORKSCHEDULE,this._content,[],900,750,!1);this._dialogBox.addEventListener(ECTConstants.EVENT_ACTION,this)},handleEvent:function(a){if(a.type===
ECTConstants.EVENT_ACTION)switch(a.actionCommand){case ECTConstants.EVENT_CLOSE:this.close();break;case ECTConstants.EVENT_SAVE:this._saveWorkSchedule();break;case ECTConstants.EVENT_SAVE_ADD:this._createNewIndividualWorkSchedule()}},_handleModeChange:function(a){if(this._dialogBox.isShown()){this._isTimeRecordingVariantConfigured=a.isTimeRecordingVariantConfigured;var b;"CREATE"===a.mode?(b=[this._cancelButton,this._saveNewIWSButton],this._dialogBox.getButtonLayout().setModel(b),this._dialogBox.setTitle(MSGS.TIMEANDLABOR_WORKSCHEDULE_CREATE_WORKSCHEDULE)):
(b=a.hasPermissionToCreateNewWS?[this._createNewIWSButton,this._okButton]:[this._okButton],this._dialogBox.getButtonLayout().setModel(b),a.name&&this._dialogBox.setTitle(MSGS.TIMEANDLABOR_WORKSCHEDULE_DISPLAY_WORKSCHEDULE+" "+a.name));this._dialogBox.setFocus()}},_saveWorkSchedule:function(){var a=this._content.validate();a.isValid?this._create():(this._content._contentTabLayout._openScheduleDetails(),0<a.errorMessages.length?TLMFlashMessage.ShowMessage(a.errorMessages[0],ECTConstants.STATUS_ERROR,
TLMFlashMessage.LONG):TLMFlashMessage.ShowMessage(MSGS.TIMEANDLABOR_WORKSCHEDULE_INVALID_INPUT,ECTConstants.STATUS_ERROR,TLMFlashMessage.LONG))},_create:function(){for(var a=this._content.getWorkSchedule(),b=[],g=this,e=0;e<a.getDays().length;e++){for(var c=a.getDays()[e],h=[],f=0;f<c.getSegments().length;f++){var d=c.getSegments()[f];h.push({startTime:d.getStartTime(),endTime:d.getEndTime(),category:d.getCategory(),duration:d.getDuration()})}b.push({day:c.getDay(),category:c.getCategory(),dayModelExtCode:c.getDayModelExtCode(),
hours:c.getHours(),minutes:c.getMinutes(),segments:h})}this._controller.createIndividualWorkSchedule(a.getUserId(),a.getExternalName(),TLMFieldsHelper.DateFormatter.format(a.getStartingDate()),a.getAverageHoursPerDay(),a.getAverageHoursPerWeek(),a.getAverageHoursPerMonth(),a.getAverageHoursPerYear(),a.getAverageWorkingDaysPerWeek(),b,a.getCountryCode(),a.getTimeRecordingVariant(),{callback:function(a){"success"!==a.result.status?(a=TLMFieldsHelper.ActionResult.FactorByResponse(a.result),TLMFlashMessage.ShowActionResult(a,
TLMFlashMessage.LONG)):(a=TLMFieldsHelper.ManageWorkSchedule.FactorByResponse(a.workSchedule),g._dialogBox.close(),g.dispatch(TLMManageWorkScheduleDialog.EVENTS.WORKSCHEDULE_SAVED,{workSchedule:a}))},errorHandler:function(){TLMFlashMessage.ShowMessage(MSGS.TIMEANDLABOR_SYSTEM_ERROR,ECTConstants.STATUS_ERROR,TLMFlashMessage.LONG)}})},_createNewIndividualWorkSchedule:function(){this._isTimeRecordingVariantConfigured&&!this._config.timeRecordingVariant?TLMFlashMessage.ShowMessage(MSGS.TIMEANDLABOR_WSF_UI_CANNOT_CREATE_IWS_NO_TIME_VARIANT_CHOSEN,
ECTConstants.STATUS_ERROR,TLMFlashMessage.LONG):this._content.renderNewIWS()},show:function(){this._dialogBox.showDialog()}});