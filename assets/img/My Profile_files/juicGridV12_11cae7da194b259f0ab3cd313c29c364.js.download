/*
 !! BEGIN /ui/juic/js/components/gridLayout/sfAbstractFocusManager.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfAbstractGridProvider.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfAbstractAxisMetaData.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfArrayGridProvider.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfGridMetaData.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfGridSpans.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfGridAllocation.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfGridLayout.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfAbstractGridRow.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfCachedItemProvider.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfGridRowProvider.js !!! !! BEGIN /ui/juic/js/components/gridLayout/sfRevolutionGrid.js !!!*/
function SFAbstractFocusManager(){assert(!1,"SFAbstractFocusManager: Do not directly call constructor")}juic.extend(SFAbstractFocusManager,juic.EventTarget,{getNextFocusableColumn:function(k,b,a){assert(!1,"SFAbstractFocusManager: Must implement getNextFocusable")},getNextFocusableRow:function(k,b){assert(!1,"SFAbstractFocusManager: Must implement getNextFocusableRow")}});function SFAbstractGridProvider(){assert(!1,"SFAbstractGridProvider: Please do not instantiate")}
extend(SFAbstractGridProvider,juic.EventTarget,{getCells:function(k,b,a,e){assert(!1,"SFAbstractGridProvider: Please override getCells")},handleStaleCell:function(k,b){},handleVisibleCell:function(k,b){},handleRemovedCell:function(k,b){}});function SFAbstractAxisMetaData(){assert(!1,"SFAbstractAxisMetaData: Do not directly call constructor")}
juic.extend(SFAbstractAxisMetaData,juic.EventTarget,{getMetaData:function(k,b){assert(!1,"SFAbstractAxisMetaData: must implement getMetaData")},getAllocationValue:function(k,b){assert(!1,"SFAbstractAxisMetaData: must implement getAllocationValue")},getIndexAtOffset:function(k){assert(!1,"SFAbstractAxisMetaData: must implement getAllocationValue")},getMinimumSize:function(){assert(!1,"SFAbstractAxisMetaData: must implement getMinimumSize")},getIndicesWithValue:function(k,b){assert(!1,"SFAbstractAxisMetaData: must implement getIndicesWithValue")},
size:function(){assert(!1,"SFAbstractAxisMetaData: must implement size")},setMetaData:function(k,b,a){},move:function(k,b,a){},remove:function(k,b){},insert:function(k,b){}});function SFArrayGridProvider(k){this._gridArray=k}
(function(){extend(SFArrayGridProvider,SFAbstractGridProvider,{getCells:function(b,a,e,d){for(var g=[],f=e;f<=d;f++){g[f-e]=[];for(var m=b;m<=a;m++)g[f-e][m-b]=this._gridArray[f]&&this._gridArray[f][m]}this.dispatch("gridAvailable",{grid:g,region:{columnFrom:b,columnTo:a,rowFrom:e,rowTo:d}})},setCellsOnAxis:function(b,a,e){for(var d=k[b],g=0;g<e.length;g++)d.setGridValue(this._gridArray,a,g,e[g]);for(var f=[],g=0;g<e.length;g++)d.setGridValue(f,a,g,e[g]);b="y"==b;this.dispatch("refreshRegion",{rowFrom:b?
0:a,rowTo:b?e.length:a,columnFrom:b?a:0,columnTo:b?a:e.length,grid:f})},setCell:function(b,a,e){k.y.setGridValue(this._gridArray,b,a,e);this.dispatch("refreshRegion",{rowFrom:b,rowTo:b,columnFrom:a,columnTo:a})}});var k={x:{type:"x",opposite:"y",setGridValue:function(b,a,e,d){b[e]=b[e]||[];b[e][a]=d}},y:{type:"x",opposite:"y",name:"row",setGridValue:function(b,a,e,d){b[a]=b[a]||[];b[a][e]=d}}}})();function SFGridMetaData(k,b){this._init(k,b)}
(function(){extend(SFGridMetaData,juic.EventTarget,{_init:function(b,a){assert(null==b||b instanceof Array||b instanceof SFAbstractAxisMetaData,"SFGridMetaData: Please use an array to specify the column meta.");assert(null==a||a instanceof Array||a instanceof SFAbstractAxisMetaData,"SFGridMetaData: Please use an array to specify the row meta.");this._columnMeta=b||[];this._rowMeta=a||[]},getRowMetaData:function(b,a){return this.getMetaData("y",b,a)},getColumnMetaData:function(b,a){return this.getMetaData("x",
b,a)},getMetaData:function(b,a,e){return this._forAxis(b,function(d){d=this[d.meta];if(null==a)return d;if(d instanceof SFAbstractAxisMetaData)return d.getMetaData(a,e);if(this.isValidIndex(b,a,!0))return d=d[a],e?d[e]:d})},getIndicesWithValue:function(b,a,e){return this._forAxis(b,function(d){d=this[d.meta];if(d instanceof SFAbstractAxisMetaData)return d.getIndicesWithValue(a,e);for(var g=[],f=0,b=d.length;f<b;f++){var n=d[f];"function"==typeof a?a.call(this,n)&&g.push(f):n[a]==e&&g.push(f)}return g})},
setRowMetaData:function(b,a,e){this.setMetaData("y",b,a,e)},setColumnMetaData:function(b,a,e){this.setMetaData("x",b,a,e)},setMetaData:function(b,a,e,d){this.isValidIndex(b,a,!0)&&this._forAxis(b,function(g){g=this[g.meta];var f;g instanceof SFAbstractAxisMetaData?(f=(f=g.getMetaData(a))&&f[e],g.setMetaData(a,e,d)):(f=g[a][e],g[a][e]=d);this.dispatch("metaDataUpdated",{axisType:b,index:a,key:e,value:d,oldValue:f})})},appendRow:function(b){this.append("y",b)},appendColumn:function(b){this.append("x",
b)},append:function(b,a){this.insert(b,a,this.size(b))},insertRow:function(b,a){this.insert("y",b,a)},insertColumn:function(b,a){this.insert("x",b,a)},insert:function(b,a,e){void 0===e&&(e=this.size(b));this.isValidIndex(b,e,!0,!0)&&this._forAxis(b,function(d){d=this[d.meta];var g=1;if(d instanceof SFAbstractAxisMetaData)g=a,d.insert(a,e);else if(a instanceof Array){for(g=0;g<a.length;g++)d.splice(e+g,0,a[g]);g=a.length}else d.splice(e,0,a);this.dispatch("intervalAdded",{axisType:b,index:e,count:g})})},
removeRow:function(b,a){this.remove("y",b,a)},removeColumn:function(b,a){this.remove("x",b,a)},remove:function(b,a,e){e=null==e?1:e;this.isValidIndex(b,a,!0)&&this.isValidIndex(b,a+e-1,!0)&&this._forAxis(b,function(d){d=this[d.meta];var g;d instanceof SFAbstractAxisMetaData?d.remove(a,e):g=d.splice(a,e);this.dispatch("intervalRemoved",{axisType:b,index:a,count:e,removed:g})})},moveRows:function(b,a,e){this.move("y",b,a,e)},moveColumns:function(b,a,e){this.move("x",b,a,e)},move:function(b,a,e,d){this._forAxis(b,
function(g){var f=this[g.meta];if(f instanceof SFAbstractAxisMetaData)f.move(a,e,d);else{var m=f.splice(a,d);m.splice(0,0,e,0);f.splice.apply(this[g.meta],m)}this.dispatch("intervalMoved",{axisType:b,fromIndex:a,toIndex:e,count:d})})},getColumnSize:function(){return this.size("x")},getRowSize:function(){return this.size("y")},size:function(b){if(b)return this._forAxis(b,function(a){a=this[a.meta];return a instanceof SFAbstractAxisMetaData?a.size():a.length});var a={};this._forEachAxis(function(b){a[b.name+
"Size"]=this.size(b.type)});return a},isValid:function(b,a,e,d){return this.isValidIndex("x",a,e,d)&&this.isValidIndex("y",b,e,d)},isValidIndex:function(b,a,e,d){return this._forAxis(b,function(g){var f=this.size(b)-(d?0:1);if(a instanceof Array){for(g=0;g<a.length;g++)if(!this.isValidIndex(b,a[g],d,e))return!1;return!0}var m=0<=a&&a<=f;e&&assert(m,"SFGridMetaData: Invalid "+g.name+" index: "+a+" not in [0, "+f+"]");return m})},_forAxis:function(b,a){var e="x"==b||"y"==b;assert(e,"SFGridMetaData: Invalid axisType "+
b);if(e)return e=k[b],a.call(this,e,k[e.opposite])},_forEachAxis:function(b){for(var a in k)this._forAxis(a,b)}});var k={x:{type:"x",opposite:"y",name:"column",index:"columnIndex",from:"columnFrom",to:"columnTo",meta:"_columnMeta"},y:{type:"x",opposite:"y",name:"row",index:"rowIndex",from:"rowFrom",to:"rowTo",meta:"_rowMeta"}}})();function SFGridSpans(){this._axisSpans={};this._allSpans=[];this._spans={}}
(function(){juic.extend(SFGridSpans,juic.EventTarget,{setMetaData:function(b){this._metaData&&(this._metaData.removeEventListener("intervalAdded",this),this._metaData.removeEventListener("intervalRemoved",this),this._metaData.removeEventListener("intervalMoved",this),this._metaData=null);b&&(this._metaData=b,this._metaData.addEventListener("intervalAdded",this,"_onIntervalAdded"),this._metaData.addEventListener("intervalRemoved",this,"_onIntervalRemoved"),this._metaData.addEventListener("intervalMoved",
this,"_onIntervalMoved"))},addSpan:function(b,a,e,d){if(1!=e||1!=d){var g=this.get(b,a),f={rowIndex:b,columnIndex:a,rowSpan:e,columnSpan:d};1<f.rowSpan&&(this._axisSpans.y=this._axisSpans.y||[],this._axisSpans.y.push(f));1<f.columnSpan&&(this._axisSpans.x=this._axisSpans.x||[],this._axisSpans.x.push(f));this._allSpans.push(f);this._addToGrid(f);this.dispatch("spanChanged",{rowIndex:b,columnIndex:a,oldSpan:g,newSpan:{rowSpan:e,columnSpan:d}})}},removeSpan:function(b,a){var e=this.get(b,a),d=this._getSpanByAxis("y",
b,a);d&&!d.extender&&(this._removeSpan(d),this._refreshGrid());this.dispatch("spanChanged",{rowIndex:b,columnIndex:a,oldSpan:e,newSpan:{rowSpan:1,columnSpan:1}})},get:function(b,a){var e=this._getSpanByAxis("y",b,a);return e?e.extender?null:{rowSpan:e.rowSpan,columnSpan:e.columnSpan}:{rowSpan:1,columnSpan:1}},isExtender:function(b,a){var e=this._getSpanByAxis("y",b,a);return e&&e.extender},getSpanOnAxis:function(b,a,e){var d="x"==b?e:a,g=this._spans&&this._spans[d]&&this._spans[d]["x"==b?a:e];return g?
g.extender?0:this._forAxis(b,function(d){return g[d.name+"Span"]}):1},getSpanOrigin:function(b,a,e){var d=this._getSpanByAxis(b,a,e);return d?(d.extender&&(d=d.origin),this._forAxis(b,function(a){return d[a.index]})):a},getRegionWithSpans:function(b,a){var e=set({},b);this._spans&&this._forEachSpanInRegion(b,null==a?!0:a,function(d){this._forEachAxis(function(a){var g=d[a.index],m=g+d[a.span]-1,n=b[a.name+"From"],k=b[a.name+"To"];if(g<=n&&m>=n||g<=k&&m>=k)e[a.name+"From"]=Math.min(e[a.name+"From"],
g),e[a.name+"To"]=Math.max(e[a.name+"To"],m)})});return e},getContainingSpan:function(b,a){return this._forAxis(b,function(e){var d=0,g=this._metaData.size(b)-1;this._forEachSpanOnLine(b,a,function(a){var f=a[e.index];a=a[e.span];1<a&&(d=Math.max(d,f),g=Math.min(g,f+a-1))});var f={};f[e.index]=d;f[e.span]=g-d+1;return f})},isValidMove:function(b,a,e,d){return this._forAxis(b,function(g,f){var m=Math.max(a+d-1,e+d-1),n=!0;if(!this._metaData.isValidIndex(b,Math.min(a,e))||!this._metaData.isValidIndex(b,
m))n=!1;else if(this._spans&&a!=e){n={};m=a+d-1;n[g.from]=a;n[g.to]=m;n[f.from]=0;n[f.to]=this._metaData.size(f.type)-1;var n=this.getRegionWithSpans(n,!1),k=n[g.from],q=n[g.to],n=!0;if(k<a||q>m)1!=d?n=!1:(n=this.getContainingSpan(b,a),n=e>=n[g.index]&&e<n[g.index]+n[g.span]);else{var t=n=e>a?e+d:e;this._forEachSpanOnLine(b,n,function(d){t=Math.min(t,d[g.index])});n=t==n}}return n})},_onIntervalAdded:function(b){var a=b.count,e=!1;this._forEachSpanIn(b.axisType,b.index+1,null,function(d,g){e=!0;d[g.index]+=
a});e&&this._refreshGrid()},_onIntervalRemoved:function(b){var a=b.axisType,e=b.index,d=b.count;if(0<d){var g=[],f=!1;this._forEachSpanIn(a,e,null,function(a,b){a[b.index]>=e&&a[b.index]<=e+d-1?g.push(a):(f=!0,a[b.index]-=d)});if(0<g.length)for(f=!0,b=0;b<g.length;b++)this._removeSpan(g[b]);f&&this._refreshGrid()}},_removeSpan:function(b){this._removeSpanFrom(b,this._allSpans);this._removeSpanFrom(b,this._axisSpans.x);this._removeSpanFrom(b,this._axisSpans.y)},_removeSpanFrom:function(b,a){if(a)for(var e=
a.length-1;0<=e;e--)if(a[e]===b){a.splice(e,1);break}},_onIntervalMoved:function(b){var a=b.axisType,e=b.fromIndex,d=b.toIndex,g=b.count;if(e!=d){var f=d-e;this._forEachSpanIn(a,Math.min(e,d),Math.max(e+g-1,d+g-1),function(d,a){d[a.index]=d[a.index]>=e&&d[a.index]<=e+g-1?d[a.index]+f:d[a.index]-(0<f?g:-g)});this._refreshGrid()}},_refreshGrid:function(){this._spans={};for(var b=0;b<this._allSpans.length;b++)this._addToGrid(this._allSpans[b])},_addToGrid:function(b){for(var a={origin:b,extender:!0},
e=b.rowIndex,d=b.columnIndex,g=0;g<b.rowSpan;g++){this._spans[e+g]=this._spans[e+g]||{};for(var f=0;f<b.columnSpan;f++)this._spans[e+g][d+f]=0==g&&0==f?b:a}},_getSpanByAxis:function(b,a,e){var d="x"==b?e:a;if(this._spans&&this._spans[d])return this._spans[d]["x"==b?a:e]},_forEachSpanOnLine:function(b,a,e){this._forEachSpanIn(b,a,a,e)},_forEachSpanIn:function(b,a,e,d){this._forAxis(b,function(g){var f=this._axisSpans[b];if(f)for(var m=0;m<f.length;m++){var n=f[m],k=n[g.index],q=k+n[g.span]-1;(null==
e?k>=a||q>=a:a>=k&&a<=q||e>=k&&e<=q||a<=k&&e>=q)&&d.call(this,n,g)}})},_forEachSpanInRegion:function(b,a,e){for(var d=0;d<this._allSpans.length;d++){var g=this._allSpans[d],f={};this._forEachAxis(function(d){var a=g[d.index],e=a+g[d.span]-1,m=b[d.from],k=b[d.to];if(a>=m&&a<=k||e>=m&&e<=k)f[d.type]=!0});(a?f.x||f.y:f.x&&f.y)&&e.call(this,g)}},_forAxis:function(b,a){var e="x"==b||"y"==b;assert(e,"SFGridMetaData: Invalid axisType "+b);if(e)return e=k[b],a.call(this,e,k[e.opposite])},_forEachAxis:function(b){for(var a in k)this._forAxis(a,
b)}});var k={x:{type:"x",opposite:"y",name:"column",index:"columnIndex",from:"columnFrom",to:"columnTo",span:"columnSpan"},y:{type:"x",opposite:"y",name:"row",index:"rowIndex",from:"rowFrom",to:"rowTo",span:"rowSpan"}}})();function SFGridAllocation(k){this._init(k)}
(function(){function k(d,a,f){if(!a||!f)return null;d=e[d];var g=a[d.name+"From"];a=a[d.name+"To"];var b=f[d.name+"From"];f=f[d.name+"To"];if(g>=b&&g<=f||a>=b&&a<=f){var k={};k[d.name+"From"]=Math.max(g,b);k[d.name+"To"]=Math.min(a,f);return k}}function b(d,g,f){var b;d&&g?(b=k("x",d,g),g=k("y",d,g),b=b&&g&&set(b,g)):b=null;if(b){g=a("x",d,b);for(var e=a("y",d,b),r=0;r<e.length;r++)f.push(set({columnFrom:d.columnFrom,columnTo:d.columnTo},e[r]));for(r=0;r<g.length;r++)f.push(set({rowFrom:b.rowFrom,
rowTo:b.rowTo},g[r]))}else f.push(set({},d))}function a(d,a,b){var g=k(d,a,b);d=e[d];b=[];var f=a[d.name+"From"];a=a[d.name+"To"];if(g){var r=g[d.name+"From"],g=g[d.name+"To"];if(f!=r){var q={};q[d.name+"From"]=f;q[d.name+"To"]=r-1;b.push(q)}a!=g&&(q={},q[d.name+"From"]=g+1,q[d.name+"To"]=a,b.push(q))}else q={},q[d.name+"From"]=f,q[d.name+"To"]=a,b.push(q);return b}juic.extend(SFGridAllocation,juic.EventTarget,{_init:function(d){this._spans=d.spans;this._innerScroll=d.innerScroll;this._axisData={};
this._forEachAxis(function(a){this._axisData[a.type]={spacingOptions:d[a.name+"Options"],adjusterSize:d.adjusterSize.x}})},setMetaData:function(d){this._metaData&&(this._metaData.removeEventListener("intervalAdded",this),this._metaData.removeEventListener("intervalRemoved",this),this._metaData.removeEventListener("intervalMoved",this),this._metaData=null);d&&(this._metaData=d,this._metaData.addEventListener("intervalAdded",this,"_onIntervalAdded"),this._metaData.addEventListener("intervalRemoved",
this,"_onIntervalRemoved"),this._metaData.addEventListener("intervalMoved",this,"_onIntervalMoved"),this._initAxisData(),this._initSpacingManagers())},_initAxisData:function(){this._forEachAxis(function(d,a){var b=this._metaData.getIndicesWithValue(d.type,"adjustable",!0),g=this.determineCenterSection(d.type);assert(g,"SFGridAllocation: Invalid frozen sections on "+d.type+"-axis.");set(a,{adjustableCount:b.length});set(a,g)})},_initSpacingManagers:function(){this._forEachAxis(function(d,a){var b=
this._metaData.getMetaData(d.type);b instanceof SFAbstractAxisMetaData||(a.spacingManager=new SFSpacingManager(b,a.spacingOptions))})},allocate:function(){assert(this._dimension,"SFGridAllocation: Dimension was not set");this._forEachAxis(function(d,a,b,e){a.lastAllocation=a.allocation;var g=a.allocation={centerStart:a.centerStart,centerEnd:a.centerEnd,adjusterSize:a.adjusterSize};if(this._innerScroll){var f=this.getMinimumSize(d.type),k=this.getMinimumSize(b.type),f=f+a.adjustableCount*a.adjusterSize,
k=k+e.adjustableCount*e.adjusterSize;a=this._dimension[d.dimension];g.scrollRequired=f>a-(k>this._dimension[b.dimension]-(f>a?b.scrollBarSize:0)?d.scrollBarSize:0)}});this._forEachAxis(function(d,a,b,e){var f=a.allocation,g=this._metaData.getMetaData(d.type),k=this._dimension[d.dimension];b=e.allocation.scrollRequired?b.scrollBarSize:0;if(g instanceof SFAbstractAxisMetaData){f.sectionTotals=[];for(g=e=a=0;3>g;g++){var m=this.getValue(d.type,"sectionTotals",g);f.sectionTotals.push(m);1!=g&&(a+=m);
e+=m}f.centerSize=this._innerScroll?Math.min(k-a,e-a+b):f.sectionTotals[1];f.outerDimension=this._innerScroll?Math.min(k,e):e}else{e=a.adjusterSize*a.adjustableCount;f.sizes=a.spacingManager.allocate(Math.max(1,k-b-e));f.cellSectionOffsets=[];f.sectionTotals=[0,0,0];for(g=0;g<f.sizes.length;g++){var x=f.sizes[g],y=this._isAdjustable(d.type,g),m=this.getSectionIndex(d.type,g),x=x+(y?a.adjusterSize:0);f.cellSectionOffsets[g]=f.sectionTotals[m];f.sectionTotals[m]+=x}d=k-f.sectionTotals[0]-f.sectionTotals[2];
b=f.sectionTotals[1]+b;f.innerDimension=a.spacingManager.getActualSize()+e;this._innerScroll?(f.centerSize=Math.min(d,b),f.outerDimension=Math.min(k,f.innerDimension)):(f.centerSize=f.sectionTotals[1],f.outerDimension=f.innerDimension)}this._innerScroll&&(f.sectionOffsets=[0],f.sectionOffsets.push(f.sectionTotals[0]),f.sectionOffsets.push(f.sectionTotals[0]+f.centerSize))});this._allocated=!0},getMinimumSize:function(a){var d=this._metaData.getMetaData(a);if(d instanceof SFAbstractAxisMetaData)return d.getMinimumSize();
var d=this._axisData[a].spacingManager,b=d.getActualSize();0==this._axisData[a].adjustableCount&&(b=0);return b||d.getMinimumSpace()},getValue:function(a,b,f){var d=this._metaData.getMetaData(a);if(d instanceof SFAbstractAxisMetaData)switch(b){case "outerDimension":case "centerSize":case "sectionOffsets":return a=this._axisData[a].allocation[b],null!=f?a[f]:a;default:return d.getAllocationValue(b,f)}else return a=this._axisData[a].allocation[b],null!=f?a[f]:a},getAdjusterSize:function(a){return this._axisData[a].adjusterSize},
setDimension:function(a){this._dimension=a},getCellDimension:function(a,b){var d={};d.width=this.getCellAxisDimension("x",b,a);d.height=this.getCellAxisDimension("y",a,b);return d},getCellAxisOffset:function(a,b,f){if(this._allocated)return this._forAxis(a,function(d,e){if(null==f){var g=this.getValue(a,"sizes",b);this._isAdjustable(a,b)&&(g+=e.adjusterSize)}else{var k=this._spans.getSpanOnAxis(a,b,f),g=this.getCellAxisDimension(a,b,f);this._isAdjustable(a,b+k-1)&&(g+=e.adjusterSize)}return g})},
getCellAxisDimension:function(a,b,f){if(this._allocated)return this._forAxis(a,function(d,e){if(null==f)return this.getValue(a,"sizes",b);for(var g=this._spans.getSpanOnAxis(a,b,f),k=0,m=0;m<g;m++)if(k+=this.getValue(a,"sizes",b+m),m+1<g)var n=this._isAdjustable(a,b+m),k=k+(n?e.adjusterSize:0);return k})},setCellDimension:function(a,b,f){var d=f&&0<f.width&&0<f.height;assert(d,"SFGridLayout: Invalid dimension");d&&this._allocated&&(this._axisData.x.spacingManager.setCustomSize(b,f.width),this._axisData.y.spacingManager.setCustomSize(a,
f.height))},setSingleDimension:function(a,b,f){this._allocated&&this._axisData[a].spacingManager.setCustomSize(b,f)},setRowHeight:function(a,b){this.setSingleDimension("y",a,b)},setColumnWidth:function(a,b){this.setSingleDimension("x",a,b)},isPositionChanged:function(a,b){return this._hasIndexChangedPosition("y",a)||this._hasIndexChangedPosition("x",b)},isSizeChanged:function(a,b){for(var d=this._spans.getSpanOnAxis("y",a,b),e=this._spans.getSpanOnAxis("x",b,a),g=0;g<d;g++)if(this._hasIndexChangedSize("y",
a+g))return!0;for(d=0;d<e;d++)if(this._hasIndexChangedSize("x",b+d))return!0;return!1},getSectionIndex:function(a,b){var d=this._axisData[a];return b<d.centerStart?0:b<=d.centerEnd?1:b<this._metaData.size(a)?2:-1},getBodySectionIndices:function(){return{rowStart:this._axisData.y.centerStart,rowEnd:this._axisData.y.centerEnd,columnStart:this._axisData.x.centerStart,columnEnd:this._axisData.x.centerEnd}},setInnerScrollInfo:function(a){this._innerScrollInfo=a},setOuterScrollInfo:function(a){this._outerScrollInfo=
a},reset:function(){this._centerRegion=null},getVisibleInfo:function(){if(this._innerScroll?!this._innerScrollInfo:!this._outerScrollInfo)return null;var d=this._centerRegion,e=this._getVisibleCenterRegion();this._centerRegion=e;var f={newRegions:[],staleRegions:[],visibleRegions:{},centerRegion:set({},e)};if(d){var k={x:a("x",e,d),y:a("y",e,d)},n={x:a("x",d,e),y:a("y",d,e)};b(e,d,f.newRegions);b(d,e,f.staleRegions);this._forEachAxis(function(a,d,b,e){function c(c,l,d){var h="x"==a.type?c:1,p="x"==
a.type?1:c;if(l&&!this.isSectionEmpty(h,p))for(c=this.getSectionAxisRegion(b.type,c),h=0;h<l.length;h++){var p=l[h],f={};f[a.name+"From"]=p[a.name+"From"];f[a.name+"To"]=p[a.name+"To"];f[b.name+"From"]=c.from;f[b.name+"To"]=c.to;d.push(f)}}c.call(this,0,k[a.type],f.newRegions);c.call(this,2,k[a.type],f.newRegions);c.call(this,0,n[a.type],f.staleRegions);c.call(this,2,n[a.type],f.staleRegions)})}else for(d=0;3>d;d++)for(var r=0;3>r;r++){var q=this._getVisibleSectionRegion(d,r,e);q&&f.newRegions.push(q)}this._forEachAxis(function(a){for(var b=
[],d=0;3>d;d++){for(var g=null,c=0;!g&&3>c;)g=this._getVisibleSectionRegion("x"==a.type?c:d,"x"==a.type?d:c,e),c++;g&&b.push({from:g[a.name+"From"],to:g[a.name+"To"]})}f.visibleRegions[a.type]=b});return f},getSectionAxisRegion:function(a,b){var d=this._axisData[a];switch(b){case 0:return 0<d.centerStart?{from:0,to:d.centerStart-1}:null;case 1:return d.centerStart<=d.centerEnd?{from:d.centerStart,to:d.centerEnd}:null;case 2:var e=this._metaData.size(a);return d.centerEnd<e-1?{from:d.centerEnd+1,to:e-
1}:null}},isSectionEmpty:function(a,b){return"x"==a||"y"==a?this._forAxis(a,function(a,d){switch(b){case 0:return 0==d.centerStart;case 2:return d.centerEnd+1>=this._metaData.size(a.type);case 1:return d.centerStart>d.centerEnd}}):this.isSectionEmpty("x",b)||this.isSectionEmpty("y",a)},isScrollRequired:function(a){return this._allocated&&this._axisData[a].allocation.scrollRequired},getAdjusterSize:function(a){return this._axisData[a].adjusterSize},getSpacingBounds:function(a,b){return this._axisData[a].spacingManager.getBounds(b)},
isAllocated:function(){return this._allocated},determineCenterSection:function(a){for(var b=this._metaData.size(a),d=this._metaData.getIndicesWithValue(a,"frozen",!0),e=-1,k=b,r=0;r<d.length;r++){var q=d[r];if(q==e+1)e++;else break}for(r=d.length-1;0<=r;r--){var q=d[r],t=!1;q==k-1&&(e==k-1?2==this._metaData.getMetaData(a,q,"sectionIndex")&&(e--,t=!0):t=!0);if(t)k--;else break}return e+b-k+1==d.length&&{centerStart:e+1,centerEnd:k-1,sectionHasCells:[0<=e,!0,k<b]}},_getVisibleCenterRegion:function(){var a=
{};this._forEachAxis(function(b,d){var e,f;if(this._innerScroll)e=this._innerScrollInfo[b.type],e=e.inverse?e.oppositePosition:e.position,f=e+this.getValue(b.type,"centerSize");else{f=this._outerScrollInfo.gridPoint[b.type];var g=this._outerScrollInfo.viewport[b.end];e=Math.max(0,this._outerScrollInfo.viewport[b.start]-f);f=g-f-this.getValue(b.type,"sectionTotals",2)-this.getValue(b.type,"sectionTotals",0)}e=this._findCellAt(b.type,e);a[b.name+"From"]=e;a[b.name+"To"]=this._findCellAt(b.type,f,e)});
var b=this._spans.getRegionWithSpans(a);this._forEachAxis(function(d,e){var f=b[d.name+"To"],g=a[d.name+"To"];a[d.name+"From"]=Math.max(e.centerStart,Math.min(b[d.name+"From"]-1,a[d.name+"From"]));a[d.name+"To"]=Math.min(e.centerEnd,Math.max(f+1,g))});return a},_findCellAt:function(a,b,e){var d=this.getSectionAxisRegion(a,1);if(d){var f=this._metaData.getMetaData(a);if(f instanceof SFAbstractAxisMetaData)return f.getIndexAtOffset(b);f=d.to;null==e&&(e=d.from);for(e+=1;e<=f;e++)if(this.getValue(a,
"cellSectionOffsets",e)>b)return e-1;return f}a=this._axisData[a];return null==e?a.centerStart:a.centerEnd},_getVisibleSectionRegion:function(a,b,e){if(!e)return null;var d={},f=!0;this._forEachAxis(function(g){var k="x"==g.type?b:a,m=this.getSectionAxisRegion(g.type,k);if(f=f&&!!m){var n=m.from,m=m.to;1==k&&(n=e[g.name+"From"],m=e[g.name+"To"]);d[g.name+"From"]=n;d[g.name+"To"]=m}});return f&&d},_onIntervalAdded:function(a){var b=a.axisType,d=a.index,e=a.count;if(0<e){a=[];for(var k=0;k<e;k++)a.push(this._metaData.getMetaData(b,
d+k));(b=this._axisData[b].spacingManager)&&b.insertMultipleInto(d,a);this._initAxisData();this._allocated&&this.allocate()}},_onIntervalRemoved:function(a){if(0<a.count){var b=this._axisData[a.axisType].spacingManager;b&&b.remove(a.index,a.count);this._initAxisData();this._allocated&&this.allocate();if(this._centerRegion){var d=a.count,e=a.index,k=e+d-1;this._forAxis(a.axisType,function(a){var b=this._centerRegion[a.name+"From"],f=this._centerRegion[a.name+"To"];b>e&&(this._centerRegion[a.name+"From"]=
Math.max(e,b-d));f>e&&(this._centerRegion[a.name+"To"]=Math.max(k,f-d))})}}},_onIntervalMoved:function(a){if(a.fromIndex!=a.toIndex){var b=this._axisData[a.axisType].spacingManager;b&&b.move(a.fromIndex,a.toIndex,a.count);this._allocated&&this.allocate()}},_hasIndexChangedPosition:function(a,b){if(this._metaData.getMetaData(a)instanceof SFAbstractAxisMetaData)return!0;var d=this._axisData[a].lastAllocation,e=this._axisData[a].allocation;return!d||e.cellSectionOffsets[b]!=d.cellSectionOffsets[b]},
_hasIndexChangedSize:function(a,b){if(this._metaData.getMetaData(a)instanceof SFAbstractAxisMetaData)return!0;var d=this._axisData[a].lastAllocation,e=this._axisData[a].allocation;return!d||e.sizes[b]!=d.sizes[b]},_forAxis:function(a,b){var d="x"==a||"y"==a;assert(d,"SFGridMetaData: Invalid axisType "+a);if(d){var d=e[a],g=e[d.opposite];return b.call(this,d,this._axisData&&this._axisData[a],g,this._axisData&&this._axisData[g.type])}},_forEachAxis:function(a){for(var b in e)this._forAxis(b,a)},_isAdjustable:function(a,
b){return this._metaData.getMetaData(a,b,"adjustable")}});var e={x:{type:"x",opposite:"y",name:"column",dimension:"width",start:"left",end:"right",scrollBarSize:17},y:{type:"y",opposite:"x",name:"row",dimension:"height",start:"top",end:"bottom",scrollBarSize:17}}})();function SFGridLayout(k){this.register();this._init(k)}
(function(){function k(c){c=c||{};var h=c.provider,a=c.metaData,p=c.columnMetaData,d=c.rowMetaData,e=c.spans,f=c.padding,g=c.innerScroll;null==g&&(g=!0);f=g?null:b(f);p&&d&&(a=new SFGridMetaData(p,d));if(!(a&&a instanceof SFGridMetaData))return assert(!1,"SFGridLayout: Must provide meta data of type SFGridMetaData"),null;if(e&&!(e instanceof SFGridSpans))return assert(!1,"SFGridLayout: spans has incorrect type."),null;e=e||new SFGridSpans;if(null!=c.adjusterSize)if(!isNaN(c.adjusterSize)&&0<c.adjusterSize)adjusterSize=
{x:c.adjusterSize,y:c.adjusterSize};else{if(c.adjusterSize.x||c.adjusterSize.y)adjusterSize={x:0<c.adjusterSize.x?c.adjusterSize.x:m,y:0<c.adjusterSize.y?c.adjusterSize.y:m}}else adjusterSize={x:m,y:m};(p=c.dimension)&&(0>=p.width||0>=p.height)&&(p=null);var d={},k;for(k in r)d[k]="undefined"==typeof c[k]?r[k]:c[k];return set({provider:h,metaData:a,dimension:p,adjusterSize:adjusterSize,spans:e,padding:f},d)}function b(c){return"number"==typeof c?{top:c,right:c,bottom:c,left:c}:{top:isNaN(c&&c.top)?
0:c.top,bottom:isNaN(c&&c.bottom)?0:c.bottom,left:isNaN(c&&c.left)?0:c.left,right:isNaN(c&&c.right)?0:c.right}}function a(c,h){return"section"+c+"-"+h}function e(c,h,l){return"x"==c?a(l,h):a(h,l)}function d(c,h){return"cell"+h+"-"+c}function g(c,h){return"section"+h+"row"+c}var f=Util.browserInfo.ios||Util.browserInfo.android,m=f?20:5;juic.Logger.getLogger("SFGridLayout");var n={},r={dragByResizing:!1,innerScroll:!0,focusable:!0,rowOptions:null,columnOptions:null,focusManager:null};extend(SFGridLayout,
juic.Component,{_init:function(c){this._initThrottles();if(c=k(c)){this._dragByResizing=c.dragByResizing;this._allocation=new SFGridAllocation(c);this._spans=c.spans;this._spans.addEventListener("spanChanged",this,"_onSpanChanged");this.setMetaData(c.metaData);this.setProvider(c.provider);this._scrollBars={};this._innerScroll=c.innerScroll;this._padding=c.padding;this._focusManager=c.focusManager;if(f&&this._innerScroll){var h=this.getAutoScroller();this._forEachAxis(function(c){this._scrollBars[c.type]=
new SFScrollBar({axisType:c.type,autoScroller:h})})}c.dimension&&this._innerScroll&&this.setDimension(c.dimension)}this._isDraggable=!0},_initThrottles:function(){this._throttles=[];for(var c in n){var h=SFThrottleUtil.register(this,c,n[c]);this._throttles.push(h)}},_onLoad:function(){f&&!f&&this._innerScroll&&SFDOMEvent.addListener(juic.$(this.id).firstChild,y,this._onMouseWheel,this);this._innerScroll?this._dimension?this._handleUpdates():this.adjustToParent():(this.attach(),this.adjustToParent());
this.dispatch("ready")},cleanup:function(){for(var c=0;c<this._throttles.length;c++)SFThrottleUtil.unregister(this._throttles[c]);this.setProvider(null);this.setMetaData(null);f&&this._forEachAxis(function(c){this._scrollBars[c.type].cleanup()});this.detach();this._super()},attach:function(){if(!this._innerScroll)"undefined"!=typeof TopNavBar&&TopNavBar.showEvent&&(TopNavBar.hideEvent.subscribe(this._onWindowResize,this,!0),TopNavBar.showEvent.subscribe(this._onWindowResize,this,!0)),SFDOMEvent.addListener(window,
"resize",this._onWindowResize,this),SFDOMEvent.addListener(window,"scroll",this._onWindowScroll,this),f&&SFDOMEvent.addListener(document,"touchmove",this._synchScroll,this);else if(this._restoreScrollPosition){var c=juic.$(this.id+a(1,1));c&&(c.scrollTop=this._restoreScrollPosition.top,c.scrollLeft=this._restoreScrollPosition.left,this._restoreScrollPosition=null,this._synchScroll())}},detach:function(c){this._innerScroll||("undefined"!=typeof TopNavBar&&TopNavBar.showEvent&&(TopNavBar.hideEvent.unsubscribe(this._onWindowResize,
this),TopNavBar.showEvent.unsubscribe(this._onWindowResize,this)),SFDOMEvent.removeListener(window,"resize",this._onWindowResize,this),SFDOMEvent.removeListener(window,"scroll",this._onWindowScroll,this),f&&SFDOMEvent.removeListener(window,"touchmove",this._synchScroll,this));var h=juic.$(this.id);h&&!c?h.parentNode.removeChild(h):this._innerScroll&&(c=juic.$(this.id+a(1,1)))&&(this._restoreScrollPosition={left:c.scrollLeft,top:c.scrollTop})},renderHtml:function(c){c.push('\x3cdiv role\x3d"grid" id\x3d"',
this.id,'" class\x3d"',"sfGridLayout",'"\x3e');this._renderContent(c);c.push("\x3c/div\x3e");c.addAfterRenderListener(this,"_onLoad")},reset:function(){this._clearGrid();this._handleUpdates()},adjustToParent:function(){var c=juic.$(this.id);if(c)if(this._innerScroll)(c=SFDom.getSuggestedDimension(c.parentNode))&&0<c.width&&0<c.height&&this.setDimension(c);else{var c=SFDom.getSuggestedDimension(c.parentNode).width,a=f?0:17,l=SFDom.getViewportHeight(),b=a&&SFDom.getDocumentHeight()<=l;this._allocation.getMinimumSize("y")>
l?this._checkWidthAndSetDimension(c-(b?a:0)):(this._checkWidthAndSetDimension(c),l=a&&SFDom.getDocumentHeight()<=SFDom.getViewportHeight(),!!b!=!!l&&(c+=(l?1:-1)*a),this._checkWidthAndSetDimension(c))}},_checkWidthAndSetDimension:function(c){0<c&&this.setDimension({width:c,height:0})},setDimension:function(c){var a=c&&(0<c.width||"auto"===c.width)&&(!this._innerScroll||0<c.height||"auto"===c.height);assert(a,"SFGridLayout: Invalid dimension");a&&(this._dimension=set({},c),this._handleUpdates())},
scrollTo:function(c,h){if(this._allocated){var l=this._innerScroll?juic.$(this.id+a(1,1)):window,b=SFDom.getScrollRegion(l);if(b){var d=SFDom.getXY(this.id+"content"),e=new SFPoint(d[0],d[1]);this._forEachAxis(function(a){var d="x"==a.type&&Util.isRTL(),p="x"==a.type?h:c;if(1==this._allocation.getSectionIndex(a.type,p)){var w=b[a.nstart],f=this._allocation.getValue(a.type,"cellSectionOffsets",p),u=this._allocation.getValue(a.type,"sizes",p),g=this._allocation.getValue(a.type,"sectionTotals",1);this._isAdjustable(a.type,
p)&&(u+=this._allocation.getAdjusterSize(a.type));d&&(f=g-f-u);p=b[a.nstart];g=b[a.dimension];if(!this._innerScroll){var z=e[a.type],k=this._allocation.getValue(a.type,"sectionTotals",0),m=this._allocation.getValue(a.type,"sectionTotals",2),n=this._padding[a.nstart],q=this._padding[a.nend];d&&(d=k,k=m,m=d);p-=z;g-=k+m+n+q}d=Math.max(p-f,0);f=Math.max(f+u-p-g,0);0<f&&0==d?SFDom.setScrollPosition(l,w+f,a.type):0<d&&0==f&&SFDom.setScrollPosition(l,w-d,a.type)}})}}},setFocus:function(c,a,l){if(this._isVisible("y",
c)&&this._isVisible("x",a))l=juic.$(this.id+d(c,a)),(l=SFDom.findNextFocusableElement(l,l,!0))&&this._focusElement(l);else{this.scrollTo(c,a,l);null!=this._focusTimeout&&clearTimeout(this._focusTimeout);var h=this;this._focusTimeout=setTimeout(function(){h._focusTimeout=null;h.setFocus(c,a)},100)}},_focusElement:function(c){c.focus();"INPUT"==c.nodeName&&"TEXT"==c.type.toUpperCase()&&setTimeout(function(){Util.browserInfo.ios?c.setSelectionRange(0,9999):c.select()},0)},getAutoScroller:function(){if(!this._autoScroller){var c;
c=this._innerScroll?this.id+a(1,1):document.body;this._autoScroller=new SFAutoScroller({scrollEl:c});this._autoScroller.addEventListener("autoScroll",this,"_synchScroll")}return this._autoScroller},getAllocation:function(){return this._allocation},getMetaData:function(){return this._metaData},setMetaData:function(c){this._metaData&&(this._metaData.removeEventListener("metaDataUpdated",this),this._metaData.removeEventListener("intervalAdded",this),this._metaData.removeEventListener("intervalRemoved",
this),this._metaData.removeEventListener("intervalMoved",this),this._metaData=null);if(c){var a=c instanceof SFGridMetaData;assert(a,"SFGridLayout: metaData must be an SFGridMetaData");a&&(this._spans.setMetaData(c),this._allocation.setMetaData(c),this._metaData=c,this._metaData.addEventListener("metaDataUpdated",this,"_onMetaDataUpdated"),this._metaData.addEventListener("intervalAdded",this,"_onIntervalAdded"),this._metaData.addEventListener("intervalRemoved",this,"_onIntervalRemoved"),this._metaData.addEventListener("intervalMoved",
this,"_onIntervalMoved"));this._clearGrid();this._handleUpdates()}},getProvider:function(){return this._provider},setProvider:function(c){this._provider&&(this._clearGrid(),this._provider.removeEventListener("gridAvailable",this),this._provider.removeEventListener("gridError",this),this._provider.removeEventListener("gridLoading",this),this._provider.removeEventListener("refreshRegion",this),this._provider=null);if(c){var a=c instanceof Array||c instanceof SFAbstractGridProvider;assert(a,"SFGridLayout: Provider must be an SFAbstractGridProvider or a 2D array");
a&&(this._provider=c instanceof Array?new SFArrayGridProvider(c):c,this._provider.addEventListener("gridAvailable",this,"_onGridAvailable"),this._provider.addEventListener("gridError",this,"_onGridError"),this._provider.addEventListener("gridLoading",this,"_onGridLoading"),this._provider.addEventListener("refreshRegion",this,"_onRefreshRegion"));this._handleUpdates()}},setPadding:function(c){if(!this._innerScroll){var a=this._padding;this._padding=b(c);a&&this._padding.top==a.top&&this._padding.right==
a.right&&this._padding.bottom==a.bottom&&this._padding.left==a.left||this._synchScroll()}},getPadding:function(){return this._padding},setColumnWidths:function(c){for(var a=0;a<c.length;a++){var l=c[a];null!=l&&this._allocation.setSingleDimension("x",a,l)}this._handleUpdates()},getSingleDimension:function(c,a){return this._allocation.getValue("x","sizes",a)},setSingleDimension:function(c,a,l){this._allocation.setSingleDimension(c,a,l);this._handleUpdates()},getBodySectionIndices:function(){return this._allocation.getBodySectionIndices()},
_onWindowResize:function(){var c=this;setTimeout(function(){c.adjustToParent()},1E3)},_onWindowScroll:function(){var c=this;this._scrollTimeout||(this._scrollTimeout=setTimeout(function(){c._scrollTimeout=null;c._synchScroll()},100))},_synchScroll:function(){var c=juic.$(this.id);if(this._allocated&&c){this._synching=!0;if(this._innerScroll){var h=this._getScrollInfo();this._forEachAxis(function(c){for(var a=0;3>a;a+=2){var l=e(c.type,1,a);SFDom.setScrollPosition(this.id+l,h[c.type].position,c.type)}});
c=juic.$(this.id+a(1,1));SFDom.updateStyle(c,this._getCenterScrollStyle());this._allocation.setInnerScrollInfo(h);this._updateScrollBars()}else{var l=SFDom.getXY(c),b=SFDom.getViewportRegion(),d=SFDom.getDocumentWidth()-b.width;Util.isRTL()&&(l[0]+=c.offsetWidth);var f;Util.isRTL()?(f=new SFPoint(d-l[0],l[1]),b=new SFRegion(b.top,d-b.left,b.bottom,d-b.right)):f=new SFPoint(l[0],l[1]);this._allocation.setOuterScrollInfo({gridPoint:f,viewport:b});this._forEachAxis(function(c){var a=this._allocation.getValue(c.type,
"outerDimension"),h=this._padding[c.start],l=this._padding[c.end],d=this._allocation.getValue(c.type,"sectionTotals",0),p=this._allocation.getValue(c.type,"sectionTotals",1),w=this._allocation.getValue(c.type,"sectionTotals",2),u=f[c.type],g=b[c.nstart],k=Math.max(h,u-g),d=k+d,a=Math.max(k,Math.min(b[c.dimension]-w-l,u+a-w-g));"top"===c.start&&a<=d&&(k=u-g);l=Math.max(0,a-d);h=Math.max(0,g+h-u);"x"==c.type&&Util.isRTL()&&(h=p-h-l);for(p=0;3>p;p++)u=juic.$(this.id+e(c.type,0,p)),g=juic.$(this.id+e(c.type,
1,p)),w=juic.$(this.id+e(c.type,2,p)),u.style[c.start]=k+"px",g.style[c.start]=d+"px",w.style[c.start]=a+"px",g.style[c.dimension]=l+"px",SFDom.setScrollPosition(g,h,c.type)})}this._populateVisibleGrid();var g=this;this._synchTimeout&&clearTimeout(this._synchTimeout);this._synchTimeout=setTimeout(function(){g._synching=!1;g._synchTimeout=null},0)}},_getCenterScrollStyle:function(){var c={};this._forEachAxis(function(a){var h=this._allocation.isScrollRequired(a.type);c["overflow-"+a.type]=h?"auto":
"hidden"});return c},_onInnerScroll:function(c,h,l){if(!this._synching){l=SFDom.getXY(this.id);var b=SFDom.getViewportRegion(),d=new SFPoint(l[0],l[1]),e=juic.$(this.id+a(c,h));this._forEachAxis(function(a){if(1==("x"==a.type?h:c)){var l=e[a.scrollPosition]-Math.max(0,b[a.start]-d[a.type]);0!=l&&("x"==a.type?window.scrollBy(l,0):window.scrollBy(0,l))}})}},_handleUpdates:function(){var c=juic.$(this.id);if(c&&this._dimension){var a=set({},this._dimension),c=SFDom.getSuggestedDimension(c.parentNode);
"auto"==a.width&&(a.width=c.width);"auto"==a.height&&(a.height=c.height);this._allocation.setDimension(a);this._allocation.allocate();this._allocated=!0;this._updateStyles();this._synchScroll();this._updateScrollBars()}},_renderContent:function(c){var a=[];a.push(this._innerScroll?"innerScroll":"outerScroll");f&&a.push("touchDevice");f&&this._innerScroll&&a.push("customScroll");c.push('\x3cdiv id\x3d"',this.id,'content"');a.length&&c.push(' class\x3d"',a.join(" "),'"');c.push(' onmousedown\x3d"',
this.fireCode("_onDragStart"),'" ontouchstart\x3d"',this.fireCode("_onDragStart"),'"\x3e');for(a=0;3>a;a++)for(var l=0;3>l;l++)this._renderSection(c,a,l);this._innerScroll&&this._forEachAxis(function(a,h){c.push('\x3cdiv id\x3d"',this.id,a.type,'scrollBG" class\x3d"',"scrollBG",'"\x3e\x3c/div\x3e');f&&(c.push('\x3cdiv id\x3d"',this.id,a.type,'customScroll"\x3e'),this._scrollBars[a.type].renderHtml(c),c.push("\x3c/div\x3e"))});c.push("\x3c/div\x3e")},_renderSection:function(c,h,l){var b=this.id+a(h,
l),d=1==h&&1==l,e=["section"];e.push((d?"center":"")+(0==h?"top":2==h?"bottom":"")+(0==l?"left":2==l?"right":"")+"Section");c.push('\x3cdiv id\x3d"',b,'" class\x3d"',e.join(" "),'"');this._innerScroll?d&&(f&&!f?c.push(' style\x3d"overflow:hidden"'):(c.push(' onscroll\x3d"',this.fireCode("_synchScroll"),'"'),SFDom.renderStyle(c,this._getCenterScrollStyle()))):c.push(' onscroll\x3d"',this.fireCode("_onInnerScroll",h,l),'"');c.push('\x3e\x3cdiv id\x3d"',b,'ext"\x3e\x3c/div\x3e\x3c/div\x3e')},setCellWrapperClass:function(c,
a,l){if(c=juic.$(this.id+d(c,a)+"content"))a=["contentWrapper cell"],l&&a.push(l),c.firstChild.className=a.join(" ")},_updateCell:function(c,a,l){var h=this._allocation.getCellDimension(a,l),b=null;c.hasChildNodes()&&(b=c.firstChild.lastChild,b.parentNode.removeChild(b));c.id=this.id+d(a,l);var e=this._metaData.getColumnMetaData(l,"css");c.className="gridCell gridCell-"+l+(e?" "+e:"");var e=juic.createRenderContext(),f=this._getCellStyle(a,l);SFDom.updateStyle(c,f);var g=this._getCellContentStyle(a,
l,h),f=this._getCellDescriptor(a,l),k=d(a,l),m=!1,n=this._metaData.getColumnMetaData(l,"headerLabelId");f.display&&"function"==typeof f.display.isFocusable&&(m=f.display.isFocusable());f.display&&"function"==typeof f.display.setHeaderLabelId&&f.display.setHeaderLabelId(n);e.push('\x3cdiv role\x3d"gridcell" id\x3d"',this.id,k,'content" class\x3d"',"cellContent",'"');SFDom.renderStyle(e,g);m||(n&&e.push(' aria-labelledby\x3d"',n,'"'),e.push(' tabindex\x3d"0"'),e.push(' onfocus\x3d"',this.fireCode("_onCellFocus",
a,l),'"'),e.push(' onblur\x3d"',this.fireCode("_onCellBlur",a,l),'"'),e.push(' onkeydown\x3d"',this.fireCode("_onArrowKeydown",a,l),'"'));e.push("\x3e");g=["contentWrapper cell"];f.display&&"function"==typeof f.display.getCellWrapperClass&&(k=f.display.getCellWrapperClass())&&g.push(k);if(b)b.className=g.join(" ");else{e.push('\x3cdiv class\x3d"',g.join(" "),'"\x3e');switch(f.status){case t:this._renderCellError(e,a,l,f.message,f.error);break;case q:this._renderCellLoading(e,a,l);break;case x:this._renderCellDisplay(e,
a,l,f.display)}e.push("\x3c/div\x3e")}e.push("\x3c/div\x3e");this._renderCellAdjusters(e,a,l,h);c.innerHTML=e.join("");b&&c.firstChild.appendChild(b);this._focusIndex&&this._focusIndex.rowIndex==a&&this._focusIndex.columnIndex==l&&(this._focusIndex=null,this.setFocus(a,l))},_renderCellDisplay:function(c,a,l,b){c.push(b)},_renderCellLoading:function(c,a,l){d(a,l);c.push('\x3cdiv class\x3d"',"cellLoading",'"');c.push('\x3e\x3cspan class\x3d"white" role\x3d"status" aria-busy\x3d"true"\x3e');c.push(MSGS.COMMON_loading,
"\x3c/span\x3e\x3c/div\x3e")},_renderCellError:function(c,a,l,b,d){c.push('\x3cdiv role\x3d"status" aria-atomic\x3d"false" class\x3d"',"cellError",'"\x3e',escapeHTML(b),"\x3c/div\x3e")},_renderCellAdjusters:function(c,a,l,b){var h=this._isAdjustable("x",l),d=this._isAdjustable("y",a);if(h||d)h&&this._renderCellAdjuster(c,"x",l,a,b),d&&this._renderCellAdjuster(c,"y",a,l,b),h&&d&&this._renderIntersection(c,a,l,b)},_renderCellAdjuster:function(c,a,l,b,e){var h;h="x"==a?d(b,l):d(l,b);l=this._getAdjusterStyle(a,
l,b,e);c.push('\x3cdiv id\x3d"',this.id,h,a,'adj" class\x3d"',"adjuster"," ",a,"adjuster",'" onselectstart\x3d"return false" unselectable\x3d"on"');SFDom.renderStyle(c,l);c.push("\x3e\x3c/div\x3e")},_renderIntersection:function(c,a,l,b){var h=d(a,l);a=this._getIntersectionStyle(a,l,b);c.push('\x3cdiv id\x3d"',this.id,h,'int" class\x3d"',"intersection",'" onselectstart\x3d"return false" unselectable\x3d"on"');SFDom.renderStyle(c,a);c.push("\x3e\x3c/div\x3e")},_clearGrid:function(){var c=juic.$(this.id);
if(c){this._forEachCell(function(c,a){this._provider&&this._provider.handleStaleCell(c,a)});c.innerHTML="";var a=juic.createRenderContext();this._renderContent(a);c.innerHTML=a.join("")}this._allocation.reset();this._centerRegion=this._visibleRegions=null},_refreshRegion:function(c){juic.$(this.id)&&this._forEachVisibleIndexIn("y",c.rowFrom,c.rowTo,function(a){this._forEachVisibleIndexIn("x",c.columnFrom,c.columnTo,function(c){this._refreshCell(a,c,!0)})})},_refreshCell:function(c,a,l){this._spans.isExtender(c,
a)||!l&&juic.$(this.id+d(c,a))||(this._createCell(c,a),this._provider.handleVisibleCell(c,a))},_createCell:function(c,a){this._allocation.getSectionIndex("y",c);var h=this._allocation.getSectionIndex("x",a),h=g(c,h);d(c,a);juic.$(this.id+h)||this._createRow(c,a);h=document.createElement("div");this._insertElementInPosition("x",h,a,c);this._updateCell(h,c,a);return h},_removeCell:function(c,a,b,e){var h=d(c,a);return(h=juic.$(this.id+h))?(this._provider.handleStaleCell(null==b?c:b,null==e?a:e),c=h.parentNode,
c.removeChild(h),c.childNodes.length==(this._focusManager?2:0)&&c.parentNode.removeChild(c),!0):!1},_createRow:function(c,a){var h=document.createElement("div");this._updateRow(h,c,this._allocation.getSectionIndex("x",a));this._insertElementInPosition("y",h,c,a);return h},_updateRow:function(c,a,b){var h=this._metaData.getRowMetaData(a,"css"),l=g(a,b);c.id=this.id+l;c.className="gridRow gridRow-"+a+(h?" "+h:"");c.setAttribute("role","row");SFDom.updateStyle(c,this._getRowStyle(a,b));h=juic.createRenderContext();
this._focusManager&&h.push('\x3cbutton class\x3d"',"rowFocusMarker"," ","leftFocusMarker",'" onfocus\x3d"',this.fireCode("_onFocusRow",a,b,"left"),'"\x3e\x3c/button\x3e\x3cbutton class\x3d"',"rowFocusMarker"," ","rightFocusMarker",'" onfocus\x3d"',this.fireCode("_onFocusRow",a,b,"right"),'"\x3e\x3c/button\x3e');if(c.hasChildNodes())for(b=document.createElement("div"),b.innerHTML=h.join(""),h=0,l=c.childNodes.length;h<l;h++)if(!this._focusManager||0!=h&&h!=l-1){var d=c.childNodes[h],e=this._getContainingCell(d);
this._updateCell(d,a,e.x)}else c.replaceChild(b.childNodes[0],c.childNodes[h]);else c.innerHTML=h.join("")},_getManipulation:function(c,h,b){function l(a){return"x"==c?juic.$(this.id+d(b,a)):juic.$(this.id+g(a,f))}var e=this._allocation.getSectionIndex(c,h),f=this._allocation.getSectionIndex("x"==c?"y":"x",b);return{getContainerEl:function(){return"x"==c?juic.$(this.id+g(b,e)):juic.$(this.id+a(e,f)).firstChild},isIndexAvailable:l,getElementAt:l,isSameSection:function(a){return 0<=a&&this._allocation.getSectionIndex(c,
a)==e},ignoreFirstLast:this._focusManager&&"x"==c}},_moveElements:function(c,a,b,d,e){if(a!=b){c=this._getManipulation(c,a,e);e=c.getContainerEl.call(this);for(b=b<a?b:b+d;null!==b;)if(c.isSameSection.call(this,b))if(c.isIndexAvailable.call(this,b))break;else b++;else b=null;if(b=null===b?c.ignoreFirstLast?e.lastChild:null:c.getElementAt.call(this,b))for(var h=a;h<a+d;h++){var l=c.getElementAt.call(this,h);l&&e.insertBefore(l,b)}else for(h=a;h<a+d;h++)(l=c.getElementAt.call(this,h))&&e.appendChild(l)}},
_insertElementInPosition:function(c,a,b,d){var h=this._getManipulation(c,b,d);c=h.getContainerEl.call(this);var l=null,e=!0;if(d=h.getElementAt.call(this,b))c.replaceChild(a,d);else{if(c.hasChildNodes()){d=function(c){h.isSameSection.call(this,c)?h.isIndexAvailable.call(this,c)&&(e=!0,l=c):(e=!1,l=c)};for(var f=1;null===l;)d.call(this,b-f),null===l&&d.call(this,b+f),f++}d=!1;null!==l&&(b=l<b,e?(d=h.getElementAt.call(this,l),d=b?d.nextSibling:d):b&&(d=c.firstChild,h.ignoreFirstLast&&(d=d.nextSibling)));
d?c.insertBefore(a,d):h.ignoreFirstLast?c.insertBefore(a,c.lastChild):c.appendChild(a)}},_cssMetaData:function(c,a,b,d){b="y"==c?"gridRow":"gridCell";d=this._metaData.getMetaData(c,a,"css");var h=b+" "+b+"-"+a+(d?" "+d:"");this._forEachElementOnLine(c,a,function(c){c.className=h})},_updateStyles:function(){this._updateContentStyle();this._updateScrollStyle();this._forEachSection(this._updateSectionStyle);this._forEachCell(this._updateCellStyle);this._forEachRow(this._updateRowStyle)},_updateContentStyle:function(){var c=
juic.$(this.id+"content");this._forEachAxis(function(a){var b=this._allocation.getValue(a.type,"outerDimension");c.style[a.dimension]="x"==a.type&&this._dimension&&"auto"==this._dimension.width?"auto":b+"px"})},_updateSectionStyle:function(c,b){var h=a(c,b),d=juic.$(this.id+h);if(this._allocation.isSectionEmpty(c,b))d.style.display="none";else{var e=juic.$(this.id+h+"ext");this._forEachAxis(function(a,h){var l="x"==a.type?b:c,p="x"==a.type?c:b,g=0;this._innerScroll&&1==l&&(1!=p||f)&&this._allocation.isScrollRequired(h.type)&&
(g=a.scrollBarSize);p=1==l?this._allocation.getValue(a.type,"centerSize"):this._allocation.getValue(a.type,"sectionTotals",l);g=this._allocation.getValue(a.type,"sectionTotals",l)+g;e.style[a.dimension]=g+"px";this._innerScroll&&(l=this._allocation.getValue(a.type,"sectionOffsets",l),d.style[a.dimension]=p+"px",d.style[a.start]=l+"px")});d.style.display=""}},_updateCellStyle:function(c,a){var b=this._allocation.getCellDimension(c,a),h=this._allocation.isSizeChanged(c,a),e=this._allocation.isPositionChanged(c,
a);if(h||e){var e=d(c,a),f=this._getCellStyle(c,a);f&&SFDom.updateStyle(this.id+e,f);(f=this._getCellContentStyle(c,a,b))&&SFDom.updateStyle(this.id+e+"content",f);this._updateAdjusterStyle(c,a,b);h&&this._notifySizeChange(c,a)}},_updateRowStyle:function(c,a){var b=juic.$(this.id+g(c,a));b&&SFDom.updateStyle(b,this._getRowStyle(c,a))},_updateAdjusterStyle:function(c,a,b){var h=!0,l=d(c,a);this._forEachAxis(function(d,e){var f="x"==d.type?a:c,p="x"==d.type?c:a,g=this._isAdjustable(d.type,f);if(g){var w=
this.id+l+d.type+"adj",f=this._getAdjusterStyle(d.type,f,p,b);SFDom.updateStyle(w,f)}h=h&&g});if(h){var e=this._getIntersectionStyle(c,a,b);SFDom.updateStyle(this.id+l+"int",e)}},_updateScrollStyle:function(){this._innerScroll&&this._forEachAxis(function(c,a){var b=this._allocation.isScrollRequired(c.type),h=this._allocation.isScrollRequired(a.type),d=juic.$(this.id+c.type+"scrollBG");b?(b=this._allocation.getValue(a.type,"sectionOffsets",2)-a.scrollBarSize,d.style[a.start]=b+"px",d.style[a.dimension]=
a.scrollBarSize+"px",d.style[c.start]="0px",d.style[c.dimension]=this._allocation.getValue(c.type,"outerDimension")+"px",d.style.display=""):d.style.display="none";f&&(d=juic.$(this.id+c.type+"customScroll"))&&(h=h?a.scrollBarSize:0,b=this._allocation.getValue(a.type,"sectionOffsets",2)-a.scrollBarSize,h=this._allocation.getValue(c.type,"centerSize")-h,d.style.position="absolute",d.style[c.start]=this._allocation.getValue(c.type,"sectionOffsets",1)+"px",d.style[c.dimension]=h+"px",d.style[a.start]=
b+"px")})},_getRowStyle:function(c,a){if(this._allocated)return this._forAxis("y",function(b,h){var d={"margin-top":"",width:this._allocation.getValue(h.type,"sectionTotals",a)+"px",top:this._allocation.getValue(b.type,"cellSectionOffsets",c)+"px"};d[h.start]=0;return d})},_getCellStyle:function(c,a){if(this._allocated){var b={top:0},h=v.x.start;b["margin-"+h]="";b[h]=this._allocation.getValue("x","cellSectionOffsets",a)+"px";return b}},_getCellContentStyle:function(c,a,b){if(this._allocated){c=set({},
b);for(var h in c)c[h]+="px";return c}},_getAdjusterStyle:function(c,a,b,d){if(this._allocated){var h={};this._forAxis(c,function(c,a){h[c.start]=d[c.dimension]+"px";h[a.start]=0;h[a.dimension]=d[a.dimension]+"px"});return h}},_getIntersectionStyle:function(c,a,b){if(this._allocated)return c={top:b.height+"px"},c[v.x.start]=b.width+"px",c},_notifySizeChange:function(c,a){},_onSpanChanged:function(c){juic.$(this.id)&&this._centerRegion&&this._updateCellStyle(c.rowIndex,c.columnIndex)},_onIntervalAdded:function(c){juic.$(this.id)&&
this._centerRegion&&this._forAxis(c.axisType,function(a,b){var h=c.index,d=c.count;this._reindexCells(a.type,h,d);for(var l=this._visibleRegions[a.type],e=[],f=0;f<l.length;f++){var g=l[f];(g.from<=h&&g.to>=h||g.from<=h+d-1&&g.to>=h+d-1)&&e.push({from:Math.max(g.from,h),to:Math.min(g.to,h+d-1)})}h=this._visibleRegions[b.type];d=[];for(f=0;f<h.length;f++)for(var l=h[f],k=0;k<e.length;k++)g={},g[a.name+"From"]=e[k].from,g[a.name+"To"]=e[k].to,g[b.name+"From"]=l.from,g[b.name+"To"]=l.to,d.push(g);this._handleRegions(d,
null);this._updateStyles();this._synchScroll()})},_onIntervalRemoved:function(c){if(juic.$(this.id)&&this._centerRegion){for(var a=c.index,b=c.count,d=c.axisType,e="x"==d?"y":"x",f=0;f<b;f++){var g=a+f;this._forEachVisibleIndex(e,function(c){var a="x"==d?c:g;c="x"==d?g:c;this._removeCell(a,c)&&this._provider.handleRemovedCell(a,c)})}this._reindexCells(c.axisType,a+b,-b);this._updateStyles();this._synchScroll()}},_reindexCells:function(c,a,b){if(this._centerRegion){var h=this._allocation.getVisibleInfo(),
e=this._metaData.size(c),l=this._visibleRegions;this._centerRegion=h.centerRegion;this._visibleRegions=h.visibleRegions;this._forEachVisibleIndexIn(c,a,a+e,function(a){var h=a+b;if(this._isVisible(c,h))if("y"==c)for(var e=0;3>e;e++){var f=juic.$(this.id+g(a,e));f&&this._updateRow(f,h,e)}else this._forEachVisibleIndex("y",function(c){var b=juic.$(this.id+d(c,a));b&&this._updateCell(b,c,h)},l.y);else e="x"==c?"y":"x",this._forEachVisibleIndex(e,function(h){var d="x"==c?h:a;h="x"==c?a:h;this._removeCell(d,
h,d+("x"==c?0:b),h+("x"==c?b:0))},l[e])},l[c],0<b);this._handleRegions(h.newRegions,h.staleRegions)}},_onMetaDataUpdated:function(c){var a=this["_"+c.key+"MetaData"];"function"==typeof a&&a.call(this,c.axisType,c.index,c.value,c.oldValue)},_onIntervalMoved:function(c){if(juic.$(this.id)&&this._centerRegion&&c.fromIndex!=c.toIndex){var a=c.axisType,b=c.fromIndex,d=c.toIndex,e=c.count;if(this._focusIndex){var f=this._focusIndex[a],g=Math.max(b+e,d+e);f>=Math.min(b,d)&&f<g&&(this._focusIndex[a]=f>=b&&
f<b+e?d+e-1:f+(b>d?1:-1)*e)}this["x"==a?"_moveColumns":"_moveRows"](b,d,e);this.dispatchEvent(c)}},_moveColumns:function(c,a,b){this._forAxis("x",function(h,d){function e(h){return h>=l&&h<=f?h>=c&&h<c+b?h+a-c:h+b*(a<c?1:-1):h}var l=Math.min(c,a),f=Math.max(c,a)+b-1;this._forEachVisibleIndex("y",function(d){var g=this._getManipulation(h.type,c,d);this._moveElements(h.type,c,a,b,d);for(var p=[],k=l;k<=f;k++)p[k]=g.getElementAt.call(this,k);for(k=l;k<=f;k++)if(g=p[k]){var w=e(k);this._updateCell(g,
"x"==h.type?d:w,"x"==h.type?w:d)}});this._forEachPosition(function(c){c[h.name+"index"]=e(c[h.name+"index"])})})},_moveRows:function(c,a,b){this._forAxis("y",function(h,d){this._metaData.size(d.type);for(var e=0;3>e;e++){var l=this._allocation.getSectionAxisRegion("x",e);if(l){var f=l.from,l=this._getManipulation(h.type,c,f);this._moveElements(h.type,c,a,b,f);for(var f=Math.min(c,a),g=Math.max(c,a)+b-1,p=[],k=f;k<=g;k++)p[k]=l.getElementAt.call(this,k);for(k=f;k<=g;k++)this._updateRow(p[k],k>=c&&
k<c+b?k-c+a:k+b*(a<c?1:-1),e)}}})},_onGridAvailable:function(c){var a=c.region;this._grid=[];for(var b=a.rowFrom;b<=a.rowTo;b++)for(var d=a.columnFrom;d<=a.columnTo;d++)this._setCellDescriptor(b,d,{status:x,display:c.grid[b-a.rowFrom][d-a.columnFrom]});this._refreshRegion(a);delete this._grid},_onGridError:function(c){var a=c.region;this._grid=[];for(var b=a.rowFrom;b<=a.rowTo;b++){this._grid[b]=this._grid[b]||[];for(var d=a.columnFrom;d<=a.columnTo;d++)this._setCellDescriptor(b,d,{status:t,message:c.message,
message:c.error})}this._refreshRegion(a);delete this._grid},_onGridLoading:function(c){this._refreshRegion(c.region)},_setCellDescriptor:function(c,a,b){this._grid=this._grid||[];this._grid[c]=this._grid[c]||[];this._grid[c][a]=b},_getCellDescriptor:function(c,a){return this._grid&&this._grid[c]&&this._grid[c][a]||{status:q}},_onRefreshRegion:function(c){this._onGridAvailable(c)},_onCellFocus:function(c,a){this._focusIndex={rowIndex:c,columnIndex:a};this.setFocus(c,a)},_onCellBlur:function(c,a){var b=
this;setTimeout(function(){var d=b._focusIndex;d&&d.rowIndex==c&&d.columnIndex==a&&(b._focusIndex=null)},0)},_onArrowKeydown:function(c,a,b){b=SFDOMEvent.getKeyName(b||window.event);var d=!1,h=c,e=a;switch(b){case "ARROWUP":h=c-1;d=!0;break;case "ARROWDOWN":h=c+1;d=!0;break;case "ARROWLEFT":e=a-1;d=!0;break;case "ARROWRIGHT":e=a+1,d=!0}d&&0<=h&&h<this._metaData.getRowSize()&&0<=e&&e<this._metaData.getColumnSize()&&this.setFocus(h,e)},_onFocusRow:function(c,a,b,d){if(this._focusManager){var h=this._getVisibleRange("x",
a),e=this._allocation.getSectionAxisRegion("x",a),h=(a="left"==b)?h.from:h.to,e=a?e.from:e.to,l=this._focusManager.getNextFocusableColumn(c,h,a),f=c;null==l&&(f=this._focusManager.getNextFocusableRow(c,a),null!=f&&(l=this._focusManager.getNextFocusableColumn(f,null,a)));if(null!=f&&null!=l)if(h!=e){c=SFDOMEvent.getTarget(d||window.event);c.blur();SFDOMEvent.stopEvent(d||window.event);var g=this;setTimeout(function(){g.setFocus(f,l,b)},0)}else this.setFocus(f,l);else c=SFDOMEvent.getTarget(d||window.event),
c.blur()}},_onDragStart:function(c){"touchstart"==c.type&&1<c.touches.length||(this._onAdjusterDragStart(c),this._onReorderDragStart(c))},_onReorderDragStart:function(c){var a=SFDOMEvent.getTarget(c||window.event);this._forEachAxis(function(b,d){if(SFDom.hasClass(a,b.name+"Handle")){var h=this._getContainingCell(a),e=this._spans.getSpanOnAxis(b.type,h[b.type],h[d.type]);this._reorder={iIndex:h[b.type],jIndex:h[d.type],count:e,iAxisType:b.type};this._dragType="reorder";SFDragDropMgr.handleDragStart(c,
this,{useShim:!0,shimCursor:b.cursor})}})},_handleReorderDragEvent:function(c){var a=this._reorder.iAxisType,b=c.point[a]-(c.origin||c.point)[a];"x"==a&&Util.isRTL()&&(b=-b);if(this.isDraggable())switch(c.type){case "dragStart":this._handleReorderDragStart();break;case "drag":this._handleReorderDrag(b);break;case "dragEnd":this._handleReorderDrop(b)}},_handleReorderDragStart:function(){for(var c=this._reorder.iAxisType,a=this._reorder.iIndex,b=this._reorder.count,d=0;d<b;d++)this._forEachElementOnLine(c,
a+d,function(c,a){SFDom.addClass(c,a.name+"Dragging")})},_handleReorderDrag:function(c){var a=this._reorder.iAxisType;this._forAxis(a,function(b,d){for(var h=this._reorder.iIndex,e=this._reorder.jIndex,l=this._reorder.count,f=0;f<l;f++)this._forEachElementOnLine(a,h+f,function(a,b){SFDom.setStyle(a,"margin-"+b.start,c+"px")});var g=null==this._lastDropIndex?h:this._lastDropIndex,k=this._findDropIndex(c),f=Math.min(g,k),g=Math.max(g+l-1,k+l-1);this._isAdjustable(a,h);for(e=this._allocation.getCellAxisOffset(a,
h,e);f<=g;f++)if(f<h||f>h+l-1){var p=e;f<h&&f<k?p=0:f>h+l-1&&(p=f>k+l-1?0:-1*p);this._forEachElementOnLine(a,f,function(c){SFDom.setStyle(c,"margin-"+b.start,p?p+"px":"")})}this._lastDropIndex=k})},_handleReorderDrop:function(c){var a=this._reorder.iAxisType,b=this._reorder.iIndex,d=this._reorder.jIndex,e=this._reorder.count,f=this._findDropIndex(c);this._forAxis(a,function(h){var l=0,g=0,k;if(f>b){var p=f+e;p==this._metaData.size(a)?(k=this._allocation.getValue(a,"cellSectionOffsets",p-1),k+=this._allocation.getValue(a,
"sizes",p-1)):k=this._allocation.getValue(a,"cellSectionOffsets",p);k-=this._allocation.getCellAxisOffset(a,b,d)}else k=this._allocation.getValue(a,"cellSectionOffsets",f);for(var w=[],u=0;u<e;u++)w[u]=this._allocation.getValue(a,"cellSectionOffsets",b);f!=b&&this._metaData.move(a,b,f,e);var m={};m["margin-"+h.start]=0;this._animating=!0;for(u=0;u<e;u++)this._forEachElementOnLine(a,f+u,function(a){SFDom.setStyle(a,"margin-"+h.start,c-k+w[u]+"px");SFDom.addClass(a,h.name+"Dragging");l++;SFAnimUtil.animate(a,
m,{complete:function(){SFDom.removeClass(a,h.name+"Dragging");SFDom.setStyle(a,"margin-"+h.start,"");++g==l&&(this._animating=!1)},context:this})})})},_findDropIndex:function(c){var a=this._reorder.iAxisType;return this._forAxis(a,function(b,d){for(var h=this._reorder.iIndex,e=this._reorder.count,l=0>c?-1:1,f=this._allocation.getSectionIndex(a,h),f=this._allocation.getSectionAxisRegion(a,f),f=0<l?f.to:f.from,g=0,k=Math.abs(c),p=0,m=h;m!=f+l;m+=l){if(this._spans.isValidMove(a,h,m,e)){var n=Math.abs(g-
Math.abs(c));if(k<n)break;p=m;k=n}g+=this._allocation.getValue(b.type,"sizes",m)}return p})},_getContainingCell:function(a){var c=null;for(this._cellRegex=this._cellRegex||new RegExp("^"+this.id+"cell(\\d+)-(\\d+)$");a&&a.id!=this.id&&!(c=this._cellRegex.exec(a.id));)a=a.parentNode;return c?{x:parseInt(c[1]),y:parseInt(c[2])}:null},handleDragEvent:function(a){switch(this._dragType){case "adjuster":this._handleAdjusterDragEvent(a);break;case "touchScroll":this._handleTouchScrollEvent(a);break;case "reorder":this._handleReorderDragEvent(a)}switch(a.type){case "dragStart":this._dragging=
!0;break;case "dragEnd":this._dragType=null;var c=this;setTimeout(function(){c._dragging=!1},50)}},_onAdjusterDragStart:function(a){var c=SFDOMEvent.getTarget(a||window.event);this._adjusterRegex=this._adjusterRegex||new RegExp("^"+this.id+"cell(\\d+)-(\\d+)(xadj|yadj|int)$");var b=this._adjusterRegex.exec(c.id);if(b){var d=null,c=parseInt(b[1]),e=parseInt(b[2]),f=this._spans.get(e,c);f&&(e+=f.rowSpan-1,c+=f.columnSpan-1);b=b[3];switch(b){case "xadj":case "yadj":d="xadj"==b?"x":"y";c="x"==d?c:e;this._adjusterInfo=
{};this._adjusterInfo[d]={index:c,originalSize:this._allocation.getValue(d,"sizes",c)};d=v[d].cursor;break;case "int":this._adjusterInfo={x:{index:c,originalSize:this._allocation.getValue("x","sizes",c)},y:{index:e,originalSize:this._allocation.getValue("y","sizes",e)}},d="move"}this._dragType="adjuster";SFDragDropMgr.handleDragStart(a,this,{useShim:!0,clickTimeThreshold:0,shimCursor:d})}},_handleAdjusterDragEvent:function(a){switch(a.type){case "dragStart":this._adjusting=!0;this._adjusterOrigin=
a.origin;this._handleAdjusterDrag(a);break;case "drag":this._handleAdjusterDrag(a);break;case "dragEnd":this._handleAdjusterDrag(a,!0),this.dispatch("sizeAdjusted",{adjusterInfo:this._adjusterInfo}),this._adjusting=!1,this._adjusterInfo=this._adjusterOrigin=null}},_handleAdjusterDrag:function(a,b){b=null==b?this._dragByResizing:b;var c=SFDom.getXY(this.id);this._forEachAxis(function(d){var e="x"==d.type?c[0]:c[1],h=this._adjusterInfo[d.type];if(null!=h){var f=this._getAdjustedSize(d.type,a.point[d.type]);
b?(this._hideHoveringLine(d),this._allocation.setSingleDimension(d.type,h.index,f)):this._showHoveringLine(d.type,a.point[d.type],e)}});b&&this._handleUpdates()},_getAdjustedSize:function(a,b){var c=this._adjusterInfo[a];if(null!=c){var d=b-this._adjusterOrigin[a];"x"==a&&Util.isRTL()&&(d=-d);var d=c.originalSize+d,e=this._allocation.getSpacingBounds(a,c.index);c=e.minSize;e=e.maxSize;return null!=c&&d<c?c:null!=e&&d>e?e:d}},_showHoveringLine:function(a,b,d){this._forAxis(a,function(a,c){var e=juic.$(this.id+
a.type+"adjuster"),h=b-d,f=!e;f?(e=document.createElement("div"),e.id=this.id+a.type+"adjuster",e.className="hoveringLine "+a.type+"hoveringLine",e.style[c.start]=0):e.style.display="block";e.style[c.dimension]=this._allocation.getValue(c.type,"outerDimension")+"px";e.style[a.start]=h+"px";f&&juic.$(this.id).firstChild.appendChild(e)})},_hideHoveringLine:function(a){(a=juic.$(this.id+a.type+"adjuster"))&&(a.style.display="none")},_handleTouchScrollEvent:function(a){var c=this.getAutoScroller(),b=
c.getScrollInfo();switch(a.type){case "dragStart":this._startPosition=b;break;case "drag":var d={};this._forEachAxis(function(c){d[c.type]=this._startPosition[c.type].position-(a.point[c.type]-a.origin[c.type])});c.setScrollPosition(d.x,d.y);break;case "dragEnd":this._touchDrag=!1}},_onMouseWheel:function(a){var c=0;a=a||window.event;a.wheelDelta?(c=a.wheelDelta/120,window.opera&&(c=-c)):a.detail&&(c=-a.detail/3);for(var b=a.axis==a.VERTICAL_AXIS?"y":"x",d=50*(0>c?1:0<c?-1:0),e=juic.$(this.id),f=
SFDOMEvent.getTarget(a);f!=e;){if("auto"==(SFDom.getStyle(f,"overflow-"+b)||SFDom.getStyle(f,"overflow"))&&canScrollMove(f,b,d))return;f=f.parentNode}c&&this._allocation.isScrollRequired(b)&&(c=[d],"x"==b?c.push(0):c.splice(0,0,0),b=this.getAutoScroller(),b.scrollMove.apply(b,c)&&SFDOMEvent.stopEvent(a))},_updateScrollBars:function(){f&&this._innerScroll&&this._forEachAxis(function(a){this._scrollBars[a.type].adjustDOM()})},_populateVisibleGrid:function(){var a=this._allocation.getVisibleInfo();a&&
(this._centerRegion=a.centerRegion,this._visibleRegions=a.visibleRegions,this._handleRegions(a.newRegions,a.staleRegions))},_handleRegions:function(a,b){if(a)for(var c=0;c<a.length;c++){var d=a[c];this._provider.getCells(d.columnFrom,d.columnTo,d.rowFrom,d.rowTo)}if(b)for(c=0;c<b.length;c++)for(var d=b[c],e=d.rowFrom;e<=d.rowTo;e++)for(var h=d.columnFrom;h<=d.columnTo;h++)this._removeCell(e,h)},_getScrollInfo:function(){return this.getAutoScroller().getScrollInfo()},_isAdjustable:function(a,b){return this._metaData.getMetaData(a,
b,"adjustable")},_forAxis:function(a,b){var c="x"==a||"y"==a;assert(c,"SFGridMetaData: Invalid axisType "+a);if(c)return c=v[a],b.call(this,c,v[c.opposite])},_forEachCell:function(a){this._forEachVisibleIndex("x",function(c){this._forEachVisibleIndex("y",function(b){this._spans.isExtender(b,c)||a.call(this,b,c)})})},_forEachPosition:function(a){this._forEachCell(function(c,b){a.call(this,{rowIndex:c,columnIndex:b})})},_forEachVisibleIndex:function(a,b,d){if(d=d||this._visibleRegions&&this._visibleRegions[a])for(a=
0;a<d.length;a++)for(var c=d[a],e=c.from;e<=c.to;e++)b.call(this,e)},_forEachVisibleIndexIn:function(a,b,d,e,f,g){if(f=f||this._visibleRegions&&this._visibleRegions[a])if(g)for(a=f.length-1;0<=a;a--){var c=f[a];g=Math.max(c.from,b);c=Math.min(c.to,d);if(g<=c)for(var h=c;h>=g;h--)e.call(this,h)}else for(a=0;a<f.length;a++)if(c=f[a],g=Math.max(c.from,b),c=Math.min(c.to,d),g<=c)for(h=g;h<=c;h++)e.call(this,h)},_forEachRow:function(a){for(var c=0;3>c;c++)this._allocation.isSectionEmpty("y",c)||this._forEachVisibleIndex("y",
function(b){a.call(this,b,c)})},_forEachAxis:function(a){for(var c in v)this._forAxis(c,a)},_forEachSection:function(a){for(var c=0;3>c;c++)for(var b=0;3>b;b++)a.call(this,c,b)},_forEachElementOnLine:function(a,b,e){var c=v[a];if("y"==a)for(a=0;3>a;a++){if(!this._allocation.isSectionEmpty("x",a)){var h=juic.$(this.id+g(b,a));h&&e.call(this,h,c)}}else this._forEachVisibleIndex("y",function(a){(a=juic.$(this.id+d(a,b)))&&e.call(this,a,c)})},_isVisible:function(a,b){if(1==this._allocation.getSectionIndex(a,
b)){var c=this._centerRegion;return this._forAxis(a,function(a){var d=c[a.name+"To"];return c[a.name+"From"]<=b&&d>=b})}return!0},_getVisibleRange:function(a,b){if(1==b){var c=this._centerRegion;return this._forAxis(a,function(a){return{from:c[a.name+"From"],to:c[a.name+"To"]}})}return this._allocation.getSectionAxisRegion(a,b)},setDraggable:function(a){this._isDraggable=a},isDraggable:function(){return this._isDraggable}});document.createElement("div");var q="unavailable",t="error",x="available",
y=Util.browserInfo.ff?"DOMMouseScroll":"mousewheel",v={x:{type:"x",opposite:"y",cursor:"col-resize",name:"column",dimension:"width",start:Util.isRTL()?"right":"left",end:Util.isRTL()?"left":"right",nstart:"left",nend:"right",scrollPosition:"scrollLeft",scrollBarSize:17,getPageDimension:"getDocumentWidth",offsetDimension:"offsetWidth"},y:{type:"y",opposite:"x",cursor:"row-resize",name:"row",dimension:"height",start:"top",end:"bottom",nstart:"top",nend:"bottom",scrollPosition:"scrollTop",scrollBarSize:17,
getPageDimension:"getDocumentWidth",offsetDimension:"offsetHeight"}}})();function SFAbstractGridRow(){assert(!1,"SFAbstractGridRow: Do not directly construct")}juic.extend(SFAbstractGridRow,juic.EventTarget,{cleanup:function(){},getColumnContent:function(k,b){assert(!1,"SFAbstractGridRow: Must implement getColumnContent")},getChanges:function(){},setChanges:function(k){},getRowId:function(){},handleVisibleColumn:function(k){},handleStaleColumn:function(k){}});
function SFCachedItemProvider(k,b){this._init(k,b)}
(function(){function k(a,b,d){a&&null!=a.startIndex&&(d=b,b=a.endIndex,a=a.startIndex);if(0<=b&&a<=b){var e=[];for(a=Math.floor(a/d);a*d<=b;)e.push(a),a++;return e}juic.assert(!1,"SFCachedItemProvider: Invalid pagination");return null}var b={pageSize:10,queueSize:100};juic.extend(SFCachedItemProvider,SFAbstractItemProvider,{_init:function(a,e){var d;d=e||{};var g={},f;for(f in b)g[f]="undefined"==typeof d[f]?b[f]:d[f];e=g;this.setItemProvider(a);this._pageSize=e.pageSize;this._queueSize=e.queueSize;
this._cacheId=0},cleanup:function(){this.clear();this._itemProvider&&(this._itemProvider.removeEventListener("itemsAvailable",this),this._itemProvider.removeEventListener("itemsError",this))},getItems:function(a){this.refresh(a.startIndex,a.endIndex);if(!this._handleRequest(a)){this._requests.push(a);for(var b=k(a,this._pageSize),d=0;d<b.length;d++){var g=b[d];if(!this._cachedPages[g]){this._cachedPages[g]={status:"unavailable"};var f=set({},a);f.cacheId=this._cacheId;f.startIndex=g*this._pageSize;
f.endIndex=f.startIndex+this._pageSize-1;f.pageSize=this._pageSize;f.pageIndex=g;f.pageNumber=g+1;this._itemProvider.getItems(f)}}}},setItemProvider:function(a){this._itemProvider&&(this._itemProvider.removeEventListener("itemsAvailable",this),this._itemProvider.removeEventListener("itemsError",this));if(this._itemProvider=a)this._itemProvider.addEventListener("itemsAvailable",this,"_onItemsAvailable"),this._itemProvider.addEventListener("itemsError",this,"_onItemsError");this.clear()},clear:function(){if(this._cacheQueue)for(;!this._cacheQueue.empty();){var a=
this._cacheQueue.dequeue();this._handleStalePage(a,this._cachedPages[a])}this._cacheId++;this._cachedPages=[];this._cacheQueue=new Queue;this._requests=[];this._itemCount=null},refresh:function(a,b){for(var d=k(a,b,this._pageSize),e=0;e<d.length;e++){var f=d[e],m=this._cachedPages[f];m&&"unavailable"!=m.status&&this._cacheQueue.requeue(f)}},getCachedItem:function(a){var b=k(a,a,this._pageSize)[0],b=this._cachedPages[b];a%=this._pageSize;return b&&"available"==b.status&&b.items&&b.items.length<a?b.items[a]:
null},forEachCachedItem:function(a,b){for(var d in this._cachedPages){var e=this._cachedPages[d];if("available"==e.status)for(var f=e.items,k=0;f&&k<f.length;k++)a.call(b,f[k],e.startIndex+k)}},getPagedItems:function(a,b,d){return d.length>this._pageSize?d.slice(a,b+1):d},_onItemsAvailable:function(a){juic.assert(a.pagination,"SFCachedItemProvider: itemsAvailable event missing pagination object.");if(a.pagination&&a.pagination.cacheId==this._cacheId){var b=k(a.pagination,this._pageSize)[0],d=a.pagination.startIndex,
g=a.pagination.endIndex;this._cachedPages[b]={status:"available",items:this.getPagedItems(d,g,a.items||[]),startIndex:d,endIndex:g,itemCount:a.itemCount};this._updateQueue(b);this._itemCount=this._itemCount||a.itemCount;this._checkRequests()}},_onItemsError:function(a){juic.assert(a.pagination,"SFCachedItemProvider: itemsError event missing pagination object.");if(a.pagination&&a.pagination.cacheId==this._cacheId){var b=k(a.pagination,this._pageSize)[0];this._cachedPages[b]={status:"error",startIndex:a.pagination.startIndex,
endIndex:a.pagination.endIndex,message:a.message,error:a.error};this._updateQueue(b);this._checkRequests()}},_updateQueue:function(a){for(this._cacheQueue.enqueue(a);this._cacheQueue.size()>this._queueSize;){a=this._cacheQueue.dequeue();var b=this._cachedPages[a];b&&this._handleStalePage(a,b);delete this._cachedPages[a];delete b}},_handleStalePage:function(a,b){switch(b.status){case "available":this.dispatch("stalePage",{index:a,startIndex:b.startIndex,endIndex:b.endIndex,items:b.items});break;case "error":this.dispatch("staleError",
{index:a,index:a,startIndex:b.startIndex,endIndex:b.endIndex,message:b.message,error:b.error})}},_checkRequests:function(){for(var a=0;a<this._requests.length;)this._handleRequest(this._requests[a],!0)||a++},_handleRequest:function(a,b){for(var d=k(a,this._pageSize),e="available",f=null,m=0;m<d.length;m++){var n=this._cachedPages[d[m]];if(!n||"unavailable"==n.status){e=!1;break}else if("error"==n.status){e=n.status;f=n;break}}if(e)if(b&&this._requests.shift(),"error"==e)this.dispatch("itemsError",
{message:f.message,error:f.error,pagination:a});else{for(var f=[],r=0,q,m=0;m<d.length;m++)n=this._cachedPages[d[m]],q=n.items,f=f.concat(q),isNaN(n.itemCount)||(r=Math.max(r,n.itemCount)),q=q.length;d=a.startIndex;m=q-a.endIndex%this._pageSize-1;0<d&&f.splice(0,d%this._pageSize);0<m&&f.splice(f.length-m,m);this.dispatch("itemsAvailable",{items:f,itemCount:r,pagination:a})}return!!e}})})();function SFGridRowProvider(k,b,a){this._init(k,b,a)}
juic.extend(SFGridRowProvider,SFAbstractGridProvider,{_init:function(k,b,a){this._metaData=b;this._cachedProvider=new SFCachedItemProvider(k,a);this._cachedProvider.addEventListener("stalePage",this,"_onStalePage");this._cachedProvider.addEventListener("itemsAvailable",this,"_onItemsAvailable");this._cachedProvider.addEventListener("itemsError",this,"_onItemsError")},reset:function(){delete this._changes;this._cachedProvider.clear()},cleanup:function(){this._cachedProvider.cleanup();this._cachedProvider.removeEventListener("stalePage",
this);this._cachedProvider.removeEventListener("itemsAvailable",this);this._cachedProvider.removeEventListener("itemsError",this);delete this._cachedProvider},getRowCount:function(){this._cachedProvider.getItems({rowCount:!0,startIndex:0,endIndex:0})},getCells:function(k,b,a,e){this._loaded=!1;this._cachedProvider.getItems({startIndex:a,endIndex:e,columnFrom:k,columnTo:b});this._loaded||this.dispatch("gridLoading",{region:{columnFrom:k,columnTo:b,rowFrom:a,rowTo:e}})},getCellContent:function(k,b,
a){return b instanceof SFAbstractGridRow?b.getColumnContent(k,a):b instanceof Array?b[a.index]:null},handleVisibleCell:function(k,b){var a=this.getCachedRow(k);a instanceof SFAbstractGridRow&&a.handleVisibleColumn(this._metaData.getColumnMetaData(b))},handleStaleCell:function(k,b){var a=this.getCachedRow(k);a instanceof SFAbstractGridRow&&a.handleStaleColumn(this._metaData.getColumnMetaData(b))},cleanupRow:function(k,b){if(b instanceof SFAbstractGridRow){var a=b.getChanges();if(a){var e=b.getRowId();
null==e&&(e=k);this._changes=this._changes||{};this._changes[e]=a}b.cleanup()}else if(b instanceof Array)for(a=0;a<b.length;a++)e=b[a],e instanceof Component&&e.cleanup(),delete b[a],delete e;delete b},setChanges:function(k){this._changes=k;this._cachedProvider.forEachCachedItem(function(b,a){if(b instanceof SFAbstractGridRow){var e=b.getRowId();null==e&&(e=a);b.setChanges(this._changes&&this._changes[e])}},this)},getChanges:function(){this.forEachCachedItem(function(k,b){if(k instanceof SFAbstractGridRow){var a=
k.getChanges();if(null!=a){var e=k.getRowId();null==e&&(e=b);this._changes=this._changes||{};this._changes[e]=a}}},this);return this._changes},forEachCachedItem:function(k,b){this._cachedProvider.forEachCachedItem(k,b)},getCachedRow:function(k){return this._cachedProvider.getCachedItem(k)},setItemProvider:function(k){this._cachedProvider.setItemProvider(k)},_onStalePage:function(k){var b=k.items;k=k.startIndex;for(var a=0;a<b.length;a++)this.cleanupRow(k+a,b[a])},_onItemsAvailable:function(k){var b=
k.pagination;if(b.rowCount)this.dispatch("rowCountAvailable",{rowCount:k.itemCount});else{this._loaded=!0;for(var a=[],e=b.startIndex;e<=b.endIndex;e++){var d=e-b.startIndex,g=k.items[d];if(g instanceof SFAbstractGridRow){var f=g.getRowId();null==f&&(f=e);if(f=this._changes&&this._changes[f])g.setChanges(f),delete this._changes[e]}a[d]=[];for(f=b.columnFrom;f<=b.columnTo;f++){var m=f-b.columnFrom,n=this._metaData.getColumnMetaData(f);a[d][m]=this.getCellContent(e,g,n)}}this.dispatch("gridAvailable",
{grid:a,rowCount:k.itemCount,region:{rowFrom:b.startIndex,rowTo:b.endIndex,columnFrom:b.columnFrom,columnTo:b.columnTo}})}},_onItemsError:function(k){k.pagination.rowCount?this.dispatch("rowCountError",{message:k.message,error:k.error}):this.dispatch("gridError",{region:{message:k.message,error:k.error,rowFrom:k.startIndex,rowTo:k.endIndex,columnFrom:k.columnFrom,columnTo:k.columnTo}})}});function SFRevolutionGrid(k,b,a){this.register();this._init(k,b,a)}
(function(){function k(a,b,d){this._metaData=a;this._rowProvider=new SFGridRowProvider(b,a,{pageSize:d.pageSize,queueSize:d.queueSize});this._rowProvider.addEventListener("gridAvailable",this,"_handleGridEvent");this._rowProvider.addEventListener("gridError",this,"_handleGridEvent");this._rowProvider.addEventListener("gridLoading",this,"_handleGridEvent");this._rowProvider.addEventListener("rowCountAvailable",this,"_onRowCountAvailable");this._rowProvider.addEventListener("rowCountError",this,"dispatchEvent");
this._groupLookup=d.groupLookup;this._headerSize=(this._hasGroups=d.hasGroups)?2:1;this._footerSize=(this._hasFooter=d.hasFooter)?1:0;this._rowCount=0}function b(a){this._group=a;this.register()}function a(a){this._definition=a;this._sortable=a.sortable;this._label=a.label;this._label instanceof Component&&this._label.addEventListener("action",this,"_handleLabelAction");this.register()}function e(a){this._headerSize=(this._hasGroups=a.hasGroups)?2:1;this._groupHeight=a.groupHeight;this._headerHeight=
a.headerHeight;this._totalHeader=a.headerHeight+(this._hasGroups?a.groupHeight:0);this._footerSize=(this._hasFooter=a.hasFooter)?1:0;this._footerHeight=this._hasFooter?a.footerHeight:0;this._rowHeight=a.rowHeight;this._rowCount=1}function d(a,b){this._hasSortable=a.hasSortable;this._headerSize=(this._hasGroups=a.hasGroups)?2:1;this._footerSize=(this._hasFooter=a.hasFooter)?1:0;this._focusManager=a.focusManager;this._metaData=b;this._rowCount=0}function g(){}function f(c){var b;switch(typeof c){case "string":b=
set({label:c},v);break;case "number":b=set({fixedSize:c},v);break;case "object":b={};for(var d in v){var e=v[d],f=c[d];"label"!=d||f||(f=c.title);if("undefined"!=typeof f||null!=e)b[d]="undefined"==typeof f?e:f}break;default:b=set({},v)}b.header=new a(b);b.headerLabelId=b.header.getHeaderLabelId();return b}var m=juic.Logger.getLogger("SFRevolutionGrid"),n=SFRevolutionGrid.UP="up",r=SFRevolutionGrid.DOWN="down",q=RegExp("(?:^|\\s)sortedColumn sort(?\x3d |$)","g"),t=RegExp("(?:^|\\s)sortUp(?\x3d |$)",
"g"),x=RegExp("(?:^|\\s)sortDown(?\x3d |$)","g"),y={dragByResizing:!0,innerScroll:!1,dimension:null,rowHeight:31,groupHeight:31,headerHeight:31,footerHeight:31,padding:0,pageSize:10,queueSize:100,focusManager:null,header:null,footer:null,columnAdjustmentType:null,columnBounded:!1,errorMessage:MSGS.COMMON_AJAX_DEFAULT_ERROR,noResultsMessage:MSGS.COMMON_No_Results},v={id:void 0,size:null,minSize:150,maxSize:null,fixedSize:void 0,groupId:void 0,label:void 0,footer:void 0,frozen:!1,adjustable:!1,sortable:!1,
css:void 0,weight:void 0};juic.extend(SFRevolutionGrid,juic.Component,{_init:function(a,b,f){if(this._validate.apply(this,arguments)){var c,h=a;c=f||{};var g={},l;for(l in y)g[l]="undefined"==typeof c[l]?y[l]:c[l];if((l=c.groups)&&l instanceof Array){c={};for(var m=0;m<l.length;m++){g.hasGroups=!0;var n=l[m],n={id:n.id||m,css:n.css||n.id||m,label:n.label||n.title,title:n.title,collapsible:n.collapsible,collapsed:n.collapsed};c[n.id]=n}g.groupLookup=c}else if((c=c.groupLookup)&&"object"==typeof c){l=
{};for(m in c)g.hasGroups=!0,n=c[m],l[m]={id:m,css:n.css||n.id,label:n.label||n.title};g.groupLookup=l}else g.groupLookup={};if(h instanceof Array&&0<h.length){c=l=!1;for(m=0;m<h.length&&!l;m++)l=!(!h[m]||!h[m].footer),c=!(!h[m]||!h[m].sortable);g.hasFooter=l;g.hasSortable=c}f=g;this._ready=!1;this._innerScroll=f.innerScroll;this._headerSize=(this._hasGroups=f.hasGroups)?2:1;this._footerSize=(this._hasFooter=f.hasFooter)?1:0;this._innerScroll=f.innerScroll;this._groupLookup=f.groupLookup;this._options=
f;this._rowMeta=new e(f);h=this._createColumnMetaData(a);this._metaData=new SFGridMetaData(h,this._rowMeta);f.focusManager&&(this._focusManager=new d(f,this._metaData));this._header=f.header;this._footer=f.footer;this._gridProvider=new k(this._metaData,b,f);this._gridProvider.addEventListener("rowCountAvailable",this,"_onRowCountAvailable");this._gridProvider.addEventListener("rowCountError",this,"_onError");this._gridProvider.addEventListener("gridError",this,"_onError");this._layout=new SFGridLayout({metaData:this._metaData,
provider:this._gridProvider,spans:this._spans,padding:f.padding,dragByResizing:f.dragByResizing,innerScroll:f.innerScroll,dimension:f.dimension,focusManager:this._focusManager,columnOptions:{adjustmentType:f.columnAdjustmentType,bounded:f.columnBounded}});this._layout.addEventListener("ready",this,"_onReady");this._layout.addEventListener("intervalMoved",this,"_onIntervalMoved");this._layout.addEventListener("sizeAdjusted",this,"_onSizeAdjusted");this._gridProvider.setAllocation(this._layout.getAllocation());
this._wrappers=!this._innerScroll&&(this._header||this._footer);this._showLoading()}},renderHtml:function(a){a.push('\x3cdiv id\x3d"',this.id,'" class\x3d"',"sfRevolutionGrid globalTable",'"\x3e');this._header&&a.push('\x3cdiv id\x3d"',this.id,'header" class\x3d"',"gridHeader",'"\x3e',this._header,"\x3c/div\x3e");a.push('\x3cdiv id\x3d"',this.id,'content"\x3e',this._layout,"\x3c/div\x3e");this._footer&&a.push('\x3cdiv id\x3d"',this.id,'footer" class\x3d"',"gridFooter",'"\x3e',this._footer,"\x3c/div\x3e");
a.push("\x3c/div\x3e");a.addAfterRenderListener(this,"_onLoad")},attach:function(){this._layout.attach();this._wrappers&&(SFDOMEvent.addListener(Util.isFiori3HeaderEnabled()?Util.getGlobalPlacemat():window,"scroll",this._adjustWrapper,this),SFDOMEvent.addListener(window,"resize",this._adjustWrapper,this))},detach:function(a){this._layout.detach(a);this._wrappers&&(SFDOMEvent.removeListener(Util.isFiori3HeaderEnabled()?Util.getGlobalPlacemat():window,"scroll",this._adjustWrapper,this),SFDOMEvent.removeListener(window,
"resize",this._adjustWrapper,this));a||(a=juic.$(this.id))&&a.parentNode.removeChild(a)},cleanup:function(){this.detach();for(var a=0,b=this._metaData.getColumnSize();a<b;a++)this._metaData.getColumnMetaData(a).header.removeEventListener("action",this);this._header instanceof Component&&this._header.cleanup();this._footer instanceof Component&&this._footer.cleanup();this._layout&&this._layout.cleanup();this._gridProvider.removeEventListener("rowCountAvailable",this);this._gridProvider.removeEventListener("rowCountError",
this);this._gridProvider&&this._gridProvider.cleanup();this._error&&this._error.cleanup();this._super()},getColumnWidth:function(a){return this._layout.getSingleDimension("x",a)},setPadding:function(a){this._layout.setPadding(a)},setColumnWidth:function(a,b){this._layout.setSingleDimension("x",a,b)},setColumnWidths:function(a){this._layout.setColumnWidths(a)},_onLoad:function(){this._gridProvider.getRowCount();this.attach()},sortBy:function(a,b){for(var c=this._metaData.getIndicesWithValue("x",function(a){return(a=
a.css)&&0<=a.indexOf("sortedColumn sort")}),d=0;d<c.length;d++){var e=c[d],f=this._metaData.getColumnMetaData(e,"css"),f=f.replace(q,""),f=f.replace(t,""),f=f.replace(x,"");this._metaData.setColumnMetaData(e,"css",f);this._metaData.getColumnMetaData(e,"header").setDirection(null)}if(f=this._metaData.getColumnMetaData(a,"css"))f=f.replace(q,""),f=f.replace(t,""),f=f.replace(x,"");f=(f?f+" ":"")+"sortedColumn sort "+(b==r?"sortDown":"sortUp");this._metaData.setColumnMetaData(a,"css",f);this._metaData.getColumnMetaData(a,
"header").setDirection(b);this._ready&&(this._gridProvider.reset(),this._layout.reset())},reset:function(){this._rowCount=null;this._ready=!1;this._gridProvider.reset();this._showLoading();this._gridProvider.getRowCount();this._layout.reset()},setItemProvider:function(a){a instanceof SFAbstractItemProvider?(this._gridProvider.setItemProvider(a),juic.$(this.id)&&this.reset()):assert(!1,"SFRevolutionGrid: Invalid itemProvider")},getColumnMetaData:function(a,b){return this._metaData.getColumnMetaData(a,
b)},removeColumn:function(a,b){this._metaData.removeColumn(a,b)},insertColumn:function(a,b){if(Array.isArray(a)){var c=[];a.forEach(function(a,d){var e=f(a);e.header.addEventListener("action",this,"_onHeaderAction");c.push(juic.set(e,{index:b+d}))},this);this._metaData.insertColumn(c,b);for(var d=0,e=this._metaData.getColumnSize();d<e;d++)this._metaData.setColumnMetaData(d,"index",d)}else this.insertColumn([a],b)},adjustToParent:function(){if(this._innerScroll){var a=SFDom.getSuggestedDimension(juic.$(this.id).parentNode);
a&&0<a.width&&0<a.height&&this._layout.setDimension(a)}else this._layout.adjustToParent()},setDimension:function(a){this._layout.setDimension(a)},getChanges:function(){return this._gridProvider.getChanges()},forEachCachedItem:function(a,b){this._gridProvider.forEachCachedItem(a,b)},setChanges:function(a){this._gridProvider.setChanges(a)},getRowCount:function(){return this._rowCount},setCellWrapperClass:function(a,b,d){this._layout.setCellWrapperClass(a+this._headerSize,b,d)},_onRowCountAvailable:function(a){this._rowCount=
a.rowCount;this.dispatch("init");this._focusManager&&this._focusManager.setRowCount(this._rowCount);0<this._rowCount?(this._gridProvider.setBodyContent(null),this._layout.setDraggable(!0),a=this._layout.getBodySectionIndices(),this._spans.removeSpan(this._headerSize,a.columnStart),this._hasFooter&&this._metaData.removeRow(this._headerSize+1,1),this._metaData.removeRow(this._headerSize,1),this._metaData.insertRow(this._rowCount,this._headerSize),this._hasFooter&&this._metaData.insertRow(this._rowCount,
this._headerSize+this._rowCount)):(this._layout.setDraggable(!1),this._showMessageInBody(this._options.noResultsMessage));this._ready=!0},_onReady:function(){this._wrappers&&this._adjustWrapper()},_adjustWrapper:function(){juic.$(this.id)&&(this._header&&this._adjustWrapperElement("header"),this._footer&&this._adjustWrapperElement("footer"))},_adjustWrapperElement:function(a){var c=juic.$(this.id),b=juic.$(this.id+a),d=juic.$(this.id+a+"proxy"),e=juic.$(this.id+a+"spacer"),f=d&&e?"fixed":"static",
g="static"==f?b:e,k=SFDom.getY(c),m=k+c.offsetHeight,n=SFDom.getY(g),g=g.offsetHeight+SFDom.getMargin(g),q=SFDom.getDocumentScrollTop(),r=SFDom.getViewportHeight(),r=q+r,t,v;switch(a){case "header":v=m-q>g;t=n>=q;break;case "footer":v=r-k>g,t=n+g<=r}k=this._layout.getPadding()||{};k["header"==a?"top":"bottom"]=g;this._layout.setPadding(k);t=!t&&v?"fixed":"static";if(f!=t)switch(t){case "static":c.removeChild(e);c.insertBefore(b,d);c.removeChild(d);break;case "fixed":e=document.createElement("div"),
d=document.createElement("div"),set(e,{id:this.id+a+"spacer",style:{height:g+"px"}}),set(d,{id:this.id+a+"proxy",className:a+"Proxy"}),c.insertBefore(e,b),c.insertBefore(d,b),d.appendChild(b)}},_onError:function(a){a.error&&m.error(a.error);this._showMessageInBody(this._options.errorMessage)},_clearContentRows:function(a){a=this._metaData.getRowSize();a>this._headerSize+this._footerSize&&(this._metaData.removeRow(this._headerSize,a-this._headerSize-this._footerSize),this._rowMeta.setRowCount(0),this._focusManager&&
this._focusManager.setRowCount(0))},_createRowMetaData:function(a){var c=[];this._hasGroups&&c.push({css:"groupRow",fixedSize:a.groupHeight||a.rowHeight,frozen:!0});c.push({css:"headerRow",fixedSize:a.rowHeight,frozen:!0});this._hasFooter&&c.push({css:"footerRow row",fixedSize:a.footerHeight||a.rowHeight,frozen:!0,sectionIndex:2});return c},_createColumnMetaData:function(a){var c,d,e=[];this._spans=new SFGridSpans;for(var g=0;g<a.length;g++){var k=set(f(a[g]),{index:g});k.header.addEventListener("action",
this,"_onHeaderAction");var m=k.groupId,n=m&&this._groupLookup[m],q=!1;n?(m==c?(n.addColumns.push(k),k.group=d,n.count++,n.collapsed&&!n.collapsible&&assert(!1,"SFRevolutionGrid: Cannot have a collapsed group that is not collapsible"),n.collapsible&&n.collapsed&&(q=!0)):n.count?(k.groupId=null,assert(!1,"SFRevolutionGrid: All grouped columns must be together: "+m)):(n.firstColumn=k,n.addColumns=[],d=new b(n),d.addEventListener("action",this,"_onGroupAction"),k.group=d,n.count=1,n.startIndex=g),c=
m):m&&(assert(!1,"SFRevolutionGrid: Group id does not exist: "+m),k.groupId=null);k.groupId&&(k.css="groupedColumn"+(n.css?" "+n.css:""));q||e.push(k)}for(g=0;g<e.length;g++)(n=this._groupLookup[e[g].groupId])&&1<n.count&&!n.collapsed&&(this._spans.addSpan(0,g,1,n.count),g+=n.count-1);for(m in this._groupLookup)n=this._groupLookup[m],n.count||(assert(!1,"SFRevolutionGrid: A group was provided but it did not have any columns "+m),delete this._groupLookup[m]);return e},_showLoading:function(){this._showMessageInBody(new g)},
_showMessageInBody:function(a){var c=this._layout.getBodySectionIndices();this._gridProvider.reset();this._gridProvider.setBodyContent(a||new g);this._spans.removeSpan(this._headerSize,c.columnStart);this._hasFooter&&this._metaData.removeRow(this._headerSize+1,1);this._clearContentRows();this._spans.addSpan(this._headerSize,c.columnStart,1,c.columnEnd-c.columnStart+1);this._metaData.insertRow(1,this._headerSize);this._hasFooter&&this._metaData.insertRow(1,this._headerSize+1)},_onHeaderAction:function(a){a.columnIndex=
this._metaData.getIndicesWithValue("x","index",a.columnDefinition.index)[0];this.dispatchEvent(a)},_onGroupAction:function(a){var c=a.group;a=a.collapsed;var b=this._metaData.getIndicesWithValue("x","index",c.firstColumn.index);null!=b&&0<b.length?(b=b[0],1<c.count&&(a?(this._spans.removeSpan(0,b),this._metaData.removeColumn(b+1,c.count-1)):(this._spans.addSpan(0,b,1,c.count),this._metaData.insertColumn(c.addColumns,b+1)))):assert(!1,"SFRevolutionGrid: Invalid group, first column not found")},_validate:function(a,
b,d){a=a instanceof Array&&0<a.length;b=b instanceof SFAbstractItemProvider;assert(a,"SFRevolutionGrid: Columns must be a non-empty array");assert(b,"SFRevolutionGrid: The itemProvider is not the correct type");return a&&b},_onIntervalMoved:function(a){"x"==a.axisType&&this.dispatch("columnMoved",{fromIndex:a.fromIndex,toIndex:a.toIndex,count:a.count})},_onSizeAdjusted:function(a){a.adjusterInfo.x&&(a=a.adjusterInfo.x.index,this.dispatch("columnAdjusted",{columnIndex:a,width:this.getColumnWidth(a)}))}});
juic.extend(k,SFAbstractGridProvider,{cleanup:function(){for(var a=this._metaData.getColumnMetaData(),b=0;b<a.length;b++)this._cleanupColumn(a[b]);for(var d in this._groupLookup)this._cleanupGroup(this._groupLookup[d]);this._rowProvider.removeEventListener("gridAvailable",this);this._rowProvider.removeEventListener("gridError",this);this._rowProvider.removeEventListener("gridLoading",this);this._rowProvider.removeEventListener("rowCountAvailable",this);this._rowProvider.removeEventListener("rowCountError",
this);this._rowProvider.cleanup()},reset:function(){this._bodyContent=this._loading;this._rowProvider.reset()},getChanges:function(){return this._rowProvider.getChanges()},setChanges:function(a){this._rowProvider.setChanges(a)},forEachCachedItem:function(a,b){this._rowProvider.forEachCachedItem(a,b)},setBodyContent:function(a){this._bodyContent=a},setAllocation:function(a){this._allocation=a},_cleanupColumn:function(a){a.header.cleanup();a.footer instanceof Component&&a.footer.cleanup()},_cleanupGroup:function(a){a.label instanceof
Component&&a.label.cleanup()},getCells:function(a,b,d,e){this._handleHeaders(a,b,d,e);this._handleContent(a,b,d,e);this._hasFooter&&this._handleFooter(a,b,d,e)},setItemProvider:function(a){this._rowProvider.setItemProvider(a)},getRowCount:function(){this._rowCount=0;this._rowProvider.getRowCount()},_onRowCountAvailable:function(a){this._rowCount=a.rowCount;this.dispatchEvent(a)},handleStaleCell:function(a,b){a>=this._headerSize&&a<this._headerSize+this._rowCount&&this._rowProvider.handleStaleCell(a-
this._headerSize,b)},handleVisibleCell:function(a,b){a>=this._headerSize&&a<this._headerSize+this._rowCount&&this._rowProvider.handleVisibleCell(a-this._headerSize,b)},handleRemovedCell:function(a,b){a>=this._headerSize&&a<this._headerSize+this._rowCount&&this._rowProvider.handleRemovedCell(a-this._headerSize,b)},_handleGridEvent:function(a){var b=set({},a.region);b.rowFrom+=this._headerSize;b.rowTo+=this._headerSize;b={region:b};switch(a.type){case "gridAvailable":var c=a.rowCount;if(this._rowCount!=
c){this._rowCount=c;this.dispatch("rowCountAvailable",{rowCount:c});return}b.grid=a.grid;break;case "gridError":b.message=a.message,b.error=a.error}this.dispatch(a.type,b)},_handleHeaders:function(a,b,d,e){if(d<this._headerSize){for(var c=[],f=d;f<this._headerSize&&f<=e;f++)c[f-d]=this._getHeaderRow(f,a,b);this.dispatch("gridAvailable",{region:{rowFrom:d,rowTo:Math.max(this._headerSize-1,e),columnFrom:a,columnTo:b},grid:c})}},_getHeaderRow:function(a,b,d){for(var c=[],e=b;e<=d;e++){var f=this._metaData.getColumnMetaData(e),
g=f.header;0==a&&this._hasGroups&&(g=f.group);c[e-b]=g}return c},_handleFooter:function(a,b,d,e){d=this._metaData.size("y");e==d-1&&(e=[this._getFooterRow(a,b)],this.dispatch("gridAvailable",{region:{rowFrom:d-1,rowTo:d-1,columnFrom:a,columnTo:b},grid:e}))},_getFooterRow:function(a,b){for(var c=[],d=a;d<=b;d++)c[d-a]=this._metaData.getColumnMetaData(d,"footer");return c},_handleContent:function(a,b,d,e){if(e>=this._headerSize){var c=this._metaData.size("y")-this._footerSize-this._headerSize;d=Math.max(0,
d-this._headerSize);e=Math.min(Math.max(0,e-this._headerSize),c-1);if(d<=e)if(1==c&&this._bodyContent){var c=[[]],f=this._allocation.getBodySectionIndices().columnStart;f>=a&&f<=b&&(c[0][f-a]=this._bodyContent);this.dispatch("gridAvailable",{region:{rowFrom:d+this._headerSize,rowTo:e+this._headerSize,columnFrom:a,columnTo:b},grid:c})}else this._rowProvider.getCells(a,b,d,e)}}});juic.extend(b,Component,{renderHtml:function(a){a.push(juic.maybeEscapeHTML(this._group.label));this._group.collapsible&&
a.push('\x3cbutton id\x3d"',this.id,'" onclick\x3d"',this.fireCode("_clickToggle"),'" class\x3d"',"groupToggle",this._group.collapsed?" groupCollapsed":"",'" title\x3d"',juic.maybeEscapeHTML(this._getCollapseTitle()),'"\x3e\x3c/button\x3e')},_getCollapseTitle:function(){return sfMessageFormat.format(this._group.collapsed?MSGS.COMMON_Expand_Group:MSGS.COMMON_Collapse_Group,this._group.title)},_clickToggle:function(){this._group.collapsed=!this._group.collapsed;var a=juic.$(this.id);SFDom[this._group.collapsed?
"addClass":"removeClass"](a,"groupCollapsed");a.title=this._getCollapseTitle();this.dispatch("action",{actionCommand:"toggle",collapsed:this._group.collapsed,group:this._group})}});juic.extend(a,Component,{cleanup:function(){this._label instanceof Component&&this._label.cleanup();delete this._definition},renderHtml:function(a){a.push('\x3cspan id\x3d"',this.getHeaderLabelId(),'" role\x3d"columnheader"',this._sortable?' aria-sort\x3d"true"':"");"string"==typeof this._label&&a.push(' title\x3d"',juic.escapeHTML(this._label),
'"');a.push("\x3e");this._sortable&&a.push('\x3ca href\x3d"javascript:void(0)" class\x3d"sortable link" onclick\x3d"',this.fireCode("_onClickSort"),'return false;" ondragstart\x3d"return false"\x3e\x3cspan class\x3d"direction"\x3e\x3c/span\x3e');this._label?"string"==typeof this._label?a.push(juic.escapeHTML(this._label)):a.push(this._label):a.push("\x26nbsp;");this._sortable&&(a.push('\x3cspan class\x3d"hiddenAriaContent"\x3e',MSGS.get("COMMON_GRID_CLICK_CHANGE_SORT_ORDER",this.getDirection()===
n?MSGS.COMMON_SORT_BY_ASC:MSGS.COMMON_SORT_BY_DES),"\x3c/span\x3e"),a.push("\x3c/a\x3e"));a.push("\x3c/span\x3e")},getHeaderLabelId:function(){return this._label?this.id+"_label":null},setDirection:function(a){this._direction=a},getDirection:function(){return this._direction},_handleLabelAction:function(a){this.dispatch("action",{actionCommand:a.actionCommand,headerEvent:a,columnDefinition:this._definition})},_onClickSort:function(){this.dispatch("action",{actionCommand:"sort",direction:this._direction==
n?r:n,columnDefinition:this._definition})}});juic.extend(e,SFAbstractAxisMetaData,{getMetaData:function(a,b){if(b){var c=a<this._headerSize,d=a==this._headerSize+this._rowCount;switch(b){case "css":return c?0==a&&this._hasGroups?"groupRow":"headerRow":d?"footerRow row":a%2?"oddRow alterRow":"evenRow row";case "frozen":return c||d;case "sectionIndex":return c?0:d?2:1;case "adjustable":return!1}}else{for(var c=["css","frozen","sectionIndex","adjustable"],d={},e=0;e<c.length;e++){var f=c[e];d[f]=this.getMetaData(a,
f)}return d}},setRowCount:function(a){this._rowCount=a},getAllocationValue:function(a,b){switch(a){case "sectionTotals":switch(b){case 0:return this._totalHeader;case 1:return this._rowCount*this._rowHeight;case 2:return this._footerHeight}case "cellSectionOffsets":return b<this._headerSize?1==b?this._groupHeight:0:b==this._headerSize+this._rowCount?0:(b-this._headerSize)*this._rowHeight;case "sizes":return b<this._headerSize?0==b&&this._hasGroups?this._groupHeight:this._headerHeight:b==this._headerSize+
this._rowCount?this._footerHeight:this._rowHeight}},getIndexAtOffset:function(a){return Math.floor(a/this._rowHeight)+this._headerSize},getMinimumSize:function(){return this._rowCount*this._rowHeight+this._totalHeader+this._footerHeight},getIndicesWithValue:function(a,b){var c=[];switch(a){case "frozen":c.push(0),this._hasGroups&&c.push(1),this._hasFooter&&c.push(this._headerSize+this._rowCount)}return c},size:function(){return this._headerSize+this._footerSize+this._rowCount},insert:function(a,b){this._rowCount=
a}});juic.extend(d,SFAbstractFocusManager,{setRowCount:function(a){this._rowCount=a},getNextFocusableColumn:function(a,b,d){if(a==this._headerSize-1&&this._hasSortable){a=this._metaData.getColumnSize();var c=d?-1:1;for(b=null==b?d?a-1:0:b+c;0<=b&&b<a;b+=c)if(this._metaData.getColumnMetaData(b,"sortable"))return b}else if(this._focusManager&&a>=this._headerSize&&a<this._headerSize+this._rowCount){if(this._focusManager instanceof SFAbstractFocusManager)return this._focusManager.getNextFocusableColumn(a-
this._headerSize,b,d);a=this._metaData.getColumnSize();null==b&&(b=d?a:-1);b+=d?-1:1;return 0>b?null:b>=a?null:b}return null},getNextFocusableRow:function(a,b){var c;c=null==a?b?this._headerSize+this._rowCount-2:this._headerSize-(this._hasSortable?1:0):a+(b?-1:1);if(c<this._headerSize)c=this._hasSortable?c:null;else if(this._focusManager instanceof SFAbstractFocusManager)c=null==a?this._focusManager.getNextFocusableRow(null,b):this._focusManager.getNextFocusableRow(Math.min(Math.max(0,a-this._headerSize),
this._rowCount-1),b),c=null==c?null:c+this._headerSize;else{var d=this._metaData.getRowSize();null==a&&(a=b?d:-1);c=a+(b?-1:1);return 0>c||c>=d?null:c}return c}});juic.extend(g,juic.Component,{renderHtml:function(a){a.push('\x3cdiv class\x3d"sfLoadingContainerSm"\x3e\x3cspan class\x3d"white"\x3e',MSGS.COMMON_loading,"\x3c/span\x3e\x3c/div\x3e")},cleanup:function(){}})})();