function RCMOTPAuthentication(a){this.register();this._init(a)}
juic.extend(RCMOTPAuthentication,juic.Component,{_init:function(a){this.emailLabel=a.emailLabel;this.emailValue=a.emailValue;this.maximumAllowedOTPAttempts=a.maxAllowedOTPAttempts;this.resendOtpInterval=a.waitingTimeForResendOTP;this.pageIdentifier=a.pageIdentifier;this.tokens=a.tokens||null;this.displayHeaderTitle=a.displayHeaderTitle;this.resendPasscodeCounter=this.otpCounter=0;this._loadBox=new SFLoading(MSGS.COMMON_loading,"",{isNewLoadingIndicator:!0});this._initialFocus=!1;this.render("otpContainer");
SFDom.setFocus("checkEmailMsg");SFDom.getElementsByClassName("mobileApplyCtr")[0]||Util.addClass(juic.$("otpContainer"),"nonMA");this._setDao();this._resendOTP()},_setDao:function(){this._rcmOtpAuthenticationDao=new RCMOTPAuthenticationDAO;this._rcmOtpAuthenticationDao.addEventListener("otpGenerationAvailable",this);this._rcmOtpAuthenticationDao.addEventListener("otpValidationAvailable",this);this._rcmOtpAuthenticationDao.addEventListener("otpGenerationFailed",this);this._rcmOtpAuthenticationDao.addEventListener("otpVerificationFailed",
this)},handleEvent:function(a){switch(a.type){case "otpValidationAvailable":SFOverlayMgr.removeOverlay(this._loadBox.id);this.otpCounter++;a.data?this.submitForm():this.otpCounter<this.maximumAllowedOTPAttempts?this.displayOtpError(MSGS.RCM_OTP_INVALID_PASSCODE):this._handleMaxOTPAttemptsReached();break;case "otpGenerationFailed":this.displayOtpError(a.errMsg);this.clearCountdown();this.displayResendPasscodeLink();break;case "otpVerificationFailed":this.displayOtpError(a.errMsg)}},renderHtml:function(a){a.push('\x3ctable class\x3d"axial noborder bottomspace table table-condensed" role\x3d"presentation"\x3e');
this.displayHeaderTitle&&(a.push("\x3ctr\x3e",'\x3ctd class\x3d"otpTitle col-sm-4"\x3e',MSGS.RCM_OTP_VERIFY_EMAIL_ADDRESS_HEADER,"\x3c/td\x3e","\x3ctd\x3e\x3c/td\x3e"),a.push("\x3c/tr\x3e"));a.push("\x3ctr\x3e",'\x3ctd class\x3d"col-sm-4"\x3e');a.push('\x3clabel for\x3d"otpEmail"\x3e\x3cstrong\x3e',juic.escapeHTML(this.emailLabel),"\x3c/strong\x3e");a.push("\x3c/label\x3e","\x3c/td\x3e");a.push("\x3ctd\x3e");a.push('\x3cspan id\x3d"otpEmail"\x3e',juic.escapeHTML(this.emailValue),"\x3c/span\x3e");
a.push("\x3c/td\x3e\x3c/tr\x3e");a.push("\x3ctr\x3e",'\x3ctd class\x3d"col-sm-4"\x3e\x3c/td\x3e');a.push("\x3ctd\x3e");a.push('\x3cspan id\x3d"checkEmailMsg" tabindex\x3d"0" role\x3d"region" aria-label\x3d"',MSGS.RCM_OTP_CHECK_EMAIL_LABEL,'"\x3e',MSGS.RCM_OTP_CHECK_EMAIL_LABEL,"\x3c/span\x3e");a.push("\x3c/td\x3e\x3c/tr\x3e");a.push("\x3ctr\x3e",'\x3ctd class\x3d"col-sm-4"\x3e\x3c/td\x3e');a.push("\x3ctd\x3e\x3c/td\x3e");a.push("\x3c/tr\x3e");a.push("\x3ctr\x3e",'\x3ctd class\x3d"col-sm-4"\x3e');
a.push('\x3clabel for\x3d"passcode" title\x3d"',MSGS.COMMON_Required,'"\x3e');a.push('\x3cspan class\x3d"required requiredAccessible" aria-hidden\x3d"true"\x3e*\x3c/span\x3e\x3cstrong\x3e',MSGS.RCM_ONE_TIME_PASSWORD,":","\x3c/strong\x3e");a.push("\x3c/label\x3e","\x3c/td\x3e");a.push("\x3ctd\x3e");a.push('\x3cdiv class\x3d"textContainer"\x3e');a.push('\x3cinput type\x3d"password" name\x3d"passcode" id\x3d"passcode" class\x3d"active" aria-describedby\x3d"passcode_error" aria-required\x3d"true" maxlength\x3d"10" onblur\x3d"',
this.fireCode("validateRequiredCheckForOTPField"),'" /\x3e');a.push('\x3cspan class\x3d"otpToggle" tabindex\x3d"0" onkeypress\x3d"',this.fireCode("_handleKeypressAction","togglePasscode"),'" onclick\x3d"',this.fireCode("_toggleHideShow"),'"\x3e',MSGS.COMMON_Show,"\x3c/span\x3e");a.push("\x3c/div\x3e");a.push('\x3cdiv id\x3d"passcode_error" class\x3d"rcmValidationMsgArea hide" aria-live\x3d"assertive"\x3e\x3c/div\x3e');a.push("\x3c/td\x3e","\x3c/tr\x3e");a.push('\x3ctr\x3e\x3ctd class\x3d"col-sm-4"\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e');
a.push("\x3ctr\x3e",'\x3ctd class\x3d"col-sm-4"\x3e\x3c/td\x3e');a.push('\x3ctd class\x3d"button_row mobileApplyButtonRow"\x3e');window.isMobile()?a.push('\x3cspan id\x3d"activeBtnSpan" class\x3d"aquabtn active fullScreenBtn"\x3e'):a.push('\x3cspan id\x3d"activeBtnSpan" class\x3d"aquabtn active"\x3e');a.push("\x3cspan\x3e");a.push('\x3cbutton type\x3d"button" id\x3d"continueBtn" name\x3d"continueBtn"');a.push('onclick\x3d"',this.fireCode("_validateOTP"),'"\x3e',MSGS.COMMON_BTN_Continue,"\x3c/button\x3e");
a.push("\x3c/span\x3e","\x3c/span\x3e");a.push('\x3cspan id\x3d"resendPasscode" tabindex\x3d"0" onkeypress\x3d"',this.fireCode("_handleKeypressAction","resend"),'" onclick\x3d"',this.fireCode("_resendOTP"),'" class\x3d"hide"\x3e',MSGS.RCM_OTP_REQUEST_PASSWORD_AGAIN,"\x3c/span\x3e");a.push('\x3cspan id\x3d"otpTimer" tabindex\x3d"0" class\x3d"hide" role\x3d"timer" aria-live\x3d"polite" aria-atomic\x3d"true"\x3e',"\x3c/span\x3e");a.push('\x3cdiv id\x3d"resendMaxLimit" class\x3d"resendMaxLimit hide"\x3e',
MSGS.RCM_OTP_DISABLE_RESEND_PASSCODE,"\x3c/div\x3e");a.push("\x3c/td\x3e","\x3c/tr\x3e");a.push("\x3c/table\x3e");a.push('\x3cinput type\x3d"hidden" id\x3d"otpContinueBtn" name\x3d"otpContinueBtn"  value\x3d"false" /\x3e')},displayOtpError:function(a){var b=juic.$("passcode"),c=juic.$("passcode_error");c.innerHTML="\x3cspan\x3e"+juic.escapeHTML(a)+"\x3c/span\x3e";Util.removeClass(c,"hide");Util.addClass(b,"invalidInput");b.value=""},_handleKeypressAction:function(a,b){if("RETURN"==SFDOMEvent.getKeyName(b))switch(a){case "togglePasscode":this._toggleHideShow(b);
break;case "resend":this._resendOTP()}},_toggleHideShow:function(a){var b=juic.$("passcode");"password"===b.type?(b.type="text",a.currentTarget.innerText=MSGS.COMMON_Hide):(b.type="password",a.currentTarget.innerText=MSGS.COMMON_Show)},_validateOTP:function(){var a=this.validateRequiredCheckForOTPField(),b=juic.$("passcode").value;a&&(SFOverlayMgr.showOverlay(this._loadBox,!0),this._rcmOtpAuthenticationDao.validateOTP(this.emailValue,b,this.pageIdentifier));return!1},_handleMaxOTPAttemptsReached:function(){var a=
juic.$("activeBtnSpan"),b=juic.$("continueBtn"),c=juic.$("resendPasscode"),d=juic.$("resendMaxLimit"),e=juic.$("passcode");this.clearCountdown();Util.addClass(c,"hide");Util.addClass(d,"hide");Util.removeClass(a,"active");Util.addClass(b,"inactive");e.disabled=!0;b.disabled=!0;b.setAttribute("aria-hidden",!0);this.displayOtpError(MSGS.RCM_OTP_TOO_MANY_INVALID_ATTEMPTS)},_resendOTP:function(){var a=juic.$("resendPasscode"),b=juic.$("otpTimer"),c=juic.$("resendMaxLimit");this.resendPasscodeCounter<
this.maximumAllowedOTPAttempts?(this.resendPasscodeCounter++,Util.addClass(a,"hide"),Util.removeClass(b,"hide"),b.innerText=sfMessageFormat.format(MSGS.RCM_OTP_REQUEST_PASSCODE,this.resendOtpInterval/60),this._displayOTPTimer(b)):(Util.addClass(b,"hide"),Util.addClass(a,"hide"),Util.removeClass(c,"hide"),SFDom.setFocus("resendMaxLimit"));this._rcmOtpAuthenticationDao.generateAndSendOTP(this.emailValue,this.tokens,this.pageIdentifier)},_displayOTPTimer:function(a){var b=(new Date).getTime()+1E3*this.resendOtpInterval,
c=this;this._initialFocus&&SFDom.setFocus("otpTimer");this._initialFocus=!0;this.countdown=setInterval(function(){var d=(new Date).getTime(),d=b-d,e=Math.floor(d%36E5/6E4),f=Math.floor(d%6E4/1E3);2>d?(c.clearCountdown(),c.displayResendPasscodeLink()):(d=sfMessageFormat.format(MSGS.RCM_OTP_REQUEST_PASSCODE,"0"+e+":"+(10>f?"0"+f:f)),a.innerText=d)},1E3)},clearCountdown:function(){var a=juic.$("otpTimer");clearInterval(this.countdown);a.innerText="";Util.addClass(a,"hide")},displayResendPasscodeLink:function(){var a=
juic.$("resendPasscode");Util.removeClass(a,"hide");SFDom.setFocus("resendPasscode")},validateRequiredCheckForOTPField:function(){var a=MSGS.RCM_ONE_TIME_PASSWORD,b=juic.$("passcode").value,c=juic.$("passcode_error"),a=decodeURIComponent(a);if(""===b.trim())return Util.addClass("passcode","invalidInput"),Util.removeClass(c,"hide"),a=-1<a.indexOf(":")?a.substring(0,a.length-1):a,c.innerHTML="\x3cspan\x3e"+sfMessageFormat.format(MSGS.COMMON_ERR_DATA_REQUIRED,a)+"\x3c/span\x3e",!1;Util.addClass(c,"hide");
Util.removeClass("passcode","invalidInput");c.innerHTML="";return!0},submitForm:function(){this.validateRequiredCheckForOTPField()&&(this.clearCountdown(),setField("otpContinueBtn","true"),this.dispatch("OtpSuccessful"))}});function RCMOTPAuthenticationDAO(){this._init()}
juic.extend(RCMOTPAuthenticationDAO,juic.EventTarget,{_init:function(){this._controller=AjaxService.getMBeanInstance("otpServiceController")},generateAndSendOTP:function(a,b,c){var d=this;this._controller.generateOTPAndSendEmail(a,b,c,{callback:function(a){d.dispatch("otpGenerationAvailable",{data:a})},exceptionHandler:function(a,b){d.dispatch("otpGenerationFailed",{errMsg:b.message})}})},validateOTP:function(a,b,c){var d=this;this._controller.verifyOTP(a,b,c,{callback:function(a){d.dispatch("otpValidationAvailable",
{data:a})},exceptionHandler:function(a,b){d.dispatch("otpVerificationFailed",{errMsg:b.message})}})}});