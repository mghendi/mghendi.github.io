/*
 !! BEGIN /ui/juic/js/components/sfSessionTimer.js !!! !! BEGIN /ui/juic/js/components/sfCountdown.js !!! !! BEGIN /ui/juic/js/components/sfUserActivityListener.js !!!*/
function SFSessionTimer(){this.init()}SFSessionTimer.NOTIFY_BEFORE_SESSION_EXPIRE=1;
SFSessionTimer.prototype=function(){function b(){var a=d;if(!a){var b=window.ajaxSecKey;b&&(d=a="sfTimeBeforeSessionExpire_"+(b||0))}return a}var d;return juic.set(new juic.EventTarget,{init:function(){this.sessionTimeoutController=AjaxService.getMBeanInstance("sessionTimeoutController");var a=this,b=function(b){var c=1E3*b.timeUntilExpires,e=10,d=b.timeUntilWarning;0<d&&30>d&&(e=d);a.timeAfterReminder=6E4*e;a.timeBeforeSessionExpire=6E4*SFSessionTimer.NOTIFY_BEFORE_SESSION_EXPIRE;a.timeToCallReminder=
c-a.timeAfterReminder;a._configuredSessionInterval=c;a.reset();a._configuredSessionTimeoutWarning=d;a.enableSessionTimeoutAutomaticRedirect=b.enableSessionTimeoutAutomaticRedirect;a.sessionTimeoutAutomaticRedirectUrl=b.sessionTimeoutAutomaticRedirectUrl},c=juic.$("sessionTimeoutConfigs");if(c&&((c=c.content)||(c=c["data-content"]),c))try{c=eval("("+c+")")}catch(f){c=null}null!=c?"object"==typeof c&&b(c):this.sessionTimeoutController.getSessionTimeoutConfigs({callback:b})},getSessionInterval:function(){return this._configuredSessionInterval},
getSessionTimeoutWarningTime:function(){return this._configuredSessionTimeoutWarning},warning:function(){var a=this;this.beforeSessionExpireId=window.setTimeout(function(){a.beforeSessionExpire()},this.timeAfterReminder-this.timeBeforeSessionExpire);this.dispatch("sessionWarning")},timedOut:function(){this.dispatch("sessionTimedOut")},beforeSessionExpire:function(){var a=this;this.timeoutId=window.setTimeout(function(){a.timedOut()},this.timeBeforeSessionExpire);this.dispatch("sessionAboutToExpire")},
extendSession:function(){this.keepAlive()},keepAlive:function(){this.sessionTimeoutController.keepAlive();this.reset();this.beforeSessionExpireId&&(window.clearTimeout(this.beforeSessionExpireId),this.beforeSessionExpireId=null);this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null);this.dispatch("sessionExtended")},createSessionExpirationTime:function(){return(new Date).getTime()+this._configuredSessionInterval},getSessionExpirationTime:function(){var a,e=b(),c=this.createSessionExpirationTime();
if(e){if(a=this._fallbackSessionExpirationTime,!a)try{a=window.localStorage.getItem(e),a||(a=c,window.localStorage.setItem(e,a))}catch(f){this._fallbackSessionExpirationTime=a=c}}else a=c;return a},setSessionExpirationTimeByDelta:function(a,e){var c=b(),d=(new Date).getTime()+a;if(c)if(this._fallbackSessionExpirationTime)this._fallbackSessionExpirationTime=d;else try{window.localStorage.setItem(c,d)}catch(h){this._fallbackSessionExpirationTime=d}else{if(e){var g=this;window.setTimeout(function(){g.setSessionExpirationTimeByDelta(a)},
500)}else throw"Could not set session expiration time to "+d+" because key could not be generated!";return!1}return!0},endSession:function(){this.sessionEnded=!0;this.setSessionExpirationTimeByDelta(0)},getWarningCountdown:function(){var a=this.timeAfterReminder,b=parseInt(this.getSessionExpirationTime()||0),c=(new Date).getTime(),b=b-c;return b<a?b:a},isExpired:function(){return(new Date).getTime()>this.getSessionExpirationTime()},reset:function(){this.clear();var a=this;window.PostMessageAPI&&PostMessageAPI.sendMessage("sessionExtended");
var b="prewarning";this.setSessionExpirationTimeByDelta(this._configuredSessionInterval);window.pollForSessionTimeout&&window.clearInterval(window.pollForSessionTimeout);window.pollForSessionTimeout=window.setInterval(function(){var c=parseInt(a.getSessionExpirationTime()||0);if(c&&"0"!=c){var d=(new Date).getTime(),e=d>=c-a.timeAfterReminder,c=1==a.sessionEnded?"ended":d>=c?"expired":e?"warning":"prewarning";if(c!==b||"warning"==c)switch(b=c,c){case "ended":a.dispatch("sessionEnded");break;case "expired":a.dispatch("sessionTimedOut");
break;case "warning":a.dispatch("sessionWarning");break;case "prewarning":a.dispatch("sessionPrewarning")}}},1E3)},clear:function(){this.warningId&&(window.clearTimeout(this.warningId),this.warningId=null);this.beforeSessionExpireId&&(window.clearTimeout(this.beforeSessionExpireId),this.beforeSessionExpireId=null);this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null)},cleanup:function(){this.clear()}})}();function SFCountdown(b,d,a){this.register();this._init(b,d,a)}
SFCountdown.prototype=function(){return juic.set(new juic.Component,{_init:function(b,d,a){this._secondsToGo=b;this._startShowingSecondsAt="undefined"!=typeof d?d:60;this._cssClass=a},setSecondsToGo:function(b){this._secondsToGo=b},renderHtml:function(b){b.push('\x3cspan id\x3d"',this.id,'" aria-hidden\x3d"true"\x3e\x3c/span\x3e');b.push('\x3cspan id\x3d"',this.id,'_hidden" class\x3d"hiddenAriaContent" aria-live\x3d"assertive" aria-atomic\x3d"true"\x3e\x3c/span\x3e')},_showCurrentCountdownTime:function(){var b=
this._secondsToGo,d=Math.round(b/60),a,e=!0;0<b&&b<this._startShowingSecondsAt?(a=sfMessageFormat.format(MSGS.COMMON_SESSION_WARNING,this._displayCountdownTime(b),MSGS.COMMON_SESSION_SECONDS),0!=b%10&&(e=!1)):0<b?a=sfMessageFormat.format(MSGS.COMMON_SESSION_WARNING,this._displayCountdownTime(d),59<b&&90>b?MSGS.COMMON_SESSION_MINUTE:MSGS.COMMON_SESSION_MINUTES):(this.clearTimer(),this.dispatch("timerExpired"));a&&this._oldVal!=a&&(b=juic.$(this.id))&&(this._oldVal=b.innerHTML=a);e&&a&&this._oldHiddenVal!=
a&&(b=juic.$(this.id+"_hidden"))&&(this._oldHiddenVal=b.innerHTML=a)},_displayCountdownTime:function(b){return this._cssClass?'\x3cspan class\x3d"'+this._cssClass+'"\x3e'+b+"\x3c/span\x3e":b},startCountdown:function(){var b=this;this._timerId=window.setInterval(function(){b._secondsToGo--;b._showCurrentCountdownTime()},1E3)},cancelCountdown:function(){delete this._oldVal;this.clearTimer();this.dispatch("timerCancelled")},clearTimer:function(){"undefined"!=typeof this._timerId&&(window.clearInterval(this._timerId),
delete this._timerId)},cleanup:function(){this.clearTimer();this.unregister()}})}();
function SFUserActivityListener(){var b=["keypress","click"],d=SFDom.getDocumentRoot();return juic.set(new juic.EventTarget,{startListening:function(){if(!0!==this._listenersAttached){this._listenersAttached=!0;for(var a=b&&b.length,e=0;e<a;e++)SFDOMEvent.addListener(d,b[e],this._handleUserActivity,this)}},stopListening:function(){for(var a=b&&b.length,e=0;e<a;e++)SFDOMEvent.removeListener(d,b[e],this._handleUserActivity);this._listenersAttached=!1},_handleUserActivity:function(a){this.dispatchEvent(new juic.EventTarget.Event("userActivity",
{}))}})};