function SFAdvancedTextArea(e,f){this.register();this._init(f||{});this.setValue(e);this._oldValue=e}SFAdvancedTextArea.FIELD_TYPE="TextArea";SFAdvancedTextArea.DEFAULT_HEIGHT=48;SFAdvancedTextArea.MAXIMUM_HEIGHT=150;SFAdvancedTextArea.DEFAULT_AUTOGROW_BOTTOMSPACE=3;
(function(){function e(a,b,c){null!=b&&(a=Math.max(a,b));null!=c&&(a=Math.min(a,c));return a}var f={width:0,height:0};juic.extend(SFAdvancedTextArea,SFAbstractInputField,{WARNING_HIDE_DELAY_SECONDS:5,POST_MAX_LENGTH_ALLOWED_KEYS:{8:"BACKSPACE",9:"TAB",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT_ARROW",38:"UP_ARROW",39:"RIGHT_ARROW",40:"DOWN_ARROW",45:"INSERT",46:"DELETE"},_writeHTMLElement:null,_hideOnBlur:!0,_init:function(a){this._config=a;this._rows=a.rows&&0<a.rows?a.rows:3;this._cols=
a.cols&&0<a.cols?a.cols:40;this._height=a.height||SFAdvancedTextArea.DEFAULT_HEIGHT;this._width=a.width;this._autoGrow_maxHeight=a.maxHeight?a.maxHeight:SFAdvancedTextArea.MAXIMUM_HEIGHT;this._autoGrow_bottomspace=a.autoGrow_bottomspace?a.autoGrow_bottomspace:SFAdvancedTextArea.DEFAULT_AUTOGROW_BOTTOMSPACE;this._writable="undefined"===typeof a.writable?!0:a.writable;this._maxLength=this._config.maxLength;this._writable&&this._maxLength&&(this.textLimiter=new SFTextLimiter(this._maxLength,this._config.countByByte),
this.textLimiter.addEventListener("limiterAction",this,"_handleLimiterEvent"),this._charLimitDialog=new SFDialog(MSGS.COMMON_Err,new SFSysMsg("alert",MSGS.get("COMMON_RTE_MAXIMUM_PASTE_LIMIT_MESSAGE",this._maxLength)),[{label:MSGS.COMMON_Ok,enabled:!0,active:!0,eventName:"hide"}],400,100));this.writeEleId=a.name?a.name:this.id+"_write";this._initForDragResizer(a)},_handleLimiterEvent:function(a){var b=juic.$(this.id+"_limiterText");"aboveThreshold"==a.actionCommand||"atThreshold"==a.actionCommand?
(b.style.display="",this._hideOnBlur=!0):"maxLength"==a.actionCommand||"aboveMaxLength"==a.actionCommand?(b.style.display="",this._hideOnBlur=!1):b.style.display="none"},getWriteElement:function(){var a=this._writeHTMLElement;if(!a&&(a=juic.$(this.writeEleId))){this._writeHTMLElement=a;var b=juic.$(this.id+"_limiterText");b&&(b.style.width="100%")}return a},setValue:function(a){this._value=a||"";if(a=this._writable?this.getWriteElement():juic.$(this.id+"_read"))this._writable?a.value=this._value:
a.innerHTML=escapeHTML(this._value),this._updateWrapperClassName()},getValue:function(){var a=this._writable&&this.getWriteElement()?this.getWriteElement().value:this._value;a&&(this._value=a=a.trim());return a},getWrapperSpanId:function(){var a=this._wrapperSpanId;a||(a=this.id+"_efeWrapperSpan");return a},_resizeForAutoGrow:function(){this._storeOldValue();var a=juic.$(this.getWrapperSpanId()),b=this.getWriteElement();a.style.height=b.style.height;SFDom.replaceClass(b,"showScrollbar","hideScrollbar");
b.style.height=this._autoGrow_minHeight+"px";b.scrollHeight>=this._autoGrow_minHeight&&b.scrollHeight<=this._autoGrow_maxHeight&&b.offsetHeight<=b.scrollHeight?b.style.height=b.scrollHeight+this._autoGrow_bottomspace+"px":b.scrollHeight>this._autoGrow_maxHeight&&(b.style.height=this._autoGrow_maxHeight+"px",SFDom.replaceClass(b,"hideScrollbar","showScrollbar"));a.style.height="auto";this._checkandRestValue()},_storeOldValue:function(a){var b=this.getWriteElement();b.value.length<=this._maxLength?
this._oldValuetemp=b.value:(this._oldValuetemp=b.value.slice(0,this._maxLength),a&&this._charLimitDialog.showDialog())},_keyUp:function(){this.dispatch("keyup");this._resizeForAutoGrow()},_keyDown:function(){this.dispatch("keydown")},_focus:function(){this._storeOldValue(!0);this._focusFlag=!0;this._updateWrapperClassName();this._resizeForAutoGrow()},_checkandRestValue:function(a){if(!this._maxLength)return!0;var b=this,c=this.getWriteElement();setTimeout(function(){c.value.length>b._config.maxLength&&
(c.value=b._oldValuetemp,a&&b._charLimitDialog.showDialog());b.textLimiter.checkLimiter(c.value)},0)},_getWrapperClassName:function(){return"writeComp formElement sfTextAreaWrapper "+(this._focusFlag?"field-focus":this._getFontColor())},_renderWriteHtml:function(a){delete this._writeHTMLElement;a.push('\x3cdiv id \x3d"',this.getWrapperSpanId(),'" class\x3d"writeComp sfTextAreaWrapper"\x3e',"\x3ctextarea class\x3d'formElement sfTextArea hideScrollbar' style\x3d'color:",this._fontColor);this._allowResize||
a.push("; resize:none;");a.push("; max-height:",this._autoGrow_maxHeight,isNaN(this._autoGrow_maxHeight)?"":"px",";");this._height&&a.push("height:",this._height,isNaN(this._height)?"":"px",";");this._width&&a.push("width:",this._width,isNaN(this._width)?"":"px",";");a.push("' ");this._height||a.push("rows\x3d'",this._rows,"' ");this._width||a.push("cols\x3d'",this._cols,"' ");a.push(" id\x3d'",this.writeEleId,"' "," name\x3d'",this.writeEleId,"' "," onfocus\x3d'",this.fireCode("_focus"),"' "," onpaste\x3d'",
this.fireCode("_checkandRestValue",!0),"' "," onchange\x3d'",this.fireCode("_change"),"' "," onblur\x3d'",this.fireCode("_blur"),"' "," onkeyup\x3d'",this.fireCode("_keyUp"),"' "," onkeydown\x3d'",this.fireCode("_keyDown"),"' ","\x3e",Util.escapeHTML(this._value)+"\x3c/textarea\x3e");a.addAfterRenderListener&&a.addAfterRenderListener(this,"handleAfterWriteElemRendered");a.push('\x3cdiv id\x3d"',this.id,'_limiterText" style\x3d"display:none" class\x3d"limiterWrapper" ','role\x3d"presentation"','\x3e\x3cspan class\x3d"globalFloatRight"\x3e');
this.textLimiter&&this.textLimiter.renderHtml(a);a.push("\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e")},handleAfterWriteElemRendered:function(){this._autoGrow_minHeight=this._height?this._height:this._rows*parseInt(SFDom.getComputedStyle(juic.$(this.writeEleId),"line-height"))},renderHtml:function(a){!this._missingResizeFeature&&this._allowResize?this._renderForDragResizer(a):this._renderContent(a)},_renderContent:function(a){this._writable&&(this._renderWriteHtml(a),this._maxLength&&a.push("\x3cdiv id\x3d'",
this.id,"_warning' class\x3d'warningText' role\x3d'presentation'\x3e\x3c/div\x3e"));a.push('\x3cdiv id\x3d"'+this.id+'_read" class\x3d"'+(this._writable?"readComp":"read_only")+'"\x3e'+Util.escapeHTML(this._value,"\x3cbr/\x3e").replace(/\s/ig,"\x26nbsp;")+"\x3c/div\x3e");this._sfError.renderHtml(a)},isModified:function(){return"undefined"==typeof this._oldValue&&this._value||this._oldValue!=this._value},reset:function(){this._value!==this._oldValue&&(this.setValue(this._oldValue),this.checkForErrors(),
this.dispatch(SFAbstractInputField.EVENT_CHANGE,{actionCommand:SFAbstractInputField.EVENT_FIELD_UNCHANGE,hasError:this._hasError}))},_blur:function(){this._focusFlag=!1;this._hideOnBlur&&(juic.$(this.id+"_limiterText").style.display="none");this.getWriteElement();this.checkForErrors()},_change:function(){var a=this.getWriteElement();a&&(this._updateWrapperClassName(),this._value=a.value.trim(),this.checkForErrors(),a=this.isModified()?SFAbstractInputField.EVENT_FIELD_CHANGE:SFAbstractInputField.EVENT_FIELD_UNCHANGE,
this.dispatch(SFAbstractInputField.EVENT_CHANGE,{actionCommand:a,hasError:this._hasError}))},_initForDragResizer:function(a){var b=document.createElement("textarea");this.setOptions(a);this._missingResizeFeature="undefined"!==typeof SFDom.getComputedStyle(b,"resize");this._allowResize=!!a.allowResize;this._dimension=a.dimension},positionFixed:function(a){var b=Math.abs(a.newComponentHeight),c=Math.abs(a.newComponentWidth);this._fixPoint=a.positionInfo.fixPoint;this._flipY="top"==this._fixPoint.origin.vertical;
this._flipX="right"==this._fixPoint.origin.horizontal;a=juic.$(this.getReferenceId());this._flipY&&(a.style.top="0px");SFDom[this._flipY?"addClass":"removeClass"](a,"sf-drag-flipy");SFDom[this._flipX?"addClass":"removeClass"](a,"sf-drag-flipx");if(b||c){var d={};this._offsetsX||(this._offsetsX=SFDom.getOffsets(a,"x"),this._offsetsY=SFDom.getOffsets(a,"y"));b&&(d.height=b-this._offsetsY-20);c&&(d.width=c-this._offsetsX-20);this.setDimension(d)}else this.resize()},getReferenceId:function(){return this.id+
"_dragResizer"},_renderForDragResizer:function(a){a.push('\x3cdiv id\x3d"',this.getReferenceId(),'" class\x3d"',"sf-drag-resizer",this._containerCss?" "+this._containerCss:"",'"\x3e');this._renderOuterContent(a);a.push("\x3c/div\x3e");a.addAfterRenderListener&&a.addAfterRenderListener(this,"handleAfterRenderListener")},_renderOuterContent:function(a){a.push('\x3cdiv id\x3d"',this.id,'thumb" class\x3d"thumb" onmousedown\x3d"',this.fireCode("_onDragStart"),'" ontouchstart\x3d"',this.fireCode("_onDragStart"),
'" unselectable\x3d"on" onselectstart\x3d"return false"\x3e\x3c/div\x3e');this._dragByResizing||a.push('\x3cdiv id\x3d"',this.id,'drag-box" class\x3d"',"drag-box",'"\x3e\x3c/div\x3e');a.push('\x3cdiv class\x3d"resizer-wrapper"\x3e');this._renderContent(a);a.push("\x3c/div\x3e")},handleDragEvent:function(a){switch(a.type){case "dragStart":this._startDragging();break;case "drag":case "dragEnd":var b=SFDom.getViewportRegion();x=Math.max(Math.min(b.right-17,a.point.x),b.left+17);y=Math.max(Math.min(b.bottom-
17,a.point.y),b.top+17);var b=x-a.origin.x,c=y-a.origin.y;this._flipY&&(c=-c);this._flipX&&(b=-b);var b={width:this._startDimension.width+b,height:this._startDimension.height+c},c=this.getMinDimension()||f,d=this.getMaxDimension(),b={width:e(b.width,c&&c.width,d&&d.width),height:e(b.height,c&&c.height,d&&d.height)};"dragEnd"==a.type&&this._endDragging();this._dragByResizing||"dragEnd"==a.type?this._resize(b):this._showResize(b)}},setOptions:function(a){this._dragByResizing=a&&a.allowResize;this._setFullWidth(a)},
cleanup:function(){this.unregister()},_setFullWidth:function(a){if(a=a&&a.fullWidth)this._fullWidth=a-4},_startDragging:function(){var a=juic.$(this.getReferenceId());SFDom.addClass(a,"resizing");this._startDimension={width:a.offsetWidth-SFDom.getOffsets(a,"x"),height:a.offsetHeight-SFDom.getOffsets(a,"y")};this._startPosition={top:parseInt(a.style.top)||0,left:parseInt(a.style.left)||0};this._dragByResizing||this._showResize(this._startDimension)},_endDragging:function(){SFDom.removeClass(juic.$(this.getReferenceId()),
"resizing")},_resize:function(a){this.setDimension(a);this.dispatch("changeDimensions");this.dispatch("dragResize",{dimension:a})},_showResize:function(a){var b=juic.$(this.id+"drag-box"),c=SFDom.getOffsets(b,"x"),d=SFDom.getOffsets(b,"y");b.style.width=Math.max(0,a.width-c)+"px";b.style.height=Math.max(0,a.height-d)+"px";this._flipY&&(c=juic.$(this.getReferenceId()),a=this._startDimension.height-a.height,a+=parseInt(SFDom.getStyle(c,"padding-top"))||0,a+=parseInt(SFDom.getStyle(c,"border-top"))||
0,b.style.top=a+"px")},_onDragStart:function(a){a=a||window.event;-1<a.type.indexOf("touch")&&SFDOMEvent.stopEvent(a);SFDragDropMgr.handleDragStart(a,this,{useShim:!0,shimCursor:"move",clickTimeThreshold:0})},_getDimensions:function(){var a=SFDom.getRegion(this._getWriteEleId());this._dimension={width:a.width-2*this._getBorderWidth(),height:a.height-2*this._getBorderWidth()}},_getBorderWidth:function(){return 1},_setStyles:function(a){SFDom.setStyle(this._getWriteEleId(),"width",a.width-2*this._getBorderWidth()+
"px");SFDom.setStyle(this._getWriteEleId(),"height",a.height-2*this._getBorderWidth()+"px")},_getWriteEleId:function(){return this.writeEleId},handleAfterRenderListener:function(){},setResizable:function(){},getResizable:function(){return this},setDimension:function(a){this._dimension=a;this._setStyles(a)},getDimension:function(){this._getDimensions();return this._dimension},resize:function(){},getMinDimension:function(){if(!this._config.minDimensions){var a=SFDom.getDefaultFontSize();this._config.minDimensions=
{width:"25",height:a[1]+4}}return this._config.minDimensions},getMaxDimension:function(){return this._config.maxDimensions}})})();