function TLMManageWorkScheduleDialogContent(a){this.register();this._init(a)}TLMManageWorkScheduleDialogContent.MODE={};TLMManageWorkScheduleDialogContent.MODE.CREATE="CREATE";TLMManageWorkScheduleDialogContent.MODE.VIEW="VIEW";TLMManageWorkScheduleDialogContent.MODE.CHANGE="CHANGE";TLMManageWorkScheduleDialogContent.EVENT={};TLMManageWorkScheduleDialogContent.EVENT.WORKSCHEDULE_LOADED="WORKSCHEDULE_LOADED";TLMManageWorkScheduleDialogContent.EVENT.NEW_WORKSCHEDULE="NEW_WORKSCHEDULE";
juic.extend(TLMManageWorkScheduleDialogContent,juic.Component,{_init:function(a){this._controller=AjaxService.getMBeanInstance("tlmWorkScheduleController");this._hasEditPermission=a.manageWorkScheduleAllowed;this._jobInfoMode=a.jobInfoMode;this._workScheduleId=a.workScheduleId;this._userId=a.userId;this._config={};this._config.jobInfoEffectiveDate=a.effectiveDate;this._config.company=a.companyId;this._config.writeMode=!1;this._config.timeRecordingVariant=a.timeRecordingVariant;this._config.workSchedule=
{};this._config.labels={};this._fetchMetaData();this.activitySpinner=new SFLoading(MSGS.COMMON_loading,"#000")},renderHtml:function(a){a.push('\x3cdiv class\x3d"tlmManageWorkSchedule" id\x3d"',this.id,'"\x3e',this.activitySpinner,"\x3c/div\x3e")},_rerender:function(){this._contentTabLayout=new TLMManageWorkScheduleTabLayout(this._config);var a=juic.$(this.id);if(a){var b=juic.createRenderContext();this._contentTabLayout.renderHtml(b);b.renderInto(a);this._config.writeMode?(Util.addClass(this.id,"writeMode"),
Util.removeClass(this.id,"readMode")):(Util.addClass(this.id,"readMode"),Util.removeClass(this.id,"writeMode"));"CLOCK_TIME"===this._config.workSchedule.getTimeRecordingVariant()?Util.addClass(this.id,"clockTime"):Util.removeClass(this.id,"clockTime")}},_fetchMetaData:function(){var a=this;this._controller.getMetadata(this._userId,this._config.company,{callback:function(b){a._countryCode=b.countryCode;a._isTimeRecordingVariantConfigured=b.timeRecordingVariantConfigured;a._fetchData()},errorHandler:function(){TLMFlashMessage.ShowMessage(MSGS.TIMEANDLABOR_SYSTEM_ERROR,
ECTConstants.STATUS_ERROR,TLMFlashMessage.LONG)}})},_fetchData:function(){var a=this;this._controller.getWorkSchedule(this._workScheduleId,this._userId,{callback:function(b){a._evaluateResponse(b)},errorHandler:function(){TLMFlashMessage.ShowMessage(MSGS.TIMEANDLABOR_SYSTEM_ERROR,ECTConstants.STATUS_ERROR,TLMFlashMessage.LONG)}})},_evaluateResponse:function(a){var b=a.workSchedule;this._hasEditPermission=a.editable&&"EDIT"===this._jobInfoMode;b||"VIEW"!==this._jobInfoMode?b||"EDIT"!==this._jobInfoMode||
a.editable?b||"EDIT"!==this._jobInfoMode||this._config.timeRecordingVariant||!this._isTimeRecordingVariantConfigured?(this._config.labels=a.labels,b?this._config.workSchedule=TLMFieldsHelper.ManageWorkSchedule.FactorByResponse(b):(this._config.workSchedule=this._createNewIWS(),this._config.writeMode=!0),this._dispatchModeEvent(this._config.writeMode,this._config.workSchedule.getExternalName()),this._rerender()):(a=juic.$(this.id),a.innerHTML=MSGS.TIMEANDLABOR_WSF_UI_CANNOT_CREATE_IWS_NO_TIME_VARIANT_CHOSEN,
this._hasEditPermission=!1,this._dispatchModeEvent(!1,"")):(a=juic.$(this.id),a.innerHTML=MSGS.TIMEANDLABOR_WORKSCHEDULE_NO_CREATE_PERMISSION,this._dispatchModeEvent(!1,"")):(a=juic.$(this.id),a.innerHTML=MSGS.TIMEANDLABOR_WORKSCHEDULE_NO_WORKSCHEDULE_ASSIGNED,this._dispatchModeEvent(!1,""))},_dispatchModeEvent:function(a,b){a?this.dispatch(TLMManageWorkScheduleDialogContent.MODE.CHANGE,{mode:TLMManageWorkScheduleDialogContent.MODE.CREATE,isTimeRecordingVariantConfigured:this._isTimeRecordingVariantConfigured}):
this.dispatch(TLMManageWorkScheduleDialogContent.MODE.CHANGE,{mode:TLMManageWorkScheduleDialogContent.MODE.VIEW,name:b,hasPermissionToCreateNewWS:this._hasEditPermission,isTimeRecordingVariantConfigured:this._isTimeRecordingVariantConfigured})},getWorkSchedule:function(){return this._contentTabLayout.getWorkSchedule()},renderNewIWS:function(){this._config.workSchedule=this._createNewIWS();this._config.writeMode=!0;this._dispatchModeEvent(this._config.writeMode,"");this._rerender()},_createNewIWS:function(){var a=
new TLMFieldsHelper.ManageWorkSchedule;a.setUserId(this._userId);this._userId?a.setExternalName("IWS "+this._userId+" "+this._config.jobInfoEffectiveDate):this._config.jobInfoEffectiveDate?a.setExternalName("IWS "+this._config.jobInfoEffectiveDate):a.setExternalName("IWS"+TLMFieldsHelper.DateNow);a.setStartingDate(this._config.jobInfoEffectiveDate);a.setCountryCode(this._countryCode);a.setTimeRecordingVariant(this._config.timeRecordingVariant||TLMFieldsHelper.ManageWorkSchedule.REC_VARIANT_DURATION);
return a},validate:function(){return this._contentTabLayout.validate()}});function TLMManageWorkScheduleTabLayout(a){this.register();this._init(a)}
juic.extend(TLMManageWorkScheduleTabLayout,juic.Component,{_init:function(a){this._config=a;this._contentWorkScheduleDetailsTab=new TLMManageWorkScheduleDetailsTab(this._config);this.jQueryId="#"+this.id.replace(/:/g,"\\:")},renderHtml:function(a){a.push('\x3cul class\x3d"workScheduleTabs" role\x3d"tablist"\x3e');a.push('\x3cli id\x3d"'+this.id+'_schedule_details_tab" class\x3d"tab_active"\x3e');a.push('\x3ca href\x3d"javascript:void(0);" id\x3d"'+this.id+'_schedule_details_link" role\x3d"tab" title\x3d"',
MSGS.TIMEANDLABOR_WORKSCHEDULE_SCHEDULE_DETAILS,'" style\x3d"display:inline-block" onclick\x3d"',this.fireCode("_openScheduleDetails"),'"\x3e');a.push("\x3ch4\x3e",MSGS.TIMEANDLABOR_WORKSCHEDULE_SCHEDULE_DETAILS,"\x3c/h4\x3e");a.push("\x3c/a\x3e\x3c/li\x3e");a.push('\x3cli id\x3d"'+this.id+'_preview_tab" class\x3d"tab_inactive"\x3e');a.push('\x3ca href\x3d"javascript:void(0);" id\x3d"'+this.id+'_preview_link" role\x3d"tab" title\x3d"',MSGS.TIMEANDLABOR_WORKSCHEDULE_PREVIEW,'" style\x3d"display:inline-block" onclick\x3d"',
this.fireCode("_openPreview"),'"\x3e');a.push("\x3ch4\x3e",MSGS.TIMEANDLABOR_WORKSCHEDULE_PREVIEW,"\x3c/h4\x3e");a.push("\x3c/a\x3e\x3c/li\x3e");a.push("\x3c/ul\x3e");a.push('\x3cdiv id\x3d"'+this.id+'_details" class\x3d"workScheduleTabContent"\x3e',this._contentWorkScheduleDetailsTab,"\x3c/div\x3e");a.push('\x3cdiv id\x3d"'+this.id+'_preview" style \x3d "display:none;" class\x3d"workScheduleTabContent"\x3e\x3c/div\x3e')},setFocus:function(a){jQuery(a).focus()},_openScheduleDetails:function(){juic.$(this.id+
"_details").style.display="block";juic.$(this.id+"_preview").style.display="none";this._setTabAsActive(this.id+"_schedule_details_tab");this._setTabAsInactive(this.id+"_preview_tab");this.setFocus(this.jQueryId+"_schedule_details_link")},_openPreview:function(){var a=this.getWorkSchedule();if(""===a.getStartingDate())this.validate(),TLMFlashMessage.ShowMessage(MSGS.TIMEANDLABOR_WORKSCHEDULE_SWITCH_TO_PREVIEW_IMPOSSIBLE,ECTConstants.STATUS_ERROR,TLMFlashMessage.LONG);else{juic.$(this.id+"_details").style.display=
"none";var b=juic.$(this.id+"_preview");if(this._contentPreview)this._contentPreview.refresh(a);else{var c=[];c.workSchedule=a;c.keyDate=this._config.jobInfoEffectiveDate?TLMFieldsHelper.DateFormatter.parse(this._config.jobInfoEffectiveDate):TLMFieldsHelper.DateFormatter.parse(TLMFieldsHelper.DateNow);this._contentPreview=new TLMManageWorkSchedulePreview(c);a=juic.createRenderContext();this._contentPreview.renderHtml(a);a.renderInto(b)}b.style.display="block";this._setTabAsInactive(this.id+"_schedule_details_tab");
this._setTabAsActive(this.id+"_preview_tab");this.setFocus(this.jQueryId+"_preview_link")}},_setTabAsActive:function(a){Util.removeClass(a,"tab_inactive")},_setTabAsInactive:function(a){Util.addClass(a,"tab_inactive")},getWorkSchedule:function(){return this._contentWorkScheduleDetailsTab.getWorkSchedule()},validate:function(){return this._contentWorkScheduleDetailsTab.validate()}});